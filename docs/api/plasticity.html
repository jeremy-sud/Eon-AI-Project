<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 16.0.0"/>
    <title>plasticity API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note{color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.tip{color:#0a3622;background-color:#d1e7dd;border-color:#a3cfbb;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%230a3622%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%206a6%206%200%201%201%2010.174%204.31c-.203.196-.359.4-.453.619l-.762%201.769A.5.5%200%200%201%2010.5%2013a.5.5%200%200%201%200%201%20.5.5%200%200%201%200%201l-.224.447a1%201%200%200%201-.894.553H6.618a1%201%200%200%201-.894-.553L5.5%2015a.5.5%200%200%201%200-1%20.5.5%200%200%201%200-1%20.5.5%200%200%201-.46-.302l-.761-1.77a2%202%200%200%200-.453-.618A5.98%205.98%200%200%201%202%206m6-5a5%205%200%200%200-3.479%208.592c.263.254.514.564.676.941L5.83%2012h4.342l.632-1.467c.162-.377.413-.687.676-.941A5%205%200%200%200%208%201%22/%3E%3C/svg%3E");}.pdoc .alert.important{color:#055160;background-color:#cff4fc;border-color:#9eeaf9;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23055160%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%200a2%202%200%200%200-2%202v12a2%202%200%200%200%202%202h12a2%202%200%200%200%202-2V2a2%202%200%200%200-2-2zm6%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.caution{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M11.46.146A.5.5%200%200%200%2011.107%200H4.893a.5.5%200%200%200-.353.146L.146%204.54A.5.5%200%200%200%200%204.893v6.214a.5.5%200%200%200%20.146.353l4.394%204.394a.5.5%200%200%200%20.353.146h6.214a.5.5%200%200%200%20.353-.146l4.394-4.394a.5.5%200%200%200%20.146-.353V4.893a.5.5%200%200%200-.146-.353zM8%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:27px;vertical-align:bottom;width:50px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="index.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;
                Module Index
            </a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#HebbianESN">HebbianESN</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#HebbianESN.__init__">HebbianESN</a>
                        </li>
                        <li>
                                <a class="variable" href="#HebbianESN.learning_rate">learning_rate</a>
                        </li>
                        <li>
                                <a class="variable" href="#HebbianESN.plasticity_type">plasticity_type</a>
                        </li>
                        <li>
                                <a class="variable" href="#HebbianESN.weight_history">weight_history</a>
                        </li>
                        <li>
                                <a class="function" href="#HebbianESN.adapt_online">adapt_online</a>
                        </li>
                        <li>
                                <a class="function" href="#HebbianESN.get_adaptation_stats">get_adaptation_stats</a>
                        </li>
                        <li>
                                <a class="function" href="#HebbianESN.reset_plasticity">reset_plasticity</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#compare_plasticity_types">compare_plasticity_types</a>
            </li>
            <li>
                    <a class="class" href="#TzimtzumESN">TzimtzumESN</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#TzimtzumESN.__init__">TzimtzumESN</a>
                        </li>
                        <li>
                                <a class="variable" href="#TzimtzumESN.n_reservoir">n_reservoir</a>
                        </li>
                        <li>
                                <a class="variable" href="#TzimtzumESN.config">config</a>
                        </li>
                        <li>
                                <a class="variable" href="#TzimtzumESN.tzimtzum_state">tzimtzum_state</a>
                        </li>
                        <li>
                                <a class="function" href="#TzimtzumESN.dark_night">dark_night</a>
                        </li>
                        <li>
                                <a class="function" href="#TzimtzumESN.renacimiento">renacimiento</a>
                        </li>
                        <li>
                                <a class="function" href="#TzimtzumESN.full_tzimtzum_cycle">full_tzimtzum_cycle</a>
                        </li>
                        <li>
                                <a class="function" href="#TzimtzumESN.get_sparsity_report">get_sparsity_report</a>
                        </li>
                        <li>
                                <a class="function" href="#TzimtzumESN.visualize_contraction">visualize_contraction</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#TzimtzumConfig">TzimtzumConfig</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#TzimtzumConfig.__init__">TzimtzumConfig</a>
                        </li>
                        <li>
                                <a class="variable" href="#TzimtzumConfig.pruning_fraction">pruning_fraction</a>
                        </li>
                        <li>
                                <a class="variable" href="#TzimtzumConfig.dark_night_interval">dark_night_interval</a>
                        </li>
                        <li>
                                <a class="variable" href="#TzimtzumConfig.regrowth_fraction">regrowth_fraction</a>
                        </li>
                        <li>
                                <a class="variable" href="#TzimtzumConfig.min_survival_weight">min_survival_weight</a>
                        </li>
                        <li>
                                <a class="variable" href="#TzimtzumConfig.min_connections_fraction">min_connections_fraction</a>
                        </li>
                        <li>
                                <a class="variable" href="#TzimtzumConfig.preserve_topology">preserve_topology</a>
                        </li>
                        <li>
                                <a class="variable" href="#TzimtzumConfig.use_gradient_importance">use_gradient_importance</a>
                        </li>
                        <li>
                                <a class="variable" href="#TzimtzumConfig.regrowth_seed">regrowth_seed</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#TzimtzumState">TzimtzumState</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#TzimtzumState.__init__">TzimtzumState</a>
                        </li>
                        <li>
                                <a class="variable" href="#TzimtzumState.phase">phase</a>
                        </li>
                        <li>
                                <a class="variable" href="#TzimtzumState.total_connections">total_connections</a>
                        </li>
                        <li>
                                <a class="variable" href="#TzimtzumState.pruned_connections">pruned_connections</a>
                        </li>
                        <li>
                                <a class="variable" href="#TzimtzumState.regrown_connections">regrown_connections</a>
                        </li>
                        <li>
                                <a class="variable" href="#TzimtzumState.pruning_cycles">pruning_cycles</a>
                        </li>
                        <li>
                                <a class="variable" href="#TzimtzumState.memory_saved_bytes">memory_saved_bytes</a>
                        </li>
                        <li>
                                <a class="variable" href="#TzimtzumState.current_threshold">current_threshold</a>
                        </li>
                        <li>
                                <a class="variable" href="#TzimtzumState.min_weight_survived">min_weight_survived</a>
                        </li>
                        <li>
                                <a class="variable" href="#TzimtzumState.max_weight_pruned">max_weight_pruned</a>
                        </li>
                        <li>
                                <a class="variable" href="#TzimtzumState.compression_ratio">compression_ratio</a>
                        </li>
                        <li>
                                <a class="function" href="#TzimtzumState.to_dict">to_dict</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#TzimtzumMixin">TzimtzumMixin</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#TzimtzumMixin.init_tzimtzum">init_tzimtzum</a>
                        </li>
                        <li>
                                <a class="function" href="#TzimtzumMixin.dark_night">dark_night</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ContractionPhase">ContractionPhase</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#ContractionPhase.PLENITUD">PLENITUD</a>
                        </li>
                        <li>
                                <a class="variable" href="#ContractionPhase.DARK_NIGHT">DARK_NIGHT</a>
                        </li>
                        <li>
                                <a class="variable" href="#ContractionPhase.CHALLAL">CHALLAL</a>
                        </li>
                        <li>
                                <a class="variable" href="#ContractionPhase.RENACIMIENTO">RENACIMIENTO</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#HebbianTzimtzumESN">HebbianTzimtzumESN</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#HebbianTzimtzumESN.__init__">HebbianTzimtzumESN</a>
                        </li>
                        <li>
                                <a class="variable" href="#HebbianTzimtzumESN.tzimtzum_config">tzimtzum_config</a>
                        </li>
                        <li>
                                <a class="variable" href="#HebbianTzimtzumESN.tzimtzum_state">tzimtzum_state</a>
                        </li>
                        <li>
                                <a class="function" href="#HebbianTzimtzumESN.dark_night">dark_night</a>
                        </li>
                        <li>
                                <a class="function" href="#HebbianTzimtzumESN.renacimiento">renacimiento</a>
                        </li>
                        <li>
                                <a class="function" href="#HebbianTzimtzumESN.full_tzimtzum_cycle">full_tzimtzum_cycle</a>
                        </li>
                        <li>
                                <a class="function" href="#HebbianTzimtzumESN.get_combined_stats">get_combined_stats</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22160%22%20viewBox%3D%220%200%20150%2080%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M132.316%2048.886c.276-4.679%202.342-6.698%204.409-7.982s4.27-1.165%206.751-1.055c1.586.07%203.044.156%204.222-.482%201.142-.619%202.026-1.932%202.162-3.739.268-3.576-1.929-5.368-5.006-5.551s-7.599.524-10.517%201.606c-4.455%201.652-8.588%206.606-9.552%208.992s-2.342%206.193-1.745%2010.873%202.664%209.221%205.878%2011.79%205.878%203.808%2010.103%204.312%203.444.229%206.062.229%205.006-2.202%204.914-4.909-2.296-5.001-4.501-4.863-3.077.505-5.281.229-7.715-2.064-7.899-9.451z%22%20fill%3D%22%23198754%22/%3E%3Ccircle%20cx%3D%22101.504%22%20cy%3D%2248.943%22%20r%3D%2214.208%22%20fill%3D%22none%22%20stroke%3D%22%23198754%22%20stroke-width%3D%229.354%22/%3E%3Cpath%20d%3D%22M87.81.002c-3.637.065-5.001.454-7.014%201.232s-3.443%201.363-6.3%204.282c-1.723%201.76-3.148%205.019-3.776%207.329-.413%201.521-.316%202.63-.316%202.63l-.195%2034.612c.065%205.774-6.755%208.305-9.612%208.37s-9.678-1.038-9.743-9.408%207.128-9.521%208.362-9.521c1.413-.13%202.526-.021%203.718-.016%202.071.009%204.157-.778%204.092-4.671s-4.157-4.736-4.157-4.736c-6.3-.843-11.43%202.206-11.43%202.206S40.917%2038.15%2041.372%2049.634%2051.568%2068.19%2061.311%2068.125s18.316-7.007%2018.445-17.193l.13-22.772c.046-2.291%202.683-3.644%204.476-4.203.745-.232%201.694-.274%201.694-.274l10.457-.13s4.871-.324%207.729-3.114%204.352-6.294%204.352-6.294.974-3.049.13-4.606-.195-1.233-2.792-3.309-8.573-4.477-8.573-4.477S91.447-.063%2087.81.002zM0%2047.169l.065%2028.417S0%2080.127%204.481%2079.997s5.072-3.866%205.049-4.152l-.113-28.482s1.624-7.656%209.937-7.721%2010.002%206.942%2010.002%208.499-.909%2010.51-9.093%2010.51c-.948%200-2.99-.567-4.145-.272-3.919%201-3.194%204.554-3.194%204.554s.065%205.061%207.404%204.996%2018.575-6.034%2018.575-19.074S26.953%2030.04%2019.549%2029.91%201.234%2035.296%200%2047.169z%22%20fill%3D%22%23198754%22/%3E%3Cg%20transform%3D%22matrix%28.325601%200%200%20.325256%20-10.32669%20-45.802786%29%22%3E%3Ccircle%20cx%3D%22297.554%22%20cy%3D%22172.286%22%20r%3D%2216.5%22%20fill%3D%22%23fff%22/%3E%3Cellipse%20cx%3D%22297.709%22%20cy%3D%22172.642%22%20rx%3D%2211.071%22%20ry%3D%2210.871%22%20fill%3D%22%23105a48%22/%3E%3Ccircle%20cx%3D%22304.104%22%20cy%3D%22167.667%22%20r%3D%224.5%22%20fill%3D%22%23fff%22/%3E%3C/g%3E%3Cpath%20d%3D%22M94.661%2017.032l.893-1.476s.99.714%201.916.925%201.575.114%202.955.114l14.565-.162c1.283-.032%203.085-.762%203.02-3.293s-.373-3.503-.373-3.503l1.283-.487s.52.503.877%201.573.309%201.995.292%202.66-.227%201.541-.227%201.541%201.564-.308%202.359-1.038.823-.779%201.489-1.508.812-.86.812-.86.552-.13.877.26.341.957.065%201.46-1.672%202.206-3.247%203.066-2.76%201.427-3.929%201.768-3.848.73-7.063.714l-10.944-.114s-2.143-.081-3.02-.373-2.241-.973-2.598-1.265z%22%20fill%3D%22%23d36d49%22/%3E%3Cg%20fill%3D%22%23105a48%22%3E%3Cellipse%20cx%3D%2293.052%22%20cy%3D%2243.567%22%20rx%3D%22.869%22%20ry%3D%221.014%22%20transform%3D%22rotate%28341.022%29%22/%3E%3Cellipse%20cx%3D%22104.3%22%20cy%3D%22-16.184%22%20rx%3D%22.865%22%20ry%3D%221.009%22%20transform%3D%22rotate%2814.786%29%22/%3E%3C/g%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
plasticity    </h1>

                
                        <input id="mod-plasticity-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-plasticity-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos"> 1</span></a><span class="c1"># Plasticity module - Proyecto Eón</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos"> 2</span></a><span class="c1"># Plasticidad sináptica y protocolos de adaptación</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos"> 3</span></a>
</span><span id="L-4"><a href="#L-4"><span class="linenos"> 4</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.hebbian</span><span class="w"> </span><span class="kn">import</span> <span class="n">HebbianESN</span><span class="p">,</span> <span class="n">compare_plasticity_types</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos"> 5</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.tzimtzum</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos"> 6</span></a>    <span class="n">TzimtzumESN</span><span class="p">,</span> 
</span><span id="L-7"><a href="#L-7"><span class="linenos"> 7</span></a>    <span class="n">TzimtzumConfig</span><span class="p">,</span> 
</span><span id="L-8"><a href="#L-8"><span class="linenos"> 8</span></a>    <span class="n">TzimtzumState</span><span class="p">,</span> 
</span><span id="L-9"><a href="#L-9"><span class="linenos"> 9</span></a>    <span class="n">TzimtzumMixin</span><span class="p">,</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">10</span></a>    <span class="n">ContractionPhase</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">11</span></a><span class="p">)</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">12</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.hebbian_tzimtzum</span><span class="w"> </span><span class="kn">import</span> <span class="n">HebbianTzimtzumESN</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">13</span></a>
</span><span id="L-14"><a href="#L-14"><span class="linenos">14</span></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">15</span></a>    <span class="c1"># Hebbian</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">16</span></a>    <span class="s1">&#39;HebbianESN&#39;</span><span class="p">,</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">17</span></a>    <span class="s1">&#39;compare_plasticity_types&#39;</span><span class="p">,</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">18</span></a>    <span class="c1"># Tzimtzum</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">19</span></a>    <span class="s1">&#39;TzimtzumESN&#39;</span><span class="p">,</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">20</span></a>    <span class="s1">&#39;TzimtzumConfig&#39;</span><span class="p">,</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">21</span></a>    <span class="s1">&#39;TzimtzumState&#39;</span><span class="p">,</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">22</span></a>    <span class="s1">&#39;TzimtzumMixin&#39;</span><span class="p">,</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">23</span></a>    <span class="s1">&#39;ContractionPhase&#39;</span><span class="p">,</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">24</span></a>    <span class="c1"># Combined</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos">25</span></a>    <span class="s1">&#39;HebbianTzimtzumESN&#39;</span><span class="p">,</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">26</span></a><span class="p">]</span>
</span></pre></div>


            </section>
                <section id="HebbianESN">
                            <input id="HebbianESN-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">HebbianESN</span><wbr>(<span class="base">esn.esn.EchoStateNetwork</span>):

                <label class="view-source-button" for="HebbianESN-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HebbianESN"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HebbianESN-23"><a href="#HebbianESN-23"><span class="linenos"> 23</span></a><span class="k">class</span><span class="w"> </span><span class="nc">HebbianESN</span><span class="p">(</span><span class="n">EchoStateNetwork</span><span class="p">):</span>
</span><span id="HebbianESN-24"><a href="#HebbianESN-24"><span class="linenos"> 24</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HebbianESN-25"><a href="#HebbianESN-25"><span class="linenos"> 25</span></a><span class="sd">    ESN con plasticidad Hebbiana para aprendizaje continuo.</span>
</span><span id="HebbianESN-26"><a href="#HebbianESN-26"><span class="linenos"> 26</span></a><span class="sd">    </span>
</span><span id="HebbianESN-27"><a href="#HebbianESN-27"><span class="linenos"> 27</span></a><span class="sd">    A diferencia del ESN estándar donde el reservoir es estático,</span>
</span><span id="HebbianESN-28"><a href="#HebbianESN-28"><span class="linenos"> 28</span></a><span class="sd">    esta versión permite que las conexiones del reservoir se</span>
</span><span id="HebbianESN-29"><a href="#HebbianESN-29"><span class="linenos"> 29</span></a><span class="sd">    adapten gradualmente según la actividad, emulando la plasticidad</span>
</span><span id="HebbianESN-30"><a href="#HebbianESN-30"><span class="linenos"> 30</span></a><span class="sd">    sináptica biológica.</span>
</span><span id="HebbianESN-31"><a href="#HebbianESN-31"><span class="linenos"> 31</span></a><span class="sd">    </span>
</span><span id="HebbianESN-32"><a href="#HebbianESN-32"><span class="linenos"> 32</span></a><span class="sd">    Tipos de plasticidad soportados:</span>
</span><span id="HebbianESN-33"><a href="#HebbianESN-33"><span class="linenos"> 33</span></a><span class="sd">    - Hebb clásico: Δw = η * pre * post</span>
</span><span id="HebbianESN-34"><a href="#HebbianESN-34"><span class="linenos"> 34</span></a><span class="sd">    - STDP simplificado: considera timing entre activaciones</span>
</span><span id="HebbianESN-35"><a href="#HebbianESN-35"><span class="linenos"> 35</span></a><span class="sd">    - Anti-Hebbiano: para diversificar representaciones</span>
</span><span id="HebbianESN-36"><a href="#HebbianESN-36"><span class="linenos"> 36</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="HebbianESN-37"><a href="#HebbianESN-37"><span class="linenos"> 37</span></a>    
</span><span id="HebbianESN-38"><a href="#HebbianESN-38"><span class="linenos"> 38</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="HebbianESN-39"><a href="#HebbianESN-39"><span class="linenos"> 39</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="HebbianESN-40"><a href="#HebbianESN-40"><span class="linenos"> 40</span></a>        <span class="n">n_inputs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="HebbianESN-41"><a href="#HebbianESN-41"><span class="linenos"> 41</span></a>        <span class="n">n_reservoir</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
</span><span id="HebbianESN-42"><a href="#HebbianESN-42"><span class="linenos"> 42</span></a>        <span class="n">n_outputs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="HebbianESN-43"><a href="#HebbianESN-43"><span class="linenos"> 43</span></a>        <span class="n">spectral_radius</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span>
</span><span id="HebbianESN-44"><a href="#HebbianESN-44"><span class="linenos"> 44</span></a>        <span class="n">sparsity</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span>
</span><span id="HebbianESN-45"><a href="#HebbianESN-45"><span class="linenos"> 45</span></a>        <span class="n">noise</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">,</span>
</span><span id="HebbianESN-46"><a href="#HebbianESN-46"><span class="linenos"> 46</span></a>        <span class="n">learning_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">,</span>
</span><span id="HebbianESN-47"><a href="#HebbianESN-47"><span class="linenos"> 47</span></a>        <span class="n">plasticity_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;hebbian&#39;</span><span class="p">,</span>
</span><span id="HebbianESN-48"><a href="#HebbianESN-48"><span class="linenos"> 48</span></a>        <span class="n">random_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="HebbianESN-49"><a href="#HebbianESN-49"><span class="linenos"> 49</span></a>    <span class="p">):</span>
</span><span id="HebbianESN-50"><a href="#HebbianESN-50"><span class="linenos"> 50</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HebbianESN-51"><a href="#HebbianESN-51"><span class="linenos"> 51</span></a><span class="sd">        Inicializa ESN con plasticidad.</span>
</span><span id="HebbianESN-52"><a href="#HebbianESN-52"><span class="linenos"> 52</span></a><span class="sd">        </span>
</span><span id="HebbianESN-53"><a href="#HebbianESN-53"><span class="linenos"> 53</span></a><span class="sd">        Args:</span>
</span><span id="HebbianESN-54"><a href="#HebbianESN-54"><span class="linenos"> 54</span></a><span class="sd">            learning_rate: Tasa de aprendizaje para plasticidad (η)</span>
</span><span id="HebbianESN-55"><a href="#HebbianESN-55"><span class="linenos"> 55</span></a><span class="sd">            plasticity_type: &#39;hebbian&#39;, &#39;stdp&#39;, o &#39;anti_hebbian&#39;</span>
</span><span id="HebbianESN-56"><a href="#HebbianESN-56"><span class="linenos"> 56</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HebbianESN-57"><a href="#HebbianESN-57"><span class="linenos"> 57</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="HebbianESN-58"><a href="#HebbianESN-58"><span class="linenos"> 58</span></a>            <span class="n">n_inputs</span><span class="o">=</span><span class="n">n_inputs</span><span class="p">,</span>
</span><span id="HebbianESN-59"><a href="#HebbianESN-59"><span class="linenos"> 59</span></a>            <span class="n">n_reservoir</span><span class="o">=</span><span class="n">n_reservoir</span><span class="p">,</span>
</span><span id="HebbianESN-60"><a href="#HebbianESN-60"><span class="linenos"> 60</span></a>            <span class="n">n_outputs</span><span class="o">=</span><span class="n">n_outputs</span><span class="p">,</span>
</span><span id="HebbianESN-61"><a href="#HebbianESN-61"><span class="linenos"> 61</span></a>            <span class="n">spectral_radius</span><span class="o">=</span><span class="n">spectral_radius</span><span class="p">,</span>
</span><span id="HebbianESN-62"><a href="#HebbianESN-62"><span class="linenos"> 62</span></a>            <span class="n">sparsity</span><span class="o">=</span><span class="n">sparsity</span><span class="p">,</span>
</span><span id="HebbianESN-63"><a href="#HebbianESN-63"><span class="linenos"> 63</span></a>            <span class="n">noise</span><span class="o">=</span><span class="n">noise</span><span class="p">,</span>
</span><span id="HebbianESN-64"><a href="#HebbianESN-64"><span class="linenos"> 64</span></a>            <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span>
</span><span id="HebbianESN-65"><a href="#HebbianESN-65"><span class="linenos"> 65</span></a>        <span class="p">)</span>
</span><span id="HebbianESN-66"><a href="#HebbianESN-66"><span class="linenos"> 66</span></a>        
</span><span id="HebbianESN-67"><a href="#HebbianESN-67"><span class="linenos"> 67</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">learning_rate</span> <span class="o">=</span> <span class="n">learning_rate</span>
</span><span id="HebbianESN-68"><a href="#HebbianESN-68"><span class="linenos"> 68</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">plasticity_type</span> <span class="o">=</span> <span class="n">plasticity_type</span>
</span><span id="HebbianESN-69"><a href="#HebbianESN-69"><span class="linenos"> 69</span></a>        
</span><span id="HebbianESN-70"><a href="#HebbianESN-70"><span class="linenos"> 70</span></a>        <span class="c1"># Estado previo para STDP</span>
</span><span id="HebbianESN-71"><a href="#HebbianESN-71"><span class="linenos"> 71</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_prev_state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_reservoir</span><span class="p">)</span>
</span><span id="HebbianESN-72"><a href="#HebbianESN-72"><span class="linenos"> 72</span></a>        
</span><span id="HebbianESN-73"><a href="#HebbianESN-73"><span class="linenos"> 73</span></a>        <span class="c1"># Historial para análisis</span>
</span><span id="HebbianESN-74"><a href="#HebbianESN-74"><span class="linenos"> 74</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">weight_history</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="HebbianESN-75"><a href="#HebbianESN-75"><span class="linenos"> 75</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_adaptation_count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="HebbianESN-76"><a href="#HebbianESN-76"><span class="linenos"> 76</span></a>        
</span><span id="HebbianESN-77"><a href="#HebbianESN-77"><span class="linenos"> 77</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_hebbian_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pre</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">post</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="HebbianESN-78"><a href="#HebbianESN-78"><span class="linenos"> 78</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HebbianESN-79"><a href="#HebbianESN-79"><span class="linenos"> 79</span></a><span class="sd">        Regla de Hebb clásica: Δw = η * pre * post</span>
</span><span id="HebbianESN-80"><a href="#HebbianESN-80"><span class="linenos"> 80</span></a><span class="sd">        </span>
</span><span id="HebbianESN-81"><a href="#HebbianESN-81"><span class="linenos"> 81</span></a><span class="sd">        Las conexiones se fortalecen cuando ambas neuronas están activas.</span>
</span><span id="HebbianESN-82"><a href="#HebbianESN-82"><span class="linenos"> 82</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HebbianESN-83"><a href="#HebbianESN-83"><span class="linenos"> 83</span></a>        <span class="c1"># Producto exterior: matriz de correlaciones</span>
</span><span id="HebbianESN-84"><a href="#HebbianESN-84"><span class="linenos"> 84</span></a>        <span class="n">delta_w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">learning_rate</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">post</span><span class="p">,</span> <span class="n">pre</span><span class="p">)</span>
</span><span id="HebbianESN-85"><a href="#HebbianESN-85"><span class="linenos"> 85</span></a>        <span class="k">return</span> <span class="n">delta_w</span>
</span><span id="HebbianESN-86"><a href="#HebbianESN-86"><span class="linenos"> 86</span></a>    
</span><span id="HebbianESN-87"><a href="#HebbianESN-87"><span class="linenos"> 87</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_stdp_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pre</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">post</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> 
</span><span id="HebbianESN-88"><a href="#HebbianESN-88"><span class="linenos"> 88</span></a>                     <span class="n">prev_pre</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">prev_post</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="HebbianESN-89"><a href="#HebbianESN-89"><span class="linenos"> 89</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HebbianESN-90"><a href="#HebbianESN-90"><span class="linenos"> 90</span></a><span class="sd">        Spike-Timing-Dependent Plasticity simplificado.</span>
</span><span id="HebbianESN-91"><a href="#HebbianESN-91"><span class="linenos"> 91</span></a><span class="sd">        </span>
</span><span id="HebbianESN-92"><a href="#HebbianESN-92"><span class="linenos"> 92</span></a><span class="sd">        - Si post se activa DESPUÉS de pre: LTP (potenciación)</span>
</span><span id="HebbianESN-93"><a href="#HebbianESN-93"><span class="linenos"> 93</span></a><span class="sd">        - Si post se activa ANTES de pre: LTD (depresión)</span>
</span><span id="HebbianESN-94"><a href="#HebbianESN-94"><span class="linenos"> 94</span></a><span class="sd">        </span>
</span><span id="HebbianESN-95"><a href="#HebbianESN-95"><span class="linenos"> 95</span></a><span class="sd">        Este esquema refleja la causalidad temporal en el aprendizaje.</span>
</span><span id="HebbianESN-96"><a href="#HebbianESN-96"><span class="linenos"> 96</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HebbianESN-97"><a href="#HebbianESN-97"><span class="linenos"> 97</span></a>        <span class="c1"># Detectar cambios de activación (pseudo-spikes)</span>
</span><span id="HebbianESN-98"><a href="#HebbianESN-98"><span class="linenos"> 98</span></a>        <span class="n">pre_became_active</span> <span class="o">=</span> <span class="p">(</span><span class="n">pre</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">prev_pre</span> <span class="o">&lt;=</span> <span class="mf">0.5</span><span class="p">)</span>
</span><span id="HebbianESN-99"><a href="#HebbianESN-99"><span class="linenos"> 99</span></a>        <span class="n">post_became_active</span> <span class="o">=</span> <span class="p">(</span><span class="n">post</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">prev_post</span> <span class="o">&lt;=</span> <span class="mf">0.5</span><span class="p">)</span>
</span><span id="HebbianESN-100"><a href="#HebbianESN-100"><span class="linenos">100</span></a>        
</span><span id="HebbianESN-101"><a href="#HebbianESN-101"><span class="linenos">101</span></a>        <span class="c1"># LTP: post después de pre</span>
</span><span id="HebbianESN-102"><a href="#HebbianESN-102"><span class="linenos">102</span></a>        <span class="n">ltp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">post_became_active</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">),</span> <span class="n">pre</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">))</span>
</span><span id="HebbianESN-103"><a href="#HebbianESN-103"><span class="linenos">103</span></a>        
</span><span id="HebbianESN-104"><a href="#HebbianESN-104"><span class="linenos">104</span></a>        <span class="c1"># LTD: pre después de post</span>
</span><span id="HebbianESN-105"><a href="#HebbianESN-105"><span class="linenos">105</span></a>        <span class="n">ltd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">),</span> <span class="n">pre_became_active</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">))</span>
</span><span id="HebbianESN-106"><a href="#HebbianESN-106"><span class="linenos">106</span></a>        
</span><span id="HebbianESN-107"><a href="#HebbianESN-107"><span class="linenos">107</span></a>        <span class="n">delta_w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">learning_rate</span> <span class="o">*</span> <span class="p">(</span><span class="n">ltp</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">ltd</span><span class="p">)</span>
</span><span id="HebbianESN-108"><a href="#HebbianESN-108"><span class="linenos">108</span></a>        <span class="k">return</span> <span class="n">delta_w</span>
</span><span id="HebbianESN-109"><a href="#HebbianESN-109"><span class="linenos">109</span></a>    
</span><span id="HebbianESN-110"><a href="#HebbianESN-110"><span class="linenos">110</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_anti_hebbian_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pre</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">post</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="HebbianESN-111"><a href="#HebbianESN-111"><span class="linenos">111</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HebbianESN-112"><a href="#HebbianESN-112"><span class="linenos">112</span></a><span class="sd">        Plasticidad anti-Hebbiana: Δw = -η * pre * post</span>
</span><span id="HebbianESN-113"><a href="#HebbianESN-113"><span class="linenos">113</span></a><span class="sd">        </span>
</span><span id="HebbianESN-114"><a href="#HebbianESN-114"><span class="linenos">114</span></a><span class="sd">        Las conexiones se DEBILITAN cuando ambas neuronas están activas.</span>
</span><span id="HebbianESN-115"><a href="#HebbianESN-115"><span class="linenos">115</span></a><span class="sd">        Promueve diversificación de representaciones y evita saturación.</span>
</span><span id="HebbianESN-116"><a href="#HebbianESN-116"><span class="linenos">116</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HebbianESN-117"><a href="#HebbianESN-117"><span class="linenos">117</span></a>        <span class="n">delta_w</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">learning_rate</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">post</span><span class="p">,</span> <span class="n">pre</span><span class="p">)</span>
</span><span id="HebbianESN-118"><a href="#HebbianESN-118"><span class="linenos">118</span></a>        <span class="k">return</span> <span class="n">delta_w</span>
</span><span id="HebbianESN-119"><a href="#HebbianESN-119"><span class="linenos">119</span></a>    
</span><span id="HebbianESN-120"><a href="#HebbianESN-120"><span class="linenos">120</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_plasticity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_vector</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">new_state</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span><span id="HebbianESN-121"><a href="#HebbianESN-121"><span class="linenos">121</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HebbianESN-122"><a href="#HebbianESN-122"><span class="linenos">122</span></a><span class="sd">        Aplica la regla de plasticidad seleccionada al reservoir.</span>
</span><span id="HebbianESN-123"><a href="#HebbianESN-123"><span class="linenos">123</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HebbianESN-124"><a href="#HebbianESN-124"><span class="linenos">124</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plasticity_type</span> <span class="o">==</span> <span class="s1">&#39;hebbian&#39;</span><span class="p">:</span>
</span><span id="HebbianESN-125"><a href="#HebbianESN-125"><span class="linenos">125</span></a>            <span class="n">delta_w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hebbian_update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_prev_state</span><span class="p">,</span> <span class="n">new_state</span><span class="p">)</span>
</span><span id="HebbianESN-126"><a href="#HebbianESN-126"><span class="linenos">126</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">plasticity_type</span> <span class="o">==</span> <span class="s1">&#39;stdp&#39;</span><span class="p">:</span>
</span><span id="HebbianESN-127"><a href="#HebbianESN-127"><span class="linenos">127</span></a>            <span class="c1"># Para STDP necesitamos acceso al input previo</span>
</span><span id="HebbianESN-128"><a href="#HebbianESN-128"><span class="linenos">128</span></a>            <span class="n">delta_w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stdp_update</span><span class="p">(</span>
</span><span id="HebbianESN-129"><a href="#HebbianESN-129"><span class="linenos">129</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_prev_state</span><span class="p">,</span> <span class="n">new_state</span><span class="p">,</span>
</span><span id="HebbianESN-130"><a href="#HebbianESN-130"><span class="linenos">130</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_prev_state</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span>  <span class="c1"># Aproximación</span>
</span><span id="HebbianESN-131"><a href="#HebbianESN-131"><span class="linenos">131</span></a>            <span class="p">)</span>
</span><span id="HebbianESN-132"><a href="#HebbianESN-132"><span class="linenos">132</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">plasticity_type</span> <span class="o">==</span> <span class="s1">&#39;anti_hebbian&#39;</span><span class="p">:</span>
</span><span id="HebbianESN-133"><a href="#HebbianESN-133"><span class="linenos">133</span></a>            <span class="n">delta_w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_anti_hebbian_update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_prev_state</span><span class="p">,</span> <span class="n">new_state</span><span class="p">)</span>
</span><span id="HebbianESN-134"><a href="#HebbianESN-134"><span class="linenos">134</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="HebbianESN-135"><a href="#HebbianESN-135"><span class="linenos">135</span></a>            <span class="k">return</span>
</span><span id="HebbianESN-136"><a href="#HebbianESN-136"><span class="linenos">136</span></a>        
</span><span id="HebbianESN-137"><a href="#HebbianESN-137"><span class="linenos">137</span></a>        <span class="c1"># Aplicar actualización manteniendo la máscara de escasez</span>
</span><span id="HebbianESN-138"><a href="#HebbianESN-138"><span class="linenos">138</span></a>        <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="HebbianESN-139"><a href="#HebbianESN-139"><span class="linenos">139</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span> <span class="o">+=</span> <span class="n">delta_w</span> <span class="o">*</span> <span class="n">mask</span>
</span><span id="HebbianESN-140"><a href="#HebbianESN-140"><span class="linenos">140</span></a>        
</span><span id="HebbianESN-141"><a href="#HebbianESN-141"><span class="linenos">141</span></a>        <span class="c1"># Mantener radio espectral bajo control (estabilidad)</span>
</span><span id="HebbianESN-142"><a href="#HebbianESN-142"><span class="linenos">142</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_spectral_radius</span><span class="p">()</span>
</span><span id="HebbianESN-143"><a href="#HebbianESN-143"><span class="linenos">143</span></a>        
</span><span id="HebbianESN-144"><a href="#HebbianESN-144"><span class="linenos">144</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_adaptation_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="HebbianESN-145"><a href="#HebbianESN-145"><span class="linenos">145</span></a>        
</span><span id="HebbianESN-146"><a href="#HebbianESN-146"><span class="linenos">146</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_normalize_spectral_radius</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="HebbianESN-147"><a href="#HebbianESN-147"><span class="linenos">147</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Renormaliza el reservoir para mantener estabilidad.&quot;&quot;&quot;</span>
</span><span id="HebbianESN-148"><a href="#HebbianESN-148"><span class="linenos">148</span></a>        <span class="n">eigenvalues</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigvals</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span><span class="p">))</span>
</span><span id="HebbianESN-149"><a href="#HebbianESN-149"><span class="linenos">149</span></a>        <span class="n">current_radius</span> <span class="o">=</span> <span class="n">eigenvalues</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="HebbianESN-150"><a href="#HebbianESN-150"><span class="linenos">150</span></a>        
</span><span id="HebbianESN-151"><a href="#HebbianESN-151"><span class="linenos">151</span></a>        <span class="k">if</span> <span class="n">current_radius</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectral_radius</span> <span class="o">*</span> <span class="mf">1.1</span><span class="p">:</span>  <span class="c1"># 10% tolerancia</span>
</span><span id="HebbianESN-152"><a href="#HebbianESN-152"><span class="linenos">152</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectral_radius</span> <span class="o">/</span> <span class="n">current_radius</span>
</span><span id="HebbianESN-153"><a href="#HebbianESN-153"><span class="linenos">153</span></a>    
</span><span id="HebbianESN-154"><a href="#HebbianESN-154"><span class="linenos">154</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_update_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_vector</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="HebbianESN-155"><a href="#HebbianESN-155"><span class="linenos">155</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HebbianESN-156"><a href="#HebbianESN-156"><span class="linenos">156</span></a><span class="sd">        Actualiza estado con plasticidad opcional.</span>
</span><span id="HebbianESN-157"><a href="#HebbianESN-157"><span class="linenos">157</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HebbianESN-158"><a href="#HebbianESN-158"><span class="linenos">158</span></a>        <span class="c1"># Guardar estado previo para STDP</span>
</span><span id="HebbianESN-159"><a href="#HebbianESN-159"><span class="linenos">159</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_prev_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="HebbianESN-160"><a href="#HebbianESN-160"><span class="linenos">160</span></a>        
</span><span id="HebbianESN-161"><a href="#HebbianESN-161"><span class="linenos">161</span></a>        <span class="c1"># Actualización estándar</span>
</span><span id="HebbianESN-162"><a href="#HebbianESN-162"><span class="linenos">162</span></a>        <span class="n">new_state</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_update_state</span><span class="p">(</span><span class="n">input_vector</span><span class="p">)</span>
</span><span id="HebbianESN-163"><a href="#HebbianESN-163"><span class="linenos">163</span></a>        
</span><span id="HebbianESN-164"><a href="#HebbianESN-164"><span class="linenos">164</span></a>        <span class="c1"># Aplicar plasticidad</span>
</span><span id="HebbianESN-165"><a href="#HebbianESN-165"><span class="linenos">165</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_apply_plasticity</span><span class="p">(</span><span class="n">input_vector</span><span class="p">,</span> <span class="n">new_state</span><span class="p">)</span>
</span><span id="HebbianESN-166"><a href="#HebbianESN-166"><span class="linenos">166</span></a>        
</span><span id="HebbianESN-167"><a href="#HebbianESN-167"><span class="linenos">167</span></a>        <span class="k">return</span> <span class="n">new_state</span>
</span><span id="HebbianESN-168"><a href="#HebbianESN-168"><span class="linenos">168</span></a>    
</span><span id="HebbianESN-169"><a href="#HebbianESN-169"><span class="linenos">169</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">adapt_online</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">record_weights</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;HebbianESN&#39;</span><span class="p">:</span>
</span><span id="HebbianESN-170"><a href="#HebbianESN-170"><span class="linenos">170</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HebbianESN-171"><a href="#HebbianESN-171"><span class="linenos">171</span></a><span class="sd">        Adaptación continua online sin target explícito.</span>
</span><span id="HebbianESN-172"><a href="#HebbianESN-172"><span class="linenos">172</span></a><span class="sd">        </span>
</span><span id="HebbianESN-173"><a href="#HebbianESN-173"><span class="linenos">173</span></a><span class="sd">        El reservoir se adapta basándose solo en correlaciones de actividad.</span>
</span><span id="HebbianESN-174"><a href="#HebbianESN-174"><span class="linenos">174</span></a><span class="sd">        Esto simula aprendizaje no supervisado continuo.</span>
</span><span id="HebbianESN-175"><a href="#HebbianESN-175"><span class="linenos">175</span></a><span class="sd">        </span>
</span><span id="HebbianESN-176"><a href="#HebbianESN-176"><span class="linenos">176</span></a><span class="sd">        Args:</span>
</span><span id="HebbianESN-177"><a href="#HebbianESN-177"><span class="linenos">177</span></a><span class="sd">            inputs: Secuencia de entrada</span>
</span><span id="HebbianESN-178"><a href="#HebbianESN-178"><span class="linenos">178</span></a><span class="sd">            record_weights: Si guardar historial de pesos</span>
</span><span id="HebbianESN-179"><a href="#HebbianESN-179"><span class="linenos">179</span></a><span class="sd">            </span>
</span><span id="HebbianESN-180"><a href="#HebbianESN-180"><span class="linenos">180</span></a><span class="sd">        Returns:</span>
</span><span id="HebbianESN-181"><a href="#HebbianESN-181"><span class="linenos">181</span></a><span class="sd">            self</span>
</span><span id="HebbianESN-182"><a href="#HebbianESN-182"><span class="linenos">182</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HebbianESN-183"><a href="#HebbianESN-183"><span class="linenos">183</span></a>        <span class="n">T</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="HebbianESN-184"><a href="#HebbianESN-184"><span class="linenos">184</span></a>        
</span><span id="HebbianESN-185"><a href="#HebbianESN-185"><span class="linenos">185</span></a>        <span class="k">if</span> <span class="n">inputs</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="HebbianESN-186"><a href="#HebbianESN-186"><span class="linenos">186</span></a>            <span class="n">inputs</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="HebbianESN-187"><a href="#HebbianESN-187"><span class="linenos">187</span></a>        
</span><span id="HebbianESN-188"><a href="#HebbianESN-188"><span class="linenos">188</span></a>        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">):</span>
</span><span id="HebbianESN-189"><a href="#HebbianESN-189"><span class="linenos">189</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_state</span><span class="p">(</span><span class="n">inputs</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
</span><span id="HebbianESN-190"><a href="#HebbianESN-190"><span class="linenos">190</span></a>            
</span><span id="HebbianESN-191"><a href="#HebbianESN-191"><span class="linenos">191</span></a>            <span class="k">if</span> <span class="n">record_weights</span> <span class="ow">and</span> <span class="n">t</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="HebbianESN-192"><a href="#HebbianESN-192"><span class="linenos">192</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">weight_history</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="HebbianESN-193"><a href="#HebbianESN-193"><span class="linenos">193</span></a>                    <span class="s1">&#39;step&#39;</span><span class="p">:</span> <span class="n">t</span><span class="p">,</span>
</span><span id="HebbianESN-194"><a href="#HebbianESN-194"><span class="linenos">194</span></a>                    <span class="s1">&#39;mean_weight&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span><span class="p">)),</span>
</span><span id="HebbianESN-195"><a href="#HebbianESN-195"><span class="linenos">195</span></a>                    <span class="s1">&#39;max_weight&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span><span class="p">)),</span>
</span><span id="HebbianESN-196"><a href="#HebbianESN-196"><span class="linenos">196</span></a>                    <span class="s1">&#39;sparsity&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="HebbianESN-197"><a href="#HebbianESN-197"><span class="linenos">197</span></a>                <span class="p">})</span>
</span><span id="HebbianESN-198"><a href="#HebbianESN-198"><span class="linenos">198</span></a>        
</span><span id="HebbianESN-199"><a href="#HebbianESN-199"><span class="linenos">199</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="HebbianESN-200"><a href="#HebbianESN-200"><span class="linenos">200</span></a>    
</span><span id="HebbianESN-201"><a href="#HebbianESN-201"><span class="linenos">201</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_adaptation_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="HebbianESN-202"><a href="#HebbianESN-202"><span class="linenos">202</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Retorna estadísticas de la adaptación.&quot;&quot;&quot;</span>
</span><span id="HebbianESN-203"><a href="#HebbianESN-203"><span class="linenos">203</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="HebbianESN-204"><a href="#HebbianESN-204"><span class="linenos">204</span></a>            <span class="s1">&#39;total_adaptations&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_adaptation_count</span><span class="p">,</span>
</span><span id="HebbianESN-205"><a href="#HebbianESN-205"><span class="linenos">205</span></a>            <span class="s1">&#39;current_mean_weight&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span><span class="p">)),</span>
</span><span id="HebbianESN-206"><a href="#HebbianESN-206"><span class="linenos">206</span></a>            <span class="s1">&#39;current_max_weight&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span><span class="p">)),</span>
</span><span id="HebbianESN-207"><a href="#HebbianESN-207"><span class="linenos">207</span></a>            <span class="s1">&#39;current_sparsity&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span> <span class="o">==</span> <span class="mi">0</span><span class="p">),</span>
</span><span id="HebbianESN-208"><a href="#HebbianESN-208"><span class="linenos">208</span></a>            <span class="s1">&#39;weight_history&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight_history</span>
</span><span id="HebbianESN-209"><a href="#HebbianESN-209"><span class="linenos">209</span></a>        <span class="p">}</span>
</span><span id="HebbianESN-210"><a href="#HebbianESN-210"><span class="linenos">210</span></a>    
</span><span id="HebbianESN-211"><a href="#HebbianESN-211"><span class="linenos">211</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">reset_plasticity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="HebbianESN-212"><a href="#HebbianESN-212"><span class="linenos">212</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Resetea contadores de plasticidad (no los pesos).&quot;&quot;&quot;</span>
</span><span id="HebbianESN-213"><a href="#HebbianESN-213"><span class="linenos">213</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_prev_state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_reservoir</span><span class="p">)</span>
</span><span id="HebbianESN-214"><a href="#HebbianESN-214"><span class="linenos">214</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">weight_history</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="HebbianESN-215"><a href="#HebbianESN-215"><span class="linenos">215</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_adaptation_count</span> <span class="o">=</span> <span class="mi">0</span>
</span></pre></div>


            <div class="docstring"><p>ESN con plasticidad Hebbiana para aprendizaje continuo.</p>

<p>A diferencia del ESN estándar donde el reservoir es estático,
esta versión permite que las conexiones del reservoir se
adapten gradualmente según la actividad, emulando la plasticidad
sináptica biológica.</p>

<p>Tipos de plasticidad soportados:</p>

<ul>
<li>Hebb clásico: Δw = η * pre * post</li>
<li>STDP simplificado: considera timing entre activaciones</li>
<li>Anti-Hebbiano: para diversificar representaciones</li>
</ul>
</div>


                            <div id="HebbianESN.__init__" class="classattr">
                                        <input id="HebbianESN.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">HebbianESN</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">n_inputs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">n_reservoir</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span>,</span><span class="param">	<span class="n">n_outputs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">spectral_radius</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.9</span>,</span><span class="param">	<span class="n">sparsity</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.9</span>,</span><span class="param">	<span class="n">noise</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.001</span>,</span><span class="param">	<span class="n">learning_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.001</span>,</span><span class="param">	<span class="n">plasticity_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;hebbian&#39;</span>,</span><span class="param">	<span class="n">random_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="HebbianESN.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HebbianESN.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HebbianESN.__init__-38"><a href="#HebbianESN.__init__-38"><span class="linenos">38</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="HebbianESN.__init__-39"><a href="#HebbianESN.__init__-39"><span class="linenos">39</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="HebbianESN.__init__-40"><a href="#HebbianESN.__init__-40"><span class="linenos">40</span></a>        <span class="n">n_inputs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="HebbianESN.__init__-41"><a href="#HebbianESN.__init__-41"><span class="linenos">41</span></a>        <span class="n">n_reservoir</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
</span><span id="HebbianESN.__init__-42"><a href="#HebbianESN.__init__-42"><span class="linenos">42</span></a>        <span class="n">n_outputs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="HebbianESN.__init__-43"><a href="#HebbianESN.__init__-43"><span class="linenos">43</span></a>        <span class="n">spectral_radius</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span>
</span><span id="HebbianESN.__init__-44"><a href="#HebbianESN.__init__-44"><span class="linenos">44</span></a>        <span class="n">sparsity</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span>
</span><span id="HebbianESN.__init__-45"><a href="#HebbianESN.__init__-45"><span class="linenos">45</span></a>        <span class="n">noise</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">,</span>
</span><span id="HebbianESN.__init__-46"><a href="#HebbianESN.__init__-46"><span class="linenos">46</span></a>        <span class="n">learning_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">,</span>
</span><span id="HebbianESN.__init__-47"><a href="#HebbianESN.__init__-47"><span class="linenos">47</span></a>        <span class="n">plasticity_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;hebbian&#39;</span><span class="p">,</span>
</span><span id="HebbianESN.__init__-48"><a href="#HebbianESN.__init__-48"><span class="linenos">48</span></a>        <span class="n">random_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="HebbianESN.__init__-49"><a href="#HebbianESN.__init__-49"><span class="linenos">49</span></a>    <span class="p">):</span>
</span><span id="HebbianESN.__init__-50"><a href="#HebbianESN.__init__-50"><span class="linenos">50</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HebbianESN.__init__-51"><a href="#HebbianESN.__init__-51"><span class="linenos">51</span></a><span class="sd">        Inicializa ESN con plasticidad.</span>
</span><span id="HebbianESN.__init__-52"><a href="#HebbianESN.__init__-52"><span class="linenos">52</span></a><span class="sd">        </span>
</span><span id="HebbianESN.__init__-53"><a href="#HebbianESN.__init__-53"><span class="linenos">53</span></a><span class="sd">        Args:</span>
</span><span id="HebbianESN.__init__-54"><a href="#HebbianESN.__init__-54"><span class="linenos">54</span></a><span class="sd">            learning_rate: Tasa de aprendizaje para plasticidad (η)</span>
</span><span id="HebbianESN.__init__-55"><a href="#HebbianESN.__init__-55"><span class="linenos">55</span></a><span class="sd">            plasticity_type: &#39;hebbian&#39;, &#39;stdp&#39;, o &#39;anti_hebbian&#39;</span>
</span><span id="HebbianESN.__init__-56"><a href="#HebbianESN.__init__-56"><span class="linenos">56</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HebbianESN.__init__-57"><a href="#HebbianESN.__init__-57"><span class="linenos">57</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="HebbianESN.__init__-58"><a href="#HebbianESN.__init__-58"><span class="linenos">58</span></a>            <span class="n">n_inputs</span><span class="o">=</span><span class="n">n_inputs</span><span class="p">,</span>
</span><span id="HebbianESN.__init__-59"><a href="#HebbianESN.__init__-59"><span class="linenos">59</span></a>            <span class="n">n_reservoir</span><span class="o">=</span><span class="n">n_reservoir</span><span class="p">,</span>
</span><span id="HebbianESN.__init__-60"><a href="#HebbianESN.__init__-60"><span class="linenos">60</span></a>            <span class="n">n_outputs</span><span class="o">=</span><span class="n">n_outputs</span><span class="p">,</span>
</span><span id="HebbianESN.__init__-61"><a href="#HebbianESN.__init__-61"><span class="linenos">61</span></a>            <span class="n">spectral_radius</span><span class="o">=</span><span class="n">spectral_radius</span><span class="p">,</span>
</span><span id="HebbianESN.__init__-62"><a href="#HebbianESN.__init__-62"><span class="linenos">62</span></a>            <span class="n">sparsity</span><span class="o">=</span><span class="n">sparsity</span><span class="p">,</span>
</span><span id="HebbianESN.__init__-63"><a href="#HebbianESN.__init__-63"><span class="linenos">63</span></a>            <span class="n">noise</span><span class="o">=</span><span class="n">noise</span><span class="p">,</span>
</span><span id="HebbianESN.__init__-64"><a href="#HebbianESN.__init__-64"><span class="linenos">64</span></a>            <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span>
</span><span id="HebbianESN.__init__-65"><a href="#HebbianESN.__init__-65"><span class="linenos">65</span></a>        <span class="p">)</span>
</span><span id="HebbianESN.__init__-66"><a href="#HebbianESN.__init__-66"><span class="linenos">66</span></a>        
</span><span id="HebbianESN.__init__-67"><a href="#HebbianESN.__init__-67"><span class="linenos">67</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">learning_rate</span> <span class="o">=</span> <span class="n">learning_rate</span>
</span><span id="HebbianESN.__init__-68"><a href="#HebbianESN.__init__-68"><span class="linenos">68</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">plasticity_type</span> <span class="o">=</span> <span class="n">plasticity_type</span>
</span><span id="HebbianESN.__init__-69"><a href="#HebbianESN.__init__-69"><span class="linenos">69</span></a>        
</span><span id="HebbianESN.__init__-70"><a href="#HebbianESN.__init__-70"><span class="linenos">70</span></a>        <span class="c1"># Estado previo para STDP</span>
</span><span id="HebbianESN.__init__-71"><a href="#HebbianESN.__init__-71"><span class="linenos">71</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_prev_state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_reservoir</span><span class="p">)</span>
</span><span id="HebbianESN.__init__-72"><a href="#HebbianESN.__init__-72"><span class="linenos">72</span></a>        
</span><span id="HebbianESN.__init__-73"><a href="#HebbianESN.__init__-73"><span class="linenos">73</span></a>        <span class="c1"># Historial para análisis</span>
</span><span id="HebbianESN.__init__-74"><a href="#HebbianESN.__init__-74"><span class="linenos">74</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">weight_history</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="HebbianESN.__init__-75"><a href="#HebbianESN.__init__-75"><span class="linenos">75</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_adaptation_count</span> <span class="o">=</span> <span class="mi">0</span>
</span></pre></div>


            <div class="docstring"><p>Inicializa ESN con plasticidad.</p>

<p>Args:
    learning_rate: Tasa de aprendizaje para plasticidad (η)
    plasticity_type: 'hebbian', 'stdp', o 'anti_hebbian'</p>
</div>


                            </div>
                            <div id="HebbianESN.learning_rate" class="classattr">
                                <div class="attr variable">
            <span class="name">learning_rate</span>

        
    </div>
    <a class="headerlink" href="#HebbianESN.learning_rate"></a>
    
    

                            </div>
                            <div id="HebbianESN.plasticity_type" class="classattr">
                                <div class="attr variable">
            <span class="name">plasticity_type</span>

        
    </div>
    <a class="headerlink" href="#HebbianESN.plasticity_type"></a>
    
    

                            </div>
                            <div id="HebbianESN.weight_history" class="classattr">
                                <div class="attr variable">
            <span class="name">weight_history</span>

        
    </div>
    <a class="headerlink" href="#HebbianESN.weight_history"></a>
    
    

                            </div>
                            <div id="HebbianESN.adapt_online" class="classattr">
                                        <input id="HebbianESN.adapt_online-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">adapt_online</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">inputs</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>,</span><span class="param">	<span class="n">record_weights</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="n"><a href="#HebbianESN">HebbianESN</a></span>:</span></span>

                <label class="view-source-button" for="HebbianESN.adapt_online-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HebbianESN.adapt_online"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HebbianESN.adapt_online-169"><a href="#HebbianESN.adapt_online-169"><span class="linenos">169</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">adapt_online</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">record_weights</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;HebbianESN&#39;</span><span class="p">:</span>
</span><span id="HebbianESN.adapt_online-170"><a href="#HebbianESN.adapt_online-170"><span class="linenos">170</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HebbianESN.adapt_online-171"><a href="#HebbianESN.adapt_online-171"><span class="linenos">171</span></a><span class="sd">        Adaptación continua online sin target explícito.</span>
</span><span id="HebbianESN.adapt_online-172"><a href="#HebbianESN.adapt_online-172"><span class="linenos">172</span></a><span class="sd">        </span>
</span><span id="HebbianESN.adapt_online-173"><a href="#HebbianESN.adapt_online-173"><span class="linenos">173</span></a><span class="sd">        El reservoir se adapta basándose solo en correlaciones de actividad.</span>
</span><span id="HebbianESN.adapt_online-174"><a href="#HebbianESN.adapt_online-174"><span class="linenos">174</span></a><span class="sd">        Esto simula aprendizaje no supervisado continuo.</span>
</span><span id="HebbianESN.adapt_online-175"><a href="#HebbianESN.adapt_online-175"><span class="linenos">175</span></a><span class="sd">        </span>
</span><span id="HebbianESN.adapt_online-176"><a href="#HebbianESN.adapt_online-176"><span class="linenos">176</span></a><span class="sd">        Args:</span>
</span><span id="HebbianESN.adapt_online-177"><a href="#HebbianESN.adapt_online-177"><span class="linenos">177</span></a><span class="sd">            inputs: Secuencia de entrada</span>
</span><span id="HebbianESN.adapt_online-178"><a href="#HebbianESN.adapt_online-178"><span class="linenos">178</span></a><span class="sd">            record_weights: Si guardar historial de pesos</span>
</span><span id="HebbianESN.adapt_online-179"><a href="#HebbianESN.adapt_online-179"><span class="linenos">179</span></a><span class="sd">            </span>
</span><span id="HebbianESN.adapt_online-180"><a href="#HebbianESN.adapt_online-180"><span class="linenos">180</span></a><span class="sd">        Returns:</span>
</span><span id="HebbianESN.adapt_online-181"><a href="#HebbianESN.adapt_online-181"><span class="linenos">181</span></a><span class="sd">            self</span>
</span><span id="HebbianESN.adapt_online-182"><a href="#HebbianESN.adapt_online-182"><span class="linenos">182</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HebbianESN.adapt_online-183"><a href="#HebbianESN.adapt_online-183"><span class="linenos">183</span></a>        <span class="n">T</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="HebbianESN.adapt_online-184"><a href="#HebbianESN.adapt_online-184"><span class="linenos">184</span></a>        
</span><span id="HebbianESN.adapt_online-185"><a href="#HebbianESN.adapt_online-185"><span class="linenos">185</span></a>        <span class="k">if</span> <span class="n">inputs</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="HebbianESN.adapt_online-186"><a href="#HebbianESN.adapt_online-186"><span class="linenos">186</span></a>            <span class="n">inputs</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="HebbianESN.adapt_online-187"><a href="#HebbianESN.adapt_online-187"><span class="linenos">187</span></a>        
</span><span id="HebbianESN.adapt_online-188"><a href="#HebbianESN.adapt_online-188"><span class="linenos">188</span></a>        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">):</span>
</span><span id="HebbianESN.adapt_online-189"><a href="#HebbianESN.adapt_online-189"><span class="linenos">189</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_state</span><span class="p">(</span><span class="n">inputs</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
</span><span id="HebbianESN.adapt_online-190"><a href="#HebbianESN.adapt_online-190"><span class="linenos">190</span></a>            
</span><span id="HebbianESN.adapt_online-191"><a href="#HebbianESN.adapt_online-191"><span class="linenos">191</span></a>            <span class="k">if</span> <span class="n">record_weights</span> <span class="ow">and</span> <span class="n">t</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="HebbianESN.adapt_online-192"><a href="#HebbianESN.adapt_online-192"><span class="linenos">192</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">weight_history</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="HebbianESN.adapt_online-193"><a href="#HebbianESN.adapt_online-193"><span class="linenos">193</span></a>                    <span class="s1">&#39;step&#39;</span><span class="p">:</span> <span class="n">t</span><span class="p">,</span>
</span><span id="HebbianESN.adapt_online-194"><a href="#HebbianESN.adapt_online-194"><span class="linenos">194</span></a>                    <span class="s1">&#39;mean_weight&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span><span class="p">)),</span>
</span><span id="HebbianESN.adapt_online-195"><a href="#HebbianESN.adapt_online-195"><span class="linenos">195</span></a>                    <span class="s1">&#39;max_weight&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span><span class="p">)),</span>
</span><span id="HebbianESN.adapt_online-196"><a href="#HebbianESN.adapt_online-196"><span class="linenos">196</span></a>                    <span class="s1">&#39;sparsity&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="HebbianESN.adapt_online-197"><a href="#HebbianESN.adapt_online-197"><span class="linenos">197</span></a>                <span class="p">})</span>
</span><span id="HebbianESN.adapt_online-198"><a href="#HebbianESN.adapt_online-198"><span class="linenos">198</span></a>        
</span><span id="HebbianESN.adapt_online-199"><a href="#HebbianESN.adapt_online-199"><span class="linenos">199</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span></pre></div>


            <div class="docstring"><p>Adaptación continua online sin target explícito.</p>

<p>El reservoir se adapta basándose solo en correlaciones de actividad.
Esto simula aprendizaje no supervisado continuo.</p>

<p>Args:
    inputs: Secuencia de entrada
    record_weights: Si guardar historial de pesos</p>

<p>Returns:
    self</p>
</div>


                            </div>
                            <div id="HebbianESN.get_adaptation_stats" class="classattr">
                                        <input id="HebbianESN.get_adaptation_stats-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_adaptation_stats</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">dict</span>:</span></span>

                <label class="view-source-button" for="HebbianESN.get_adaptation_stats-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HebbianESN.get_adaptation_stats"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HebbianESN.get_adaptation_stats-201"><a href="#HebbianESN.get_adaptation_stats-201"><span class="linenos">201</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_adaptation_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="HebbianESN.get_adaptation_stats-202"><a href="#HebbianESN.get_adaptation_stats-202"><span class="linenos">202</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Retorna estadísticas de la adaptación.&quot;&quot;&quot;</span>
</span><span id="HebbianESN.get_adaptation_stats-203"><a href="#HebbianESN.get_adaptation_stats-203"><span class="linenos">203</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="HebbianESN.get_adaptation_stats-204"><a href="#HebbianESN.get_adaptation_stats-204"><span class="linenos">204</span></a>            <span class="s1">&#39;total_adaptations&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_adaptation_count</span><span class="p">,</span>
</span><span id="HebbianESN.get_adaptation_stats-205"><a href="#HebbianESN.get_adaptation_stats-205"><span class="linenos">205</span></a>            <span class="s1">&#39;current_mean_weight&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span><span class="p">)),</span>
</span><span id="HebbianESN.get_adaptation_stats-206"><a href="#HebbianESN.get_adaptation_stats-206"><span class="linenos">206</span></a>            <span class="s1">&#39;current_max_weight&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span><span class="p">)),</span>
</span><span id="HebbianESN.get_adaptation_stats-207"><a href="#HebbianESN.get_adaptation_stats-207"><span class="linenos">207</span></a>            <span class="s1">&#39;current_sparsity&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span> <span class="o">==</span> <span class="mi">0</span><span class="p">),</span>
</span><span id="HebbianESN.get_adaptation_stats-208"><a href="#HebbianESN.get_adaptation_stats-208"><span class="linenos">208</span></a>            <span class="s1">&#39;weight_history&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight_history</span>
</span><span id="HebbianESN.get_adaptation_stats-209"><a href="#HebbianESN.get_adaptation_stats-209"><span class="linenos">209</span></a>        <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Retorna estadísticas de la adaptación.</p>
</div>


                            </div>
                            <div id="HebbianESN.reset_plasticity" class="classattr">
                                        <input id="HebbianESN.reset_plasticity-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">reset_plasticity</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="HebbianESN.reset_plasticity-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HebbianESN.reset_plasticity"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HebbianESN.reset_plasticity-211"><a href="#HebbianESN.reset_plasticity-211"><span class="linenos">211</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">reset_plasticity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="HebbianESN.reset_plasticity-212"><a href="#HebbianESN.reset_plasticity-212"><span class="linenos">212</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Resetea contadores de plasticidad (no los pesos).&quot;&quot;&quot;</span>
</span><span id="HebbianESN.reset_plasticity-213"><a href="#HebbianESN.reset_plasticity-213"><span class="linenos">213</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_prev_state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_reservoir</span><span class="p">)</span>
</span><span id="HebbianESN.reset_plasticity-214"><a href="#HebbianESN.reset_plasticity-214"><span class="linenos">214</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">weight_history</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="HebbianESN.reset_plasticity-215"><a href="#HebbianESN.reset_plasticity-215"><span class="linenos">215</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_adaptation_count</span> <span class="o">=</span> <span class="mi">0</span>
</span></pre></div>


            <div class="docstring"><p>Resetea contadores de plasticidad (no los pesos).</p>
</div>


                            </div>
                </section>
                <section id="compare_plasticity_types">
                            <input id="compare_plasticity_types-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compare_plasticity_types</span><span class="signature pdoc-code condensed">(<span class="return-annotation">):</span></span>

                <label class="view-source-button" for="compare_plasticity_types-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#compare_plasticity_types"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="compare_plasticity_types-218"><a href="#compare_plasticity_types-218"><span class="linenos">218</span></a><span class="k">def</span><span class="w"> </span><span class="nf">compare_plasticity_types</span><span class="p">():</span>
</span><span id="compare_plasticity_types-219"><a href="#compare_plasticity_types-219"><span class="linenos">219</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="compare_plasticity_types-220"><a href="#compare_plasticity_types-220"><span class="linenos">220</span></a><span class="sd">    Compara diferentes tipos de plasticidad.</span>
</span><span id="compare_plasticity_types-221"><a href="#compare_plasticity_types-221"><span class="linenos">221</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="compare_plasticity_types-222"><a href="#compare_plasticity_types-222"><span class="linenos">222</span></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="compare_plasticity_types-223"><a href="#compare_plasticity_types-223"><span class="linenos">223</span></a><span class="s2">╔═══════════════════════════════════════════════════════════════╗</span>
</span><span id="compare_plasticity_types-224"><a href="#compare_plasticity_types-224"><span class="linenos">224</span></a><span class="s2">║         PROYECTO EÓN - Plasticidad Hebbiana                   ║</span>
</span><span id="compare_plasticity_types-225"><a href="#compare_plasticity_types-225"><span class="linenos">225</span></a><span class="s2">║   &quot;Las neuronas que disparan juntas, se conectan juntas&quot;      ║</span>
</span><span id="compare_plasticity_types-226"><a href="#compare_plasticity_types-226"><span class="linenos">226</span></a><span class="s2">╚═══════════════════════════════════════════════════════════════╝</span>
</span><span id="compare_plasticity_types-227"><a href="#compare_plasticity_types-227"><span class="linenos">227</span></a><span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span>
</span><span id="compare_plasticity_types-228"><a href="#compare_plasticity_types-228"><span class="linenos">228</span></a>    
</span><span id="compare_plasticity_types-229"><a href="#compare_plasticity_types-229"><span class="linenos">229</span></a>    <span class="c1"># Generar datos</span>
</span><span id="compare_plasticity_types-230"><a href="#compare_plasticity_types-230"><span class="linenos">230</span></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[1/4] Preparando datos...&quot;</span><span class="p">)</span>
</span><span id="compare_plasticity_types-231"><a href="#compare_plasticity_types-231"><span class="linenos">231</span></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">generate_mackey_glass</span><span class="p">(</span><span class="mi">2500</span><span class="p">)</span>
</span><span id="compare_plasticity_types-232"><a href="#compare_plasticity_types-232"><span class="linenos">232</span></a>    <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span> <span class="o">-</span> <span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span> <span class="o">/</span> <span class="n">data</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</span><span id="compare_plasticity_types-233"><a href="#compare_plasticity_types-233"><span class="linenos">233</span></a>    
</span><span id="compare_plasticity_types-234"><a href="#compare_plasticity_types-234"><span class="linenos">234</span></a>    <span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="compare_plasticity_types-235"><a href="#compare_plasticity_types-235"><span class="linenos">235</span></a>    <span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="compare_plasticity_types-236"><a href="#compare_plasticity_types-236"><span class="linenos">236</span></a>    
</span><span id="compare_plasticity_types-237"><a href="#compare_plasticity_types-237"><span class="linenos">237</span></a>    <span class="n">train_size</span> <span class="o">=</span> <span class="mi">1500</span>
</span><span id="compare_plasticity_types-238"><a href="#compare_plasticity_types-238"><span class="linenos">238</span></a>    <span class="n">adapt_size</span> <span class="o">=</span> <span class="mi">500</span>
</span><span id="compare_plasticity_types-239"><a href="#compare_plasticity_types-239"><span class="linenos">239</span></a>    <span class="n">X_train</span><span class="p">,</span> <span class="n">X_adapt</span><span class="p">,</span> <span class="n">X_test</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:</span><span class="n">train_size</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="n">train_size</span><span class="p">:</span><span class="n">train_size</span><span class="o">+</span><span class="n">adapt_size</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="n">train_size</span><span class="o">+</span><span class="n">adapt_size</span><span class="p">:]</span>
</span><span id="compare_plasticity_types-240"><a href="#compare_plasticity_types-240"><span class="linenos">240</span></a>    <span class="n">y_train</span><span class="p">,</span> <span class="n">y_adapt</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">y</span><span class="p">[:</span><span class="n">train_size</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">train_size</span><span class="p">:</span><span class="n">train_size</span><span class="o">+</span><span class="n">adapt_size</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">train_size</span><span class="o">+</span><span class="n">adapt_size</span><span class="p">:]</span>
</span><span id="compare_plasticity_types-241"><a href="#compare_plasticity_types-241"><span class="linenos">241</span></a>    
</span><span id="compare_plasticity_types-242"><a href="#compare_plasticity_types-242"><span class="linenos">242</span></a>    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="compare_plasticity_types-243"><a href="#compare_plasticity_types-243"><span class="linenos">243</span></a>    
</span><span id="compare_plasticity_types-244"><a href="#compare_plasticity_types-244"><span class="linenos">244</span></a>    <span class="c1"># ESN estándar (sin plasticidad)</span>
</span><span id="compare_plasticity_types-245"><a href="#compare_plasticity_types-245"><span class="linenos">245</span></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[2/4] Entrenando ESN estándar (sin plasticidad)...&quot;</span><span class="p">)</span>
</span><span id="compare_plasticity_types-246"><a href="#compare_plasticity_types-246"><span class="linenos">246</span></a>    <span class="n">esn_standard</span> <span class="o">=</span> <span class="n">EchoStateNetwork</span><span class="p">(</span>
</span><span id="compare_plasticity_types-247"><a href="#compare_plasticity_types-247"><span class="linenos">247</span></a>        <span class="n">n_inputs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_reservoir</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">n_outputs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="compare_plasticity_types-248"><a href="#compare_plasticity_types-248"><span class="linenos">248</span></a>        <span class="n">spectral_radius</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span>
</span><span id="compare_plasticity_types-249"><a href="#compare_plasticity_types-249"><span class="linenos">249</span></a>    <span class="p">)</span>
</span><span id="compare_plasticity_types-250"><a href="#compare_plasticity_types-250"><span class="linenos">250</span></a>    <span class="n">esn_standard</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</span><span id="compare_plasticity_types-251"><a href="#compare_plasticity_types-251"><span class="linenos">251</span></a>    <span class="n">esn_standard</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</span><span id="compare_plasticity_types-252"><a href="#compare_plasticity_types-252"><span class="linenos">252</span></a>    <span class="n">pred_standard</span> <span class="o">=</span> <span class="n">esn_standard</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</span><span id="compare_plasticity_types-253"><a href="#compare_plasticity_types-253"><span class="linenos">253</span></a>    <span class="n">mse_standard</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">pred_standard</span> <span class="o">-</span> <span class="n">y_test</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</span><span id="compare_plasticity_types-254"><a href="#compare_plasticity_types-254"><span class="linenos">254</span></a>    
</span><span id="compare_plasticity_types-255"><a href="#compare_plasticity_types-255"><span class="linenos">255</span></a>    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="compare_plasticity_types-256"><a href="#compare_plasticity_types-256"><span class="linenos">256</span></a>        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;ESN Estándar&#39;</span><span class="p">,</span>
</span><span id="compare_plasticity_types-257"><a href="#compare_plasticity_types-257"><span class="linenos">257</span></a>        <span class="s1">&#39;mse&#39;</span><span class="p">:</span> <span class="n">mse_standard</span><span class="p">,</span>
</span><span id="compare_plasticity_types-258"><a href="#compare_plasticity_types-258"><span class="linenos">258</span></a>        <span class="s1">&#39;adaptations&#39;</span><span class="p">:</span> <span class="mi">0</span>
</span><span id="compare_plasticity_types-259"><a href="#compare_plasticity_types-259"><span class="linenos">259</span></a>    <span class="p">})</span>
</span><span id="compare_plasticity_types-260"><a href="#compare_plasticity_types-260"><span class="linenos">260</span></a>    
</span><span id="compare_plasticity_types-261"><a href="#compare_plasticity_types-261"><span class="linenos">261</span></a>    <span class="c1"># Probar diferentes tipos de plasticidad</span>
</span><span id="compare_plasticity_types-262"><a href="#compare_plasticity_types-262"><span class="linenos">262</span></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[3/4] Probando tipos de plasticidad...&quot;</span><span class="p">)</span>
</span><span id="compare_plasticity_types-263"><a href="#compare_plasticity_types-263"><span class="linenos">263</span></a>    
</span><span id="compare_plasticity_types-264"><a href="#compare_plasticity_types-264"><span class="linenos">264</span></a>    <span class="k">for</span> <span class="n">plasticity_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;hebbian&#39;</span><span class="p">,</span> <span class="s1">&#39;anti_hebbian&#39;</span><span class="p">]:</span>
</span><span id="compare_plasticity_types-265"><a href="#compare_plasticity_types-265"><span class="linenos">265</span></a>        <span class="n">esn_plastic</span> <span class="o">=</span> <span class="n">HebbianESN</span><span class="p">(</span>
</span><span id="compare_plasticity_types-266"><a href="#compare_plasticity_types-266"><span class="linenos">266</span></a>            <span class="n">n_inputs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_reservoir</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">n_outputs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="compare_plasticity_types-267"><a href="#compare_plasticity_types-267"><span class="linenos">267</span></a>            <span class="n">spectral_radius</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">,</span>
</span><span id="compare_plasticity_types-268"><a href="#compare_plasticity_types-268"><span class="linenos">268</span></a>            <span class="n">plasticity_type</span><span class="o">=</span><span class="n">plasticity_type</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span>
</span><span id="compare_plasticity_types-269"><a href="#compare_plasticity_types-269"><span class="linenos">269</span></a>        <span class="p">)</span>
</span><span id="compare_plasticity_types-270"><a href="#compare_plasticity_types-270"><span class="linenos">270</span></a>        
</span><span id="compare_plasticity_types-271"><a href="#compare_plasticity_types-271"><span class="linenos">271</span></a>        <span class="c1"># Entrenar inicialmente</span>
</span><span id="compare_plasticity_types-272"><a href="#compare_plasticity_types-272"><span class="linenos">272</span></a>        <span class="n">esn_plastic</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</span><span id="compare_plasticity_types-273"><a href="#compare_plasticity_types-273"><span class="linenos">273</span></a>        
</span><span id="compare_plasticity_types-274"><a href="#compare_plasticity_types-274"><span class="linenos">274</span></a>        <span class="c1"># Adaptación online</span>
</span><span id="compare_plasticity_types-275"><a href="#compare_plasticity_types-275"><span class="linenos">275</span></a>        <span class="n">esn_plastic</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</span><span id="compare_plasticity_types-276"><a href="#compare_plasticity_types-276"><span class="linenos">276</span></a>        <span class="n">esn_plastic</span><span class="o">.</span><span class="n">adapt_online</span><span class="p">(</span><span class="n">X_adapt</span><span class="p">,</span> <span class="n">record_weights</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="compare_plasticity_types-277"><a href="#compare_plasticity_types-277"><span class="linenos">277</span></a>        
</span><span id="compare_plasticity_types-278"><a href="#compare_plasticity_types-278"><span class="linenos">278</span></a>        <span class="c1"># Evaluar</span>
</span><span id="compare_plasticity_types-279"><a href="#compare_plasticity_types-279"><span class="linenos">279</span></a>        <span class="n">pred</span> <span class="o">=</span> <span class="n">esn_plastic</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</span><span id="compare_plasticity_types-280"><a href="#compare_plasticity_types-280"><span class="linenos">280</span></a>        <span class="n">mse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">pred</span> <span class="o">-</span> <span class="n">y_test</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</span><span id="compare_plasticity_types-281"><a href="#compare_plasticity_types-281"><span class="linenos">281</span></a>        <span class="n">stats</span> <span class="o">=</span> <span class="n">esn_plastic</span><span class="o">.</span><span class="n">get_adaptation_stats</span><span class="p">()</span>
</span><span id="compare_plasticity_types-282"><a href="#compare_plasticity_types-282"><span class="linenos">282</span></a>        
</span><span id="compare_plasticity_types-283"><a href="#compare_plasticity_types-283"><span class="linenos">283</span></a>        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="compare_plasticity_types-284"><a href="#compare_plasticity_types-284"><span class="linenos">284</span></a>            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;ESN + </span><span class="si">{</span><span class="n">plasticity_type</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="compare_plasticity_types-285"><a href="#compare_plasticity_types-285"><span class="linenos">285</span></a>            <span class="s1">&#39;mse&#39;</span><span class="p">:</span> <span class="n">mse</span><span class="p">,</span>
</span><span id="compare_plasticity_types-286"><a href="#compare_plasticity_types-286"><span class="linenos">286</span></a>            <span class="s1">&#39;adaptations&#39;</span><span class="p">:</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;total_adaptations&#39;</span><span class="p">]</span>
</span><span id="compare_plasticity_types-287"><a href="#compare_plasticity_types-287"><span class="linenos">287</span></a>        <span class="p">})</span>
</span><span id="compare_plasticity_types-288"><a href="#compare_plasticity_types-288"><span class="linenos">288</span></a>    
</span><span id="compare_plasticity_types-289"><a href="#compare_plasticity_types-289"><span class="linenos">289</span></a>    <span class="c1"># Mostrar resultados</span>
</span><span id="compare_plasticity_types-290"><a href="#compare_plasticity_types-290"><span class="linenos">290</span></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[4/4] Resultados:&quot;</span><span class="p">)</span>
</span><span id="compare_plasticity_types-291"><a href="#compare_plasticity_types-291"><span class="linenos">291</span></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
</span><span id="compare_plasticity_types-292"><a href="#compare_plasticity_types-292"><span class="linenos">292</span></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Modelo&#39;</span><span class="si">:</span><span class="s2">&lt;25</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;MSE&#39;</span><span class="si">:</span><span class="s2">&lt;12</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;Adaptaciones&#39;</span><span class="si">:</span><span class="s2">&lt;15</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="compare_plasticity_types-293"><a href="#compare_plasticity_types-293"><span class="linenos">293</span></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
</span><span id="compare_plasticity_types-294"><a href="#compare_plasticity_types-294"><span class="linenos">294</span></a>    
</span><span id="compare_plasticity_types-295"><a href="#compare_plasticity_types-295"><span class="linenos">295</span></a>    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
</span><span id="compare_plasticity_types-296"><a href="#compare_plasticity_types-296"><span class="linenos">296</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">&lt;25</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;mse&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">&lt;12.6f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;adaptations&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">&lt;15</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="compare_plasticity_types-297"><a href="#compare_plasticity_types-297"><span class="linenos">297</span></a>    
</span><span id="compare_plasticity_types-298"><a href="#compare_plasticity_types-298"><span class="linenos">298</span></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
</span><span id="compare_plasticity_types-299"><a href="#compare_plasticity_types-299"><span class="linenos">299</span></a>    
</span><span id="compare_plasticity_types-300"><a href="#compare_plasticity_types-300"><span class="linenos">300</span></a>    <span class="c1"># Análisis</span>
</span><span id="compare_plasticity_types-301"><a href="#compare_plasticity_types-301"><span class="linenos">301</span></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="compare_plasticity_types-302"><a href="#compare_plasticity_types-302"><span class="linenos">302</span></a><span class="s2">╔═══════════════════════════════════════════════════════════════╗</span>
</span><span id="compare_plasticity_types-303"><a href="#compare_plasticity_types-303"><span class="linenos">303</span></a><span class="s2">║                      OBSERVACIONES                            ║</span>
</span><span id="compare_plasticity_types-304"><a href="#compare_plasticity_types-304"><span class="linenos">304</span></a><span class="s2">╠═══════════════════════════════════════════════════════════════╣</span>
</span><span id="compare_plasticity_types-305"><a href="#compare_plasticity_types-305"><span class="linenos">305</span></a><span class="s2">║  • La plasticidad Hebbiana permite adaptación continua        ║</span>
</span><span id="compare_plasticity_types-306"><a href="#compare_plasticity_types-306"><span class="linenos">306</span></a><span class="s2">║  • El reservoir se auto-organiza sin etiquetas                ║</span>
</span><span id="compare_plasticity_types-307"><a href="#compare_plasticity_types-307"><span class="linenos">307</span></a><span class="s2">║  • STDP respeta causalidad temporal (más biológico)           ║</span>
</span><span id="compare_plasticity_types-308"><a href="#compare_plasticity_types-308"><span class="linenos">308</span></a><span class="s2">║  • Anti-Hebbiano promueve representaciones dispersas          ║</span>
</span><span id="compare_plasticity_types-309"><a href="#compare_plasticity_types-309"><span class="linenos">309</span></a><span class="s2">║                                                               ║</span>
</span><span id="compare_plasticity_types-310"><a href="#compare_plasticity_types-310"><span class="linenos">310</span></a><span class="s2">║  PRINCIPIO CLAVE:                                             ║</span>
</span><span id="compare_plasticity_types-311"><a href="#compare_plasticity_types-311"><span class="linenos">311</span></a><span class="s2">║  El aprendizaje ocurre LOCALMENTE en cada sinapsis,           ║</span>
</span><span id="compare_plasticity_types-312"><a href="#compare_plasticity_types-312"><span class="linenos">312</span></a><span class="s2">║  sin necesidad de backpropagation global.                     ║</span>
</span><span id="compare_plasticity_types-313"><a href="#compare_plasticity_types-313"><span class="linenos">313</span></a><span class="s2">╚═══════════════════════════════════════════════════════════════╝</span>
</span><span id="compare_plasticity_types-314"><a href="#compare_plasticity_types-314"><span class="linenos">314</span></a><span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Compara diferentes tipos de plasticidad.</p>
</div>


                </section>
                <section id="TzimtzumESN">
                            <input id="TzimtzumESN-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">TzimtzumESN</span><wbr>(<span class="base">esn.esn.EchoStateNetwork</span>):

                <label class="view-source-button" for="TzimtzumESN-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TzimtzumESN"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TzimtzumESN-138"><a href="#TzimtzumESN-138"><span class="linenos">138</span></a><span class="k">class</span><span class="w"> </span><span class="nc">TzimtzumESN</span><span class="p">(</span><span class="n">EchoStateNetwork</span><span class="p">):</span>
</span><span id="TzimtzumESN-139"><a href="#TzimtzumESN-139"><span class="linenos">139</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TzimtzumESN-140"><a href="#TzimtzumESN-140"><span class="linenos">140</span></a><span class="sd">    Echo State Network con protocolo de contracción Tzimtzum.</span>
</span><span id="TzimtzumESN-141"><a href="#TzimtzumESN-141"><span class="linenos">141</span></a><span class="sd">    </span>
</span><span id="TzimtzumESN-142"><a href="#TzimtzumESN-142"><span class="linenos">142</span></a><span class="sd">    Implementa poda sináptica dinámica inspirada en:</span>
</span><span id="TzimtzumESN-143"><a href="#TzimtzumESN-143"><span class="linenos">143</span></a><span class="sd">    - Tzimtzum cabalístico (contracción del infinito)</span>
</span><span id="TzimtzumESN-144"><a href="#TzimtzumESN-144"><span class="linenos">144</span></a><span class="sd">    - Poda sináptica biológica (adolescencia neuronal)</span>
</span><span id="TzimtzumESN-145"><a href="#TzimtzumESN-145"><span class="linenos">145</span></a><span class="sd">    - Lottery Ticket Hypothesis (redes sparse superiores)</span>
</span><span id="TzimtzumESN-146"><a href="#TzimtzumESN-146"><span class="linenos">146</span></a><span class="sd">    </span>
</span><span id="TzimtzumESN-147"><a href="#TzimtzumESN-147"><span class="linenos">147</span></a><span class="sd">    FILOSOFÍA:</span>
</span><span id="TzimtzumESN-148"><a href="#TzimtzumESN-148"><span class="linenos">148</span></a><span class="sd">    ──────────</span>
</span><span id="TzimtzumESN-149"><a href="#TzimtzumESN-149"><span class="linenos">149</span></a><span class="sd">    &quot;La vasija que está llena no puede recibir más agua.</span>
</span><span id="TzimtzumESN-150"><a href="#TzimtzumESN-150"><span class="linenos">150</span></a><span class="sd">     Solo el vacío puede ser llenado.&quot;</span>
</span><span id="TzimtzumESN-151"><a href="#TzimtzumESN-151"><span class="linenos">151</span></a><span class="sd">    </span>
</span><span id="TzimtzumESN-152"><a href="#TzimtzumESN-152"><span class="linenos">152</span></a><span class="sd">    Una red saturada de conexiones pierde la capacidad de</span>
</span><span id="TzimtzumESN-153"><a href="#TzimtzumESN-153"><span class="linenos">153</span></a><span class="sd">    aprender patrones nuevos. El Tzimtzum crea espacio para</span>
</span><span id="TzimtzumESN-154"><a href="#TzimtzumESN-154"><span class="linenos">154</span></a><span class="sd">    el crecimiento futuro eliminando las conexiones más débiles.</span>
</span><span id="TzimtzumESN-155"><a href="#TzimtzumESN-155"><span class="linenos">155</span></a><span class="sd">    </span>
</span><span id="TzimtzumESN-156"><a href="#TzimtzumESN-156"><span class="linenos">156</span></a><span class="sd">    PROCESO:</span>
</span><span id="TzimtzumESN-157"><a href="#TzimtzumESN-157"><span class="linenos">157</span></a><span class="sd">    ────────</span>
</span><span id="TzimtzumESN-158"><a href="#TzimtzumESN-158"><span class="linenos">158</span></a><span class="sd">    1. PLENITUD: Red opera normalmente, acumulando conexiones</span>
</span><span id="TzimtzumESN-159"><a href="#TzimtzumESN-159"><span class="linenos">159</span></a><span class="sd">    2. DARK NIGHT: Identificar y podar el 50% más débil</span>
</span><span id="TzimtzumESN-160"><a href="#TzimtzumESN-160"><span class="linenos">160</span></a><span class="sd">    3. CHALLAL: Estado de vacío, mínima conectividad</span>
</span><span id="TzimtzumESN-161"><a href="#TzimtzumESN-161"><span class="linenos">161</span></a><span class="sd">    4. RENACIMIENTO: Regrowth selectivo de nuevas conexiones</span>
</span><span id="TzimtzumESN-162"><a href="#TzimtzumESN-162"><span class="linenos">162</span></a><span class="sd">    </span>
</span><span id="TzimtzumESN-163"><a href="#TzimtzumESN-163"><span class="linenos">163</span></a><span class="sd">    Ejemplo:</span>
</span><span id="TzimtzumESN-164"><a href="#TzimtzumESN-164"><span class="linenos">164</span></a><span class="sd">        &gt;&gt;&gt; tzim = TzimtzumESN(</span>
</span><span id="TzimtzumESN-165"><a href="#TzimtzumESN-165"><span class="linenos">165</span></a><span class="sd">        ...     input_size=3,</span>
</span><span id="TzimtzumESN-166"><a href="#TzimtzumESN-166"><span class="linenos">166</span></a><span class="sd">        ...     reservoir_size=100,</span>
</span><span id="TzimtzumESN-167"><a href="#TzimtzumESN-167"><span class="linenos">167</span></a><span class="sd">        ...     config=TzimtzumConfig(pruning_fraction=0.5)</span>
</span><span id="TzimtzumESN-168"><a href="#TzimtzumESN-168"><span class="linenos">168</span></a><span class="sd">        ... )</span>
</span><span id="TzimtzumESN-169"><a href="#TzimtzumESN-169"><span class="linenos">169</span></a><span class="sd">        &gt;&gt;&gt; </span>
</span><span id="TzimtzumESN-170"><a href="#TzimtzumESN-170"><span class="linenos">170</span></a><span class="sd">        &gt;&gt;&gt; # Entrenar normalmente</span>
</span><span id="TzimtzumESN-171"><a href="#TzimtzumESN-171"><span class="linenos">171</span></a><span class="sd">        &gt;&gt;&gt; tzim.fit(X_train, y_train)</span>
</span><span id="TzimtzumESN-172"><a href="#TzimtzumESN-172"><span class="linenos">172</span></a><span class="sd">        &gt;&gt;&gt; </span>
</span><span id="TzimtzumESN-173"><a href="#TzimtzumESN-173"><span class="linenos">173</span></a><span class="sd">        &gt;&gt;&gt; # Ejecutar Dark Night (poda)</span>
</span><span id="TzimtzumESN-174"><a href="#TzimtzumESN-174"><span class="linenos">174</span></a><span class="sd">        &gt;&gt;&gt; stats = tzim.dark_night()</span>
</span><span id="TzimtzumESN-175"><a href="#TzimtzumESN-175"><span class="linenos">175</span></a><span class="sd">        &gt;&gt;&gt; print(f&quot;Podadas {stats[&#39;pruned_count&#39;]} conexiones&quot;)</span>
</span><span id="TzimtzumESN-176"><a href="#TzimtzumESN-176"><span class="linenos">176</span></a><span class="sd">        &gt;&gt;&gt; </span>
</span><span id="TzimtzumESN-177"><a href="#TzimtzumESN-177"><span class="linenos">177</span></a><span class="sd">        &gt;&gt;&gt; # El reservoir ahora tiene 50% menos conexiones</span>
</span><span id="TzimtzumESN-178"><a href="#TzimtzumESN-178"><span class="linenos">178</span></a><span class="sd">        &gt;&gt;&gt; # pero mantiene (o mejora) su capacidad</span>
</span><span id="TzimtzumESN-179"><a href="#TzimtzumESN-179"><span class="linenos">179</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="TzimtzumESN-180"><a href="#TzimtzumESN-180"><span class="linenos">180</span></a>    
</span><span id="TzimtzumESN-181"><a href="#TzimtzumESN-181"><span class="linenos">181</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="TzimtzumESN-182"><a href="#TzimtzumESN-182"><span class="linenos">182</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="TzimtzumESN-183"><a href="#TzimtzumESN-183"><span class="linenos">183</span></a>        <span class="n">n_inputs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="TzimtzumESN-184"><a href="#TzimtzumESN-184"><span class="linenos">184</span></a>        <span class="n">n_reservoir</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
</span><span id="TzimtzumESN-185"><a href="#TzimtzumESN-185"><span class="linenos">185</span></a>        <span class="n">n_outputs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="TzimtzumESN-186"><a href="#TzimtzumESN-186"><span class="linenos">186</span></a>        <span class="n">spectral_radius</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span>
</span><span id="TzimtzumESN-187"><a href="#TzimtzumESN-187"><span class="linenos">187</span></a>        <span class="n">sparsity</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span>
</span><span id="TzimtzumESN-188"><a href="#TzimtzumESN-188"><span class="linenos">188</span></a>        <span class="n">noise</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">,</span>
</span><span id="TzimtzumESN-189"><a href="#TzimtzumESN-189"><span class="linenos">189</span></a>        <span class="n">config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TzimtzumConfig</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TzimtzumESN-190"><a href="#TzimtzumESN-190"><span class="linenos">190</span></a>        <span class="n">random_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TzimtzumESN-191"><a href="#TzimtzumESN-191"><span class="linenos">191</span></a>    <span class="p">):</span>
</span><span id="TzimtzumESN-192"><a href="#TzimtzumESN-192"><span class="linenos">192</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TzimtzumESN-193"><a href="#TzimtzumESN-193"><span class="linenos">193</span></a><span class="sd">        Inicializa TzimtzumESN.</span>
</span><span id="TzimtzumESN-194"><a href="#TzimtzumESN-194"><span class="linenos">194</span></a><span class="sd">        </span>
</span><span id="TzimtzumESN-195"><a href="#TzimtzumESN-195"><span class="linenos">195</span></a><span class="sd">        Args:</span>
</span><span id="TzimtzumESN-196"><a href="#TzimtzumESN-196"><span class="linenos">196</span></a><span class="sd">            n_inputs: Dimensión de entrada</span>
</span><span id="TzimtzumESN-197"><a href="#TzimtzumESN-197"><span class="linenos">197</span></a><span class="sd">            n_reservoir: Número de neuronas en reservoir</span>
</span><span id="TzimtzumESN-198"><a href="#TzimtzumESN-198"><span class="linenos">198</span></a><span class="sd">            n_outputs: Dimensión de salida</span>
</span><span id="TzimtzumESN-199"><a href="#TzimtzumESN-199"><span class="linenos">199</span></a><span class="sd">            spectral_radius: Radio espectral del reservoir</span>
</span><span id="TzimtzumESN-200"><a href="#TzimtzumESN-200"><span class="linenos">200</span></a><span class="sd">            sparsity: Sparsity inicial (fracción de ceros)</span>
</span><span id="TzimtzumESN-201"><a href="#TzimtzumESN-201"><span class="linenos">201</span></a><span class="sd">            noise: Ruido de regularización</span>
</span><span id="TzimtzumESN-202"><a href="#TzimtzumESN-202"><span class="linenos">202</span></a><span class="sd">            config: Configuración Tzimtzum</span>
</span><span id="TzimtzumESN-203"><a href="#TzimtzumESN-203"><span class="linenos">203</span></a><span class="sd">            random_state: Semilla aleatoria</span>
</span><span id="TzimtzumESN-204"><a href="#TzimtzumESN-204"><span class="linenos">204</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TzimtzumESN-205"><a href="#TzimtzumESN-205"><span class="linenos">205</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="TzimtzumESN-206"><a href="#TzimtzumESN-206"><span class="linenos">206</span></a>            <span class="n">n_inputs</span><span class="o">=</span><span class="n">n_inputs</span><span class="p">,</span>
</span><span id="TzimtzumESN-207"><a href="#TzimtzumESN-207"><span class="linenos">207</span></a>            <span class="n">n_reservoir</span><span class="o">=</span><span class="n">n_reservoir</span><span class="p">,</span>
</span><span id="TzimtzumESN-208"><a href="#TzimtzumESN-208"><span class="linenos">208</span></a>            <span class="n">n_outputs</span><span class="o">=</span><span class="n">n_outputs</span><span class="p">,</span>
</span><span id="TzimtzumESN-209"><a href="#TzimtzumESN-209"><span class="linenos">209</span></a>            <span class="n">spectral_radius</span><span class="o">=</span><span class="n">spectral_radius</span><span class="p">,</span>
</span><span id="TzimtzumESN-210"><a href="#TzimtzumESN-210"><span class="linenos">210</span></a>            <span class="n">sparsity</span><span class="o">=</span><span class="n">sparsity</span><span class="p">,</span>
</span><span id="TzimtzumESN-211"><a href="#TzimtzumESN-211"><span class="linenos">211</span></a>            <span class="n">noise</span><span class="o">=</span><span class="n">noise</span><span class="p">,</span>
</span><span id="TzimtzumESN-212"><a href="#TzimtzumESN-212"><span class="linenos">212</span></a>            <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span>
</span><span id="TzimtzumESN-213"><a href="#TzimtzumESN-213"><span class="linenos">213</span></a>        <span class="p">)</span>
</span><span id="TzimtzumESN-214"><a href="#TzimtzumESN-214"><span class="linenos">214</span></a>        
</span><span id="TzimtzumESN-215"><a href="#TzimtzumESN-215"><span class="linenos">215</span></a>        <span class="c1"># Alias for compatibility</span>
</span><span id="TzimtzumESN-216"><a href="#TzimtzumESN-216"><span class="linenos">216</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_reservoir</span> <span class="o">=</span> <span class="n">n_reservoir</span>
</span><span id="TzimtzumESN-217"><a href="#TzimtzumESN-217"><span class="linenos">217</span></a>        
</span><span id="TzimtzumESN-218"><a href="#TzimtzumESN-218"><span class="linenos">218</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span> <span class="ow">or</span> <span class="n">TzimtzumConfig</span><span class="p">()</span>
</span><span id="TzimtzumESN-219"><a href="#TzimtzumESN-219"><span class="linenos">219</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span> <span class="o">=</span> <span class="n">TzimtzumState</span><span class="p">()</span>
</span><span id="TzimtzumESN-220"><a href="#TzimtzumESN-220"><span class="linenos">220</span></a>        
</span><span id="TzimtzumESN-221"><a href="#TzimtzumESN-221"><span class="linenos">221</span></a>        <span class="c1"># RNG para regrowth</span>
</span><span id="TzimtzumESN-222"><a href="#TzimtzumESN-222"><span class="linenos">222</span></a>        <span class="n">regrowth_seed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">regrowth_seed</span> <span class="ow">or</span> <span class="n">random_state</span>
</span><span id="TzimtzumESN-223"><a href="#TzimtzumESN-223"><span class="linenos">223</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_regrowth_rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">regrowth_seed</span><span class="p">)</span>
</span><span id="TzimtzumESN-224"><a href="#TzimtzumESN-224"><span class="linenos">224</span></a>        
</span><span id="TzimtzumESN-225"><a href="#TzimtzumESN-225"><span class="linenos">225</span></a>        <span class="c1"># Máscara de conexiones activas</span>
</span><span id="TzimtzumESN-226"><a href="#TzimtzumESN-226"><span class="linenos">226</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_connection_mask</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="TzimtzumESN-227"><a href="#TzimtzumESN-227"><span class="linenos">227</span></a>        
</span><span id="TzimtzumESN-228"><a href="#TzimtzumESN-228"><span class="linenos">228</span></a>        <span class="c1"># Importancia de conexiones (actualizada durante forward)</span>
</span><span id="TzimtzumESN-229"><a href="#TzimtzumESN-229"><span class="linenos">229</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_connection_importance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span><span class="p">)</span>
</span><span id="TzimtzumESN-230"><a href="#TzimtzumESN-230"><span class="linenos">230</span></a>        
</span><span id="TzimtzumESN-231"><a href="#TzimtzumESN-231"><span class="linenos">231</span></a>        <span class="c1"># Historial para análisis</span>
</span><span id="TzimtzumESN-232"><a href="#TzimtzumESN-232"><span class="linenos">232</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pruning_history</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="TzimtzumESN-233"><a href="#TzimtzumESN-233"><span class="linenos">233</span></a>        
</span><span id="TzimtzumESN-234"><a href="#TzimtzumESN-234"><span class="linenos">234</span></a>        <span class="c1"># Contador de pasos para auto-poda</span>
</span><span id="TzimtzumESN-235"><a href="#TzimtzumESN-235"><span class="linenos">235</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_step_count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="TzimtzumESN-236"><a href="#TzimtzumESN-236"><span class="linenos">236</span></a>        
</span><span id="TzimtzumESN-237"><a href="#TzimtzumESN-237"><span class="linenos">237</span></a>        <span class="c1"># Inicializar métricas</span>
</span><span id="TzimtzumESN-238"><a href="#TzimtzumESN-238"><span class="linenos">238</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_update_state_metrics</span><span class="p">()</span>
</span><span id="TzimtzumESN-239"><a href="#TzimtzumESN-239"><span class="linenos">239</span></a>    
</span><span id="TzimtzumESN-240"><a href="#TzimtzumESN-240"><span class="linenos">240</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_update_state_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TzimtzumESN-241"><a href="#TzimtzumESN-241"><span class="linenos">241</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Actualiza métricas del estado Tzimtzum.&quot;&quot;&quot;</span>
</span><span id="TzimtzumESN-242"><a href="#TzimtzumESN-242"><span class="linenos">242</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">total_connections</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_connection_mask</span><span class="p">))</span>
</span><span id="TzimtzumESN-243"><a href="#TzimtzumESN-243"><span class="linenos">243</span></a>        
</span><span id="TzimtzumESN-244"><a href="#TzimtzumESN-244"><span class="linenos">244</span></a>        <span class="c1"># Calcular ratio de compresión</span>
</span><span id="TzimtzumESN-245"><a href="#TzimtzumESN-245"><span class="linenos">245</span></a>        <span class="n">max_connections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_reservoir</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="TzimtzumESN-246"><a href="#TzimtzumESN-246"><span class="linenos">246</span></a>        <span class="n">active</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">total_connections</span>
</span><span id="TzimtzumESN-247"><a href="#TzimtzumESN-247"><span class="linenos">247</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">compression_ratio</span> <span class="o">=</span> <span class="n">active</span> <span class="o">/</span> <span class="n">max_connections</span> <span class="k">if</span> <span class="n">max_connections</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
</span><span id="TzimtzumESN-248"><a href="#TzimtzumESN-248"><span class="linenos">248</span></a>    
</span><span id="TzimtzumESN-249"><a href="#TzimtzumESN-249"><span class="linenos">249</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_connection_importance</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="TzimtzumESN-250"><a href="#TzimtzumESN-250"><span class="linenos">250</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TzimtzumESN-251"><a href="#TzimtzumESN-251"><span class="linenos">251</span></a><span class="sd">        Calcula la importancia de cada conexión.</span>
</span><span id="TzimtzumESN-252"><a href="#TzimtzumESN-252"><span class="linenos">252</span></a><span class="sd">        </span>
</span><span id="TzimtzumESN-253"><a href="#TzimtzumESN-253"><span class="linenos">253</span></a><span class="sd">        Por defecto usa magnitud absoluta, pero puede extenderse</span>
</span><span id="TzimtzumESN-254"><a href="#TzimtzumESN-254"><span class="linenos">254</span></a><span class="sd">        para usar gradientes u otras métricas.</span>
</span><span id="TzimtzumESN-255"><a href="#TzimtzumESN-255"><span class="linenos">255</span></a><span class="sd">        </span>
</span><span id="TzimtzumESN-256"><a href="#TzimtzumESN-256"><span class="linenos">256</span></a><span class="sd">        Returns:</span>
</span><span id="TzimtzumESN-257"><a href="#TzimtzumESN-257"><span class="linenos">257</span></a><span class="sd">            Matriz de importancia (misma forma que W_reservoir)</span>
</span><span id="TzimtzumESN-258"><a href="#TzimtzumESN-258"><span class="linenos">258</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TzimtzumESN-259"><a href="#TzimtzumESN-259"><span class="linenos">259</span></a>        <span class="c1"># Importancia básica: magnitud absoluta del peso</span>
</span><span id="TzimtzumESN-260"><a href="#TzimtzumESN-260"><span class="linenos">260</span></a>        <span class="n">importance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span><span class="p">)</span>
</span><span id="TzimtzumESN-261"><a href="#TzimtzumESN-261"><span class="linenos">261</span></a>        
</span><span id="TzimtzumESN-262"><a href="#TzimtzumESN-262"><span class="linenos">262</span></a>        <span class="c1"># Acumular importancia temporal (momentum)</span>
</span><span id="TzimtzumESN-263"><a href="#TzimtzumESN-263"><span class="linenos">263</span></a>        <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.9</span>
</span><span id="TzimtzumESN-264"><a href="#TzimtzumESN-264"><span class="linenos">264</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_connection_importance</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="TzimtzumESN-265"><a href="#TzimtzumESN-265"><span class="linenos">265</span></a>            <span class="n">alpha</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection_importance</span> <span class="o">+</span> 
</span><span id="TzimtzumESN-266"><a href="#TzimtzumESN-266"><span class="linenos">266</span></a>            <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">importance</span>
</span><span id="TzimtzumESN-267"><a href="#TzimtzumESN-267"><span class="linenos">267</span></a>        <span class="p">)</span>
</span><span id="TzimtzumESN-268"><a href="#TzimtzumESN-268"><span class="linenos">268</span></a>        
</span><span id="TzimtzumESN-269"><a href="#TzimtzumESN-269"><span class="linenos">269</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection_importance</span>
</span><span id="TzimtzumESN-270"><a href="#TzimtzumESN-270"><span class="linenos">270</span></a>    
</span><span id="TzimtzumESN-271"><a href="#TzimtzumESN-271"><span class="linenos">271</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">dark_night</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fraction</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="TzimtzumESN-272"><a href="#TzimtzumESN-272"><span class="linenos">272</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TzimtzumESN-273"><a href="#TzimtzumESN-273"><span class="linenos">273</span></a><span class="sd">        Ejecuta el proceso de Dark Night (poda masiva).</span>
</span><span id="TzimtzumESN-274"><a href="#TzimtzumESN-274"><span class="linenos">274</span></a><span class="sd">        </span>
</span><span id="TzimtzumESN-275"><a href="#TzimtzumESN-275"><span class="linenos">275</span></a><span class="sd">        &quot;En la noche oscura del alma, brillan más las estrellas.&quot;</span>
</span><span id="TzimtzumESN-276"><a href="#TzimtzumESN-276"><span class="linenos">276</span></a><span class="sd">        - San Juan de la Cruz</span>
</span><span id="TzimtzumESN-277"><a href="#TzimtzumESN-277"><span class="linenos">277</span></a><span class="sd">        </span>
</span><span id="TzimtzumESN-278"><a href="#TzimtzumESN-278"><span class="linenos">278</span></a><span class="sd">        Este método elimina una fracción de las conexiones más débiles</span>
</span><span id="TzimtzumESN-279"><a href="#TzimtzumESN-279"><span class="linenos">279</span></a><span class="sd">        del reservoir, creando espacio para nuevo aprendizaje.</span>
</span><span id="TzimtzumESN-280"><a href="#TzimtzumESN-280"><span class="linenos">280</span></a><span class="sd">        </span>
</span><span id="TzimtzumESN-281"><a href="#TzimtzumESN-281"><span class="linenos">281</span></a><span class="sd">        Args:</span>
</span><span id="TzimtzumESN-282"><a href="#TzimtzumESN-282"><span class="linenos">282</span></a><span class="sd">            fraction: Fracción de conexiones a podar (default: config)</span>
</span><span id="TzimtzumESN-283"><a href="#TzimtzumESN-283"><span class="linenos">283</span></a><span class="sd">            </span>
</span><span id="TzimtzumESN-284"><a href="#TzimtzumESN-284"><span class="linenos">284</span></a><span class="sd">        Returns:</span>
</span><span id="TzimtzumESN-285"><a href="#TzimtzumESN-285"><span class="linenos">285</span></a><span class="sd">            Estadísticas del proceso de poda</span>
</span><span id="TzimtzumESN-286"><a href="#TzimtzumESN-286"><span class="linenos">286</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TzimtzumESN-287"><a href="#TzimtzumESN-287"><span class="linenos">287</span></a>        <span class="n">fraction</span> <span class="o">=</span> <span class="n">fraction</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">pruning_fraction</span>
</span><span id="TzimtzumESN-288"><a href="#TzimtzumESN-288"><span class="linenos">288</span></a>        
</span><span id="TzimtzumESN-289"><a href="#TzimtzumESN-289"><span class="linenos">289</span></a>        <span class="c1"># Cambiar fase</span>
</span><span id="TzimtzumESN-290"><a href="#TzimtzumESN-290"><span class="linenos">290</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="n">ContractionPhase</span><span class="o">.</span><span class="n">DARK_NIGHT</span>
</span><span id="TzimtzumESN-291"><a href="#TzimtzumESN-291"><span class="linenos">291</span></a>        
</span><span id="TzimtzumESN-292"><a href="#TzimtzumESN-292"><span class="linenos">292</span></a>        <span class="c1"># Calcular importancia actual</span>
</span><span id="TzimtzumESN-293"><a href="#TzimtzumESN-293"><span class="linenos">293</span></a>        <span class="n">importance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_connection_importance</span><span class="p">()</span>
</span><span id="TzimtzumESN-294"><a href="#TzimtzumESN-294"><span class="linenos">294</span></a>        
</span><span id="TzimtzumESN-295"><a href="#TzimtzumESN-295"><span class="linenos">295</span></a>        <span class="c1"># Solo considerar conexiones activas</span>
</span><span id="TzimtzumESN-296"><a href="#TzimtzumESN-296"><span class="linenos">296</span></a>        <span class="n">active_connections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection_mask</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="TzimtzumESN-297"><a href="#TzimtzumESN-297"><span class="linenos">297</span></a>        <span class="n">active_importance</span> <span class="o">=</span> <span class="n">importance</span><span class="p">[</span><span class="n">active_connections</span><span class="p">]</span>
</span><span id="TzimtzumESN-298"><a href="#TzimtzumESN-298"><span class="linenos">298</span></a>        
</span><span id="TzimtzumESN-299"><a href="#TzimtzumESN-299"><span class="linenos">299</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">active_importance</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="TzimtzumESN-300"><a href="#TzimtzumESN-300"><span class="linenos">300</span></a>            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;pruned_count&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;No hay conexiones que podar&#39;</span><span class="p">}</span>
</span><span id="TzimtzumESN-301"><a href="#TzimtzumESN-301"><span class="linenos">301</span></a>        
</span><span id="TzimtzumESN-302"><a href="#TzimtzumESN-302"><span class="linenos">302</span></a>        <span class="c1"># Calcular umbral de poda (percentil basado en fracción)</span>
</span><span id="TzimtzumESN-303"><a href="#TzimtzumESN-303"><span class="linenos">303</span></a>        <span class="n">prune_percentile</span> <span class="o">=</span> <span class="n">fraction</span> <span class="o">*</span> <span class="mi">100</span>
</span><span id="TzimtzumESN-304"><a href="#TzimtzumESN-304"><span class="linenos">304</span></a>        <span class="n">threshold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">active_importance</span><span class="p">,</span> <span class="n">prune_percentile</span><span class="p">)</span>
</span><span id="TzimtzumESN-305"><a href="#TzimtzumESN-305"><span class="linenos">305</span></a>        
</span><span id="TzimtzumESN-306"><a href="#TzimtzumESN-306"><span class="linenos">306</span></a>        <span class="c1"># Asegurar mínimo de conexiones</span>
</span><span id="TzimtzumESN-307"><a href="#TzimtzumESN-307"><span class="linenos">307</span></a>        <span class="n">min_connections</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_reservoir</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">min_connections_fraction</span><span class="p">)</span>
</span><span id="TzimtzumESN-308"><a href="#TzimtzumESN-308"><span class="linenos">308</span></a>        <span class="n">current_connections</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">active_connections</span><span class="p">)</span>
</span><span id="TzimtzumESN-309"><a href="#TzimtzumESN-309"><span class="linenos">309</span></a>        <span class="n">max_to_prune</span> <span class="o">=</span> <span class="n">current_connections</span> <span class="o">-</span> <span class="n">min_connections</span>
</span><span id="TzimtzumESN-310"><a href="#TzimtzumESN-310"><span class="linenos">310</span></a>        
</span><span id="TzimtzumESN-311"><a href="#TzimtzumESN-311"><span class="linenos">311</span></a>        <span class="k">if</span> <span class="n">max_to_prune</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="TzimtzumESN-312"><a href="#TzimtzumESN-312"><span class="linenos">312</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="TzimtzumESN-313"><a href="#TzimtzumESN-313"><span class="linenos">313</span></a>                <span class="s1">&#39;pruned_count&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> 
</span><span id="TzimtzumESN-314"><a href="#TzimtzumESN-314"><span class="linenos">314</span></a>                <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Ya en mínimo de conexiones (</span><span class="si">{</span><span class="n">min_connections</span><span class="si">}</span><span class="s1">)&#39;</span>
</span><span id="TzimtzumESN-315"><a href="#TzimtzumESN-315"><span class="linenos">315</span></a>            <span class="p">}</span>
</span><span id="TzimtzumESN-316"><a href="#TzimtzumESN-316"><span class="linenos">316</span></a>        
</span><span id="TzimtzumESN-317"><a href="#TzimtzumESN-317"><span class="linenos">317</span></a>        <span class="c1"># Crear máscara de poda basada SOLO en importancia</span>
</span><span id="TzimtzumESN-318"><a href="#TzimtzumESN-318"><span class="linenos">318</span></a>        <span class="c1"># Las conexiones por debajo del threshold serán podadas</span>
</span><span id="TzimtzumESN-319"><a href="#TzimtzumESN-319"><span class="linenos">319</span></a>        <span class="n">survival_mask</span> <span class="o">=</span> <span class="n">importance</span> <span class="o">&gt;=</span> <span class="n">threshold</span>
</span><span id="TzimtzumESN-320"><a href="#TzimtzumESN-320"><span class="linenos">320</span></a>        
</span><span id="TzimtzumESN-321"><a href="#TzimtzumESN-321"><span class="linenos">321</span></a>        <span class="c1"># min_survival_weight es solo para evitar eliminar conexiones ya casi muertas</span>
</span><span id="TzimtzumESN-322"><a href="#TzimtzumESN-322"><span class="linenos">322</span></a>        <span class="c1"># (no debería salvar conexiones que tienen peso pero baja importancia)</span>
</span><span id="TzimtzumESN-323"><a href="#TzimtzumESN-323"><span class="linenos">323</span></a>        <span class="c1"># Solo protege conexiones que de otra forma sobrevivirían</span>
</span><span id="TzimtzumESN-324"><a href="#TzimtzumESN-324"><span class="linenos">324</span></a>        
</span><span id="TzimtzumESN-325"><a href="#TzimtzumESN-325"><span class="linenos">325</span></a>        <span class="c1"># Preservar topología si está configurado</span>
</span><span id="TzimtzumESN-326"><a href="#TzimtzumESN-326"><span class="linenos">326</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">preserve_topology</span><span class="p">:</span>
</span><span id="TzimtzumESN-327"><a href="#TzimtzumESN-327"><span class="linenos">327</span></a>            <span class="c1"># Asegurar al menos una entrada y salida por neurona</span>
</span><span id="TzimtzumESN-328"><a href="#TzimtzumESN-328"><span class="linenos">328</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_reservoir</span><span class="p">):</span>
</span><span id="TzimtzumESN-329"><a href="#TzimtzumESN-329"><span class="linenos">329</span></a>                <span class="c1"># Al menos una entrada</span>
</span><span id="TzimtzumESN-330"><a href="#TzimtzumESN-330"><span class="linenos">330</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">survival_mask</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]):</span>
</span><span id="TzimtzumESN-331"><a href="#TzimtzumESN-331"><span class="linenos">331</span></a>                    <span class="n">best_in</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]))</span>
</span><span id="TzimtzumESN-332"><a href="#TzimtzumESN-332"><span class="linenos">332</span></a>                    <span class="n">survival_mask</span><span class="p">[</span><span class="n">best_in</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="TzimtzumESN-333"><a href="#TzimtzumESN-333"><span class="linenos">333</span></a>                <span class="c1"># Al menos una salida</span>
</span><span id="TzimtzumESN-334"><a href="#TzimtzumESN-334"><span class="linenos">334</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">survival_mask</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]):</span>
</span><span id="TzimtzumESN-335"><a href="#TzimtzumESN-335"><span class="linenos">335</span></a>                    <span class="n">best_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]))</span>
</span><span id="TzimtzumESN-336"><a href="#TzimtzumESN-336"><span class="linenos">336</span></a>                    <span class="n">survival_mask</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">best_out</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="TzimtzumESN-337"><a href="#TzimtzumESN-337"><span class="linenos">337</span></a>        
</span><span id="TzimtzumESN-338"><a href="#TzimtzumESN-338"><span class="linenos">338</span></a>        <span class="c1"># Aplicar poda</span>
</span><span id="TzimtzumESN-339"><a href="#TzimtzumESN-339"><span class="linenos">339</span></a>        <span class="n">pre_prune_connections</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="TzimtzumESN-340"><a href="#TzimtzumESN-340"><span class="linenos">340</span></a>        
</span><span id="TzimtzumESN-341"><a href="#TzimtzumESN-341"><span class="linenos">341</span></a>        <span class="n">prune_mask</span> <span class="o">=</span> <span class="o">~</span><span class="n">survival_mask</span> <span class="o">&amp;</span> <span class="n">active_connections</span>
</span><span id="TzimtzumESN-342"><a href="#TzimtzumESN-342"><span class="linenos">342</span></a>        <span class="n">pruned_count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">prune_mask</span><span class="p">)</span>
</span><span id="TzimtzumESN-343"><a href="#TzimtzumESN-343"><span class="linenos">343</span></a>        
</span><span id="TzimtzumESN-344"><a href="#TzimtzumESN-344"><span class="linenos">344</span></a>        <span class="c1"># Limitar poda a max_to_prune</span>
</span><span id="TzimtzumESN-345"><a href="#TzimtzumESN-345"><span class="linenos">345</span></a>        <span class="k">if</span> <span class="n">pruned_count</span> <span class="o">&gt;</span> <span class="n">max_to_prune</span><span class="p">:</span>
</span><span id="TzimtzumESN-346"><a href="#TzimtzumESN-346"><span class="linenos">346</span></a>            <span class="c1"># Podar solo las menos importantes</span>
</span><span id="TzimtzumESN-347"><a href="#TzimtzumESN-347"><span class="linenos">347</span></a>            <span class="n">prune_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">prune_mask</span><span class="p">)</span>
</span><span id="TzimtzumESN-348"><a href="#TzimtzumESN-348"><span class="linenos">348</span></a>            <span class="n">prune_importance</span> <span class="o">=</span> <span class="n">importance</span><span class="p">[</span><span class="n">prune_mask</span><span class="p">]</span>
</span><span id="TzimtzumESN-349"><a href="#TzimtzumESN-349"><span class="linenos">349</span></a>            <span class="n">sorted_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">prune_importance</span><span class="p">)</span>
</span><span id="TzimtzumESN-350"><a href="#TzimtzumESN-350"><span class="linenos">350</span></a>            
</span><span id="TzimtzumESN-351"><a href="#TzimtzumESN-351"><span class="linenos">351</span></a>            <span class="c1"># Mantener las más importantes entre las que iban a ser podadas</span>
</span><span id="TzimtzumESN-352"><a href="#TzimtzumESN-352"><span class="linenos">352</span></a>            <span class="n">keep_count</span> <span class="o">=</span> <span class="n">pruned_count</span> <span class="o">-</span> <span class="n">max_to_prune</span>
</span><span id="TzimtzumESN-353"><a href="#TzimtzumESN-353"><span class="linenos">353</span></a>            <span class="n">keep_indices</span> <span class="o">=</span> <span class="n">sorted_indices</span><span class="p">[</span><span class="o">-</span><span class="n">keep_count</span><span class="p">:]</span>
</span><span id="TzimtzumESN-354"><a href="#TzimtzumESN-354"><span class="linenos">354</span></a>            
</span><span id="TzimtzumESN-355"><a href="#TzimtzumESN-355"><span class="linenos">355</span></a>            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">keep_indices</span><span class="p">:</span>
</span><span id="TzimtzumESN-356"><a href="#TzimtzumESN-356"><span class="linenos">356</span></a>                <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">prune_indices</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
</span><span id="TzimtzumESN-357"><a href="#TzimtzumESN-357"><span class="linenos">357</span></a>                <span class="n">prune_mask</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="TzimtzumESN-358"><a href="#TzimtzumESN-358"><span class="linenos">358</span></a>            
</span><span id="TzimtzumESN-359"><a href="#TzimtzumESN-359"><span class="linenos">359</span></a>            <span class="n">pruned_count</span> <span class="o">=</span> <span class="n">max_to_prune</span>
</span><span id="TzimtzumESN-360"><a href="#TzimtzumESN-360"><span class="linenos">360</span></a>        
</span><span id="TzimtzumESN-361"><a href="#TzimtzumESN-361"><span class="linenos">361</span></a>        <span class="c1"># Ejecutar poda</span>
</span><span id="TzimtzumESN-362"><a href="#TzimtzumESN-362"><span class="linenos">362</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span><span class="p">[</span><span class="n">prune_mask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="TzimtzumESN-363"><a href="#TzimtzumESN-363"><span class="linenos">363</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_connection_mask</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="TzimtzumESN-364"><a href="#TzimtzumESN-364"><span class="linenos">364</span></a>        
</span><span id="TzimtzumESN-365"><a href="#TzimtzumESN-365"><span class="linenos">365</span></a>        <span class="c1"># Renormalizar radio espectral</span>
</span><span id="TzimtzumESN-366"><a href="#TzimtzumESN-366"><span class="linenos">366</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_spectral_radius</span><span class="p">()</span>
</span><span id="TzimtzumESN-367"><a href="#TzimtzumESN-367"><span class="linenos">367</span></a>        
</span><span id="TzimtzumESN-368"><a href="#TzimtzumESN-368"><span class="linenos">368</span></a>        <span class="c1"># Estadísticas</span>
</span><span id="TzimtzumESN-369"><a href="#TzimtzumESN-369"><span class="linenos">369</span></a>        <span class="n">post_prune_connections</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="TzimtzumESN-370"><a href="#TzimtzumESN-370"><span class="linenos">370</span></a>        <span class="n">memory_saved</span> <span class="o">=</span> <span class="p">(</span><span class="n">pre_prune_connections</span> <span class="o">-</span> <span class="n">post_prune_connections</span><span class="p">)</span> <span class="o">*</span> <span class="mi">8</span>  <span class="c1"># 8 bytes per float64</span>
</span><span id="TzimtzumESN-371"><a href="#TzimtzumESN-371"><span class="linenos">371</span></a>        
</span><span id="TzimtzumESN-372"><a href="#TzimtzumESN-372"><span class="linenos">372</span></a>        <span class="c1"># Actualizar estado</span>
</span><span id="TzimtzumESN-373"><a href="#TzimtzumESN-373"><span class="linenos">373</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">pruned_connections</span> <span class="o">+=</span> <span class="n">pruned_count</span>
</span><span id="TzimtzumESN-374"><a href="#TzimtzumESN-374"><span class="linenos">374</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">pruning_cycles</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="TzimtzumESN-375"><a href="#TzimtzumESN-375"><span class="linenos">375</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">memory_saved_bytes</span> <span class="o">+=</span> <span class="n">memory_saved</span>
</span><span id="TzimtzumESN-376"><a href="#TzimtzumESN-376"><span class="linenos">376</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">current_threshold</span> <span class="o">=</span> <span class="n">threshold</span>
</span><span id="TzimtzumESN-377"><a href="#TzimtzumESN-377"><span class="linenos">377</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="n">ContractionPhase</span><span class="o">.</span><span class="n">CHALLAL</span>
</span><span id="TzimtzumESN-378"><a href="#TzimtzumESN-378"><span class="linenos">378</span></a>        
</span><span id="TzimtzumESN-379"><a href="#TzimtzumESN-379"><span class="linenos">379</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_update_state_metrics</span><span class="p">()</span>
</span><span id="TzimtzumESN-380"><a href="#TzimtzumESN-380"><span class="linenos">380</span></a>        
</span><span id="TzimtzumESN-381"><a href="#TzimtzumESN-381"><span class="linenos">381</span></a>        <span class="c1"># Registrar en historial</span>
</span><span id="TzimtzumESN-382"><a href="#TzimtzumESN-382"><span class="linenos">382</span></a>        <span class="n">stats</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="TzimtzumESN-383"><a href="#TzimtzumESN-383"><span class="linenos">383</span></a>            <span class="s1">&#39;cycle&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">pruning_cycles</span><span class="p">,</span>
</span><span id="TzimtzumESN-384"><a href="#TzimtzumESN-384"><span class="linenos">384</span></a>            <span class="s1">&#39;pruned_count&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">pruned_count</span><span class="p">),</span>
</span><span id="TzimtzumESN-385"><a href="#TzimtzumESN-385"><span class="linenos">385</span></a>            <span class="s1">&#39;threshold&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">threshold</span><span class="p">),</span>
</span><span id="TzimtzumESN-386"><a href="#TzimtzumESN-386"><span class="linenos">386</span></a>            <span class="s1">&#39;pre_connections&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">pre_prune_connections</span><span class="p">),</span>
</span><span id="TzimtzumESN-387"><a href="#TzimtzumESN-387"><span class="linenos">387</span></a>            <span class="s1">&#39;post_connections&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">post_prune_connections</span><span class="p">),</span>
</span><span id="TzimtzumESN-388"><a href="#TzimtzumESN-388"><span class="linenos">388</span></a>            <span class="s1">&#39;memory_saved_bytes&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">memory_saved</span><span class="p">),</span>
</span><span id="TzimtzumESN-389"><a href="#TzimtzumESN-389"><span class="linenos">389</span></a>            <span class="s1">&#39;compression_ratio&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">compression_ratio</span>
</span><span id="TzimtzumESN-390"><a href="#TzimtzumESN-390"><span class="linenos">390</span></a>        <span class="p">}</span>
</span><span id="TzimtzumESN-391"><a href="#TzimtzumESN-391"><span class="linenos">391</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pruning_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stats</span><span class="p">)</span>
</span><span id="TzimtzumESN-392"><a href="#TzimtzumESN-392"><span class="linenos">392</span></a>        
</span><span id="TzimtzumESN-393"><a href="#TzimtzumESN-393"><span class="linenos">393</span></a>        <span class="k">return</span> <span class="n">stats</span>
</span><span id="TzimtzumESN-394"><a href="#TzimtzumESN-394"><span class="linenos">394</span></a>    
</span><span id="TzimtzumESN-395"><a href="#TzimtzumESN-395"><span class="linenos">395</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_normalize_spectral_radius</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TzimtzumESN-396"><a href="#TzimtzumESN-396"><span class="linenos">396</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Renormaliza el reservoir para mantener estabilidad.&quot;&quot;&quot;</span>
</span><span id="TzimtzumESN-397"><a href="#TzimtzumESN-397"><span class="linenos">397</span></a>        <span class="n">eigenvalues</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigvals</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span><span class="p">))</span>
</span><span id="TzimtzumESN-398"><a href="#TzimtzumESN-398"><span class="linenos">398</span></a>        <span class="n">current_radius</span> <span class="o">=</span> <span class="n">eigenvalues</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">eigenvalues</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
</span><span id="TzimtzumESN-399"><a href="#TzimtzumESN-399"><span class="linenos">399</span></a>        
</span><span id="TzimtzumESN-400"><a href="#TzimtzumESN-400"><span class="linenos">400</span></a>        <span class="k">if</span> <span class="n">current_radius</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="TzimtzumESN-401"><a href="#TzimtzumESN-401"><span class="linenos">401</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectral_radius</span> <span class="o">/</span> <span class="n">current_radius</span>
</span><span id="TzimtzumESN-402"><a href="#TzimtzumESN-402"><span class="linenos">402</span></a>    
</span><span id="TzimtzumESN-403"><a href="#TzimtzumESN-403"><span class="linenos">403</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">renacimiento</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fraction</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="TzimtzumESN-404"><a href="#TzimtzumESN-404"><span class="linenos">404</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TzimtzumESN-405"><a href="#TzimtzumESN-405"><span class="linenos">405</span></a><span class="sd">        Proceso de regrowth controlado después del Dark Night.</span>
</span><span id="TzimtzumESN-406"><a href="#TzimtzumESN-406"><span class="linenos">406</span></a><span class="sd">        </span>
</span><span id="TzimtzumESN-407"><a href="#TzimtzumESN-407"><span class="linenos">407</span></a><span class="sd">        &quot;De la nada, algo nuevo puede nacer.&quot;</span>
</span><span id="TzimtzumESN-408"><a href="#TzimtzumESN-408"><span class="linenos">408</span></a><span class="sd">        </span>
</span><span id="TzimtzumESN-409"><a href="#TzimtzumESN-409"><span class="linenos">409</span></a><span class="sd">        Permite que nuevas conexiones emerjan en el vacío</span>
</span><span id="TzimtzumESN-410"><a href="#TzimtzumESN-410"><span class="linenos">410</span></a><span class="sd">        creado por el Tzimtzum.</span>
</span><span id="TzimtzumESN-411"><a href="#TzimtzumESN-411"><span class="linenos">411</span></a><span class="sd">        </span>
</span><span id="TzimtzumESN-412"><a href="#TzimtzumESN-412"><span class="linenos">412</span></a><span class="sd">        Args:</span>
</span><span id="TzimtzumESN-413"><a href="#TzimtzumESN-413"><span class="linenos">413</span></a><span class="sd">            fraction: Fracción de conexiones podadas a recrecer</span>
</span><span id="TzimtzumESN-414"><a href="#TzimtzumESN-414"><span class="linenos">414</span></a><span class="sd">            </span>
</span><span id="TzimtzumESN-415"><a href="#TzimtzumESN-415"><span class="linenos">415</span></a><span class="sd">        Returns:</span>
</span><span id="TzimtzumESN-416"><a href="#TzimtzumESN-416"><span class="linenos">416</span></a><span class="sd">            Estadísticas del regrowth</span>
</span><span id="TzimtzumESN-417"><a href="#TzimtzumESN-417"><span class="linenos">417</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TzimtzumESN-418"><a href="#TzimtzumESN-418"><span class="linenos">418</span></a>        <span class="n">fraction</span> <span class="o">=</span> <span class="n">fraction</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">regrowth_fraction</span>
</span><span id="TzimtzumESN-419"><a href="#TzimtzumESN-419"><span class="linenos">419</span></a>        
</span><span id="TzimtzumESN-420"><a href="#TzimtzumESN-420"><span class="linenos">420</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="n">ContractionPhase</span><span class="o">.</span><span class="n">RENACIMIENTO</span>
</span><span id="TzimtzumESN-421"><a href="#TzimtzumESN-421"><span class="linenos">421</span></a>        
</span><span id="TzimtzumESN-422"><a href="#TzimtzumESN-422"><span class="linenos">422</span></a>        <span class="c1"># Calcular cuántas conexiones regenerar</span>
</span><span id="TzimtzumESN-423"><a href="#TzimtzumESN-423"><span class="linenos">423</span></a>        <span class="n">pruned_this_cycle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">pruned_connections</span>
</span><span id="TzimtzumESN-424"><a href="#TzimtzumESN-424"><span class="linenos">424</span></a>        <span class="n">regrow_count</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">pruned_this_cycle</span> <span class="o">*</span> <span class="n">fraction</span><span class="p">)</span>
</span><span id="TzimtzumESN-425"><a href="#TzimtzumESN-425"><span class="linenos">425</span></a>        
</span><span id="TzimtzumESN-426"><a href="#TzimtzumESN-426"><span class="linenos">426</span></a>        <span class="k">if</span> <span class="n">regrow_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="TzimtzumESN-427"><a href="#TzimtzumESN-427"><span class="linenos">427</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="n">ContractionPhase</span><span class="o">.</span><span class="n">PLENITUD</span>
</span><span id="TzimtzumESN-428"><a href="#TzimtzumESN-428"><span class="linenos">428</span></a>            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;regrown_count&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;No hay espacio para regrowth&#39;</span><span class="p">}</span>
</span><span id="TzimtzumESN-429"><a href="#TzimtzumESN-429"><span class="linenos">429</span></a>        
</span><span id="TzimtzumESN-430"><a href="#TzimtzumESN-430"><span class="linenos">430</span></a>        <span class="c1"># Encontrar posiciones vacías</span>
</span><span id="TzimtzumESN-431"><a href="#TzimtzumESN-431"><span class="linenos">431</span></a>        <span class="n">empty_positions</span> <span class="o">=</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">_connection_mask</span>
</span><span id="TzimtzumESN-432"><a href="#TzimtzumESN-432"><span class="linenos">432</span></a>        <span class="n">empty_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">empty_positions</span><span class="p">)</span>
</span><span id="TzimtzumESN-433"><a href="#TzimtzumESN-433"><span class="linenos">433</span></a>        
</span><span id="TzimtzumESN-434"><a href="#TzimtzumESN-434"><span class="linenos">434</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">empty_indices</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="TzimtzumESN-435"><a href="#TzimtzumESN-435"><span class="linenos">435</span></a>            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;regrown_count&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;No hay posiciones vacías&#39;</span><span class="p">}</span>
</span><span id="TzimtzumESN-436"><a href="#TzimtzumESN-436"><span class="linenos">436</span></a>        
</span><span id="TzimtzumESN-437"><a href="#TzimtzumESN-437"><span class="linenos">437</span></a>        <span class="c1"># Seleccionar posiciones para regrowth</span>
</span><span id="TzimtzumESN-438"><a href="#TzimtzumESN-438"><span class="linenos">438</span></a>        <span class="n">regrow_count</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">regrow_count</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">empty_indices</span><span class="p">))</span>
</span><span id="TzimtzumESN-439"><a href="#TzimtzumESN-439"><span class="linenos">439</span></a>        <span class="n">selected_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_regrowth_rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
</span><span id="TzimtzumESN-440"><a href="#TzimtzumESN-440"><span class="linenos">440</span></a>            <span class="nb">len</span><span class="p">(</span><span class="n">empty_indices</span><span class="p">),</span> 
</span><span id="TzimtzumESN-441"><a href="#TzimtzumESN-441"><span class="linenos">441</span></a>            <span class="n">size</span><span class="o">=</span><span class="n">regrow_count</span><span class="p">,</span> 
</span><span id="TzimtzumESN-442"><a href="#TzimtzumESN-442"><span class="linenos">442</span></a>            <span class="n">replace</span><span class="o">=</span><span class="kc">False</span>
</span><span id="TzimtzumESN-443"><a href="#TzimtzumESN-443"><span class="linenos">443</span></a>        <span class="p">)</span>
</span><span id="TzimtzumESN-444"><a href="#TzimtzumESN-444"><span class="linenos">444</span></a>        
</span><span id="TzimtzumESN-445"><a href="#TzimtzumESN-445"><span class="linenos">445</span></a>        <span class="c1"># Crear nuevas conexiones con pesos pequeños</span>
</span><span id="TzimtzumESN-446"><a href="#TzimtzumESN-446"><span class="linenos">446</span></a>        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">selected_indices</span><span class="p">:</span>
</span><span id="TzimtzumESN-447"><a href="#TzimtzumESN-447"><span class="linenos">447</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">empty_indices</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
</span><span id="TzimtzumESN-448"><a href="#TzimtzumESN-448"><span class="linenos">448</span></a>            <span class="c1"># Peso inicial pequeño (debe ganarse su lugar)</span>
</span><span id="TzimtzumESN-449"><a href="#TzimtzumESN-449"><span class="linenos">449</span></a>            <span class="n">new_weight</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_regrowth_rng</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
</span><span id="TzimtzumESN-450"><a href="#TzimtzumESN-450"><span class="linenos">450</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_weight</span>
</span><span id="TzimtzumESN-451"><a href="#TzimtzumESN-451"><span class="linenos">451</span></a>        
</span><span id="TzimtzumESN-452"><a href="#TzimtzumESN-452"><span class="linenos">452</span></a>        <span class="c1"># Actualizar máscara y métricas</span>
</span><span id="TzimtzumESN-453"><a href="#TzimtzumESN-453"><span class="linenos">453</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_connection_mask</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="TzimtzumESN-454"><a href="#TzimtzumESN-454"><span class="linenos">454</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">regrown_connections</span> <span class="o">+=</span> <span class="n">regrow_count</span>
</span><span id="TzimtzumESN-455"><a href="#TzimtzumESN-455"><span class="linenos">455</span></a>        
</span><span id="TzimtzumESN-456"><a href="#TzimtzumESN-456"><span class="linenos">456</span></a>        <span class="c1"># Renormalizar</span>
</span><span id="TzimtzumESN-457"><a href="#TzimtzumESN-457"><span class="linenos">457</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_spectral_radius</span><span class="p">()</span>
</span><span id="TzimtzumESN-458"><a href="#TzimtzumESN-458"><span class="linenos">458</span></a>        
</span><span id="TzimtzumESN-459"><a href="#TzimtzumESN-459"><span class="linenos">459</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_update_state_metrics</span><span class="p">()</span>
</span><span id="TzimtzumESN-460"><a href="#TzimtzumESN-460"><span class="linenos">460</span></a>        
</span><span id="TzimtzumESN-461"><a href="#TzimtzumESN-461"><span class="linenos">461</span></a>        <span class="c1"># Volver a plenitud</span>
</span><span id="TzimtzumESN-462"><a href="#TzimtzumESN-462"><span class="linenos">462</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="n">ContractionPhase</span><span class="o">.</span><span class="n">PLENITUD</span>
</span><span id="TzimtzumESN-463"><a href="#TzimtzumESN-463"><span class="linenos">463</span></a>        
</span><span id="TzimtzumESN-464"><a href="#TzimtzumESN-464"><span class="linenos">464</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="TzimtzumESN-465"><a href="#TzimtzumESN-465"><span class="linenos">465</span></a>            <span class="s1">&#39;regrown_count&#39;</span><span class="p">:</span> <span class="n">regrow_count</span><span class="p">,</span>
</span><span id="TzimtzumESN-466"><a href="#TzimtzumESN-466"><span class="linenos">466</span></a>            <span class="s1">&#39;new_compression_ratio&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">compression_ratio</span>
</span><span id="TzimtzumESN-467"><a href="#TzimtzumESN-467"><span class="linenos">467</span></a>        <span class="p">}</span>
</span><span id="TzimtzumESN-468"><a href="#TzimtzumESN-468"><span class="linenos">468</span></a>    
</span><span id="TzimtzumESN-469"><a href="#TzimtzumESN-469"><span class="linenos">469</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">full_tzimtzum_cycle</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="TzimtzumESN-470"><a href="#TzimtzumESN-470"><span class="linenos">470</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TzimtzumESN-471"><a href="#TzimtzumESN-471"><span class="linenos">471</span></a><span class="sd">        Ejecuta un ciclo completo de Tzimtzum.</span>
</span><span id="TzimtzumESN-472"><a href="#TzimtzumESN-472"><span class="linenos">472</span></a><span class="sd">        </span>
</span><span id="TzimtzumESN-473"><a href="#TzimtzumESN-473"><span class="linenos">473</span></a><span class="sd">        PLENITUD → DARK NIGHT → CHALLAL → RENACIMIENTO → PLENITUD</span>
</span><span id="TzimtzumESN-474"><a href="#TzimtzumESN-474"><span class="linenos">474</span></a><span class="sd">        </span>
</span><span id="TzimtzumESN-475"><a href="#TzimtzumESN-475"><span class="linenos">475</span></a><span class="sd">        Returns:</span>
</span><span id="TzimtzumESN-476"><a href="#TzimtzumESN-476"><span class="linenos">476</span></a><span class="sd">            Estadísticas del ciclo completo</span>
</span><span id="TzimtzumESN-477"><a href="#TzimtzumESN-477"><span class="linenos">477</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TzimtzumESN-478"><a href="#TzimtzumESN-478"><span class="linenos">478</span></a>        <span class="c1"># Fase 1: Dark Night</span>
</span><span id="TzimtzumESN-479"><a href="#TzimtzumESN-479"><span class="linenos">479</span></a>        <span class="n">dark_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dark_night</span><span class="p">()</span>
</span><span id="TzimtzumESN-480"><a href="#TzimtzumESN-480"><span class="linenos">480</span></a>        
</span><span id="TzimtzumESN-481"><a href="#TzimtzumESN-481"><span class="linenos">481</span></a>        <span class="c1"># Fase 2: Renacimiento</span>
</span><span id="TzimtzumESN-482"><a href="#TzimtzumESN-482"><span class="linenos">482</span></a>        <span class="n">rebirth_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">renacimiento</span><span class="p">()</span>
</span><span id="TzimtzumESN-483"><a href="#TzimtzumESN-483"><span class="linenos">483</span></a>        
</span><span id="TzimtzumESN-484"><a href="#TzimtzumESN-484"><span class="linenos">484</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="TzimtzumESN-485"><a href="#TzimtzumESN-485"><span class="linenos">485</span></a>            <span class="s1">&#39;dark_night&#39;</span><span class="p">:</span> <span class="n">dark_stats</span><span class="p">,</span>
</span><span id="TzimtzumESN-486"><a href="#TzimtzumESN-486"><span class="linenos">486</span></a>            <span class="s1">&#39;renacimiento&#39;</span><span class="p">:</span> <span class="n">rebirth_stats</span><span class="p">,</span>
</span><span id="TzimtzumESN-487"><a href="#TzimtzumESN-487"><span class="linenos">487</span></a>            <span class="s1">&#39;final_connections&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">total_connections</span><span class="p">,</span>
</span><span id="TzimtzumESN-488"><a href="#TzimtzumESN-488"><span class="linenos">488</span></a>            <span class="s1">&#39;total_cycles&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">pruning_cycles</span>
</span><span id="TzimtzumESN-489"><a href="#TzimtzumESN-489"><span class="linenos">489</span></a>        <span class="p">}</span>
</span><span id="TzimtzumESN-490"><a href="#TzimtzumESN-490"><span class="linenos">490</span></a>    
</span><span id="TzimtzumESN-491"><a href="#TzimtzumESN-491"><span class="linenos">491</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_update_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_vector</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="TzimtzumESN-492"><a href="#TzimtzumESN-492"><span class="linenos">492</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TzimtzumESN-493"><a href="#TzimtzumESN-493"><span class="linenos">493</span></a><span class="sd">        Actualiza estado con tracking de importancia.</span>
</span><span id="TzimtzumESN-494"><a href="#TzimtzumESN-494"><span class="linenos">494</span></a><span class="sd">        </span>
</span><span id="TzimtzumESN-495"><a href="#TzimtzumESN-495"><span class="linenos">495</span></a><span class="sd">        Además del forward normal, acumula información sobre</span>
</span><span id="TzimtzumESN-496"><a href="#TzimtzumESN-496"><span class="linenos">496</span></a><span class="sd">        qué conexiones están siendo utilizadas activamente.</span>
</span><span id="TzimtzumESN-497"><a href="#TzimtzumESN-497"><span class="linenos">497</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TzimtzumESN-498"><a href="#TzimtzumESN-498"><span class="linenos">498</span></a>        <span class="c1"># Forward normal</span>
</span><span id="TzimtzumESN-499"><a href="#TzimtzumESN-499"><span class="linenos">499</span></a>        <span class="n">new_state</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_update_state</span><span class="p">(</span><span class="n">input_vector</span><span class="p">)</span>
</span><span id="TzimtzumESN-500"><a href="#TzimtzumESN-500"><span class="linenos">500</span></a>        
</span><span id="TzimtzumESN-501"><a href="#TzimtzumESN-501"><span class="linenos">501</span></a>        <span class="c1"># Actualizar importancia basada en activación</span>
</span><span id="TzimtzumESN-502"><a href="#TzimtzumESN-502"><span class="linenos">502</span></a>        <span class="c1"># Conexiones usadas por neuronas activas son más importantes</span>
</span><span id="TzimtzumESN-503"><a href="#TzimtzumESN-503"><span class="linenos">503</span></a>        <span class="n">activation_importance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span>
</span><span id="TzimtzumESN-504"><a href="#TzimtzumESN-504"><span class="linenos">504</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">new_state</span><span class="p">),</span>  <span class="c1"># Post-synaptic</span>
</span><span id="TzimtzumESN-505"><a href="#TzimtzumESN-505"><span class="linenos">505</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">)</span>  <span class="c1"># Pre-synaptic</span>
</span><span id="TzimtzumESN-506"><a href="#TzimtzumESN-506"><span class="linenos">506</span></a>        <span class="p">)</span>
</span><span id="TzimtzumESN-507"><a href="#TzimtzumESN-507"><span class="linenos">507</span></a>        
</span><span id="TzimtzumESN-508"><a href="#TzimtzumESN-508"><span class="linenos">508</span></a>        <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.95</span>
</span><span id="TzimtzumESN-509"><a href="#TzimtzumESN-509"><span class="linenos">509</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_connection_importance</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="TzimtzumESN-510"><a href="#TzimtzumESN-510"><span class="linenos">510</span></a>            <span class="n">alpha</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection_importance</span> <span class="o">+</span>
</span><span id="TzimtzumESN-511"><a href="#TzimtzumESN-511"><span class="linenos">511</span></a>            <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">activation_importance</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span><span class="p">)</span>
</span><span id="TzimtzumESN-512"><a href="#TzimtzumESN-512"><span class="linenos">512</span></a>        <span class="p">)</span>
</span><span id="TzimtzumESN-513"><a href="#TzimtzumESN-513"><span class="linenos">513</span></a>        
</span><span id="TzimtzumESN-514"><a href="#TzimtzumESN-514"><span class="linenos">514</span></a>        <span class="c1"># Auto-poda si está configurado</span>
</span><span id="TzimtzumESN-515"><a href="#TzimtzumESN-515"><span class="linenos">515</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_step_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="TzimtzumESN-516"><a href="#TzimtzumESN-516"><span class="linenos">516</span></a>        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">dark_night_interval</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> 
</span><span id="TzimtzumESN-517"><a href="#TzimtzumESN-517"><span class="linenos">517</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_step_count</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">dark_night_interval</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="TzimtzumESN-518"><a href="#TzimtzumESN-518"><span class="linenos">518</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">full_tzimtzum_cycle</span><span class="p">()</span>
</span><span id="TzimtzumESN-519"><a href="#TzimtzumESN-519"><span class="linenos">519</span></a>        
</span><span id="TzimtzumESN-520"><a href="#TzimtzumESN-520"><span class="linenos">520</span></a>        <span class="k">return</span> <span class="n">new_state</span>
</span><span id="TzimtzumESN-521"><a href="#TzimtzumESN-521"><span class="linenos">521</span></a>    
</span><span id="TzimtzumESN-522"><a href="#TzimtzumESN-522"><span class="linenos">522</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_sparsity_report</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="TzimtzumESN-523"><a href="#TzimtzumESN-523"><span class="linenos">523</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TzimtzumESN-524"><a href="#TzimtzumESN-524"><span class="linenos">524</span></a><span class="sd">        Genera reporte detallado de sparsity actual.</span>
</span><span id="TzimtzumESN-525"><a href="#TzimtzumESN-525"><span class="linenos">525</span></a><span class="sd">        </span>
</span><span id="TzimtzumESN-526"><a href="#TzimtzumESN-526"><span class="linenos">526</span></a><span class="sd">        Returns:</span>
</span><span id="TzimtzumESN-527"><a href="#TzimtzumESN-527"><span class="linenos">527</span></a><span class="sd">            Diccionario con métricas de sparsity</span>
</span><span id="TzimtzumESN-528"><a href="#TzimtzumESN-528"><span class="linenos">528</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TzimtzumESN-529"><a href="#TzimtzumESN-529"><span class="linenos">529</span></a>        <span class="n">total_possible</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_reservoir</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="TzimtzumESN-530"><a href="#TzimtzumESN-530"><span class="linenos">530</span></a>        <span class="n">active</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_connection_mask</span><span class="p">)</span>
</span><span id="TzimtzumESN-531"><a href="#TzimtzumESN-531"><span class="linenos">531</span></a>        
</span><span id="TzimtzumESN-532"><a href="#TzimtzumESN-532"><span class="linenos">532</span></a>        <span class="c1"># Distribución de pesos</span>
</span><span id="TzimtzumESN-533"><a href="#TzimtzumESN-533"><span class="linenos">533</span></a>        <span class="n">active_weights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_connection_mask</span><span class="p">]</span>
</span><span id="TzimtzumESN-534"><a href="#TzimtzumESN-534"><span class="linenos">534</span></a>        
</span><span id="TzimtzumESN-535"><a href="#TzimtzumESN-535"><span class="linenos">535</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">active_weights</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="TzimtzumESN-536"><a href="#TzimtzumESN-536"><span class="linenos">536</span></a>            <span class="n">weight_stats</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="TzimtzumESN-537"><a href="#TzimtzumESN-537"><span class="linenos">537</span></a>                <span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">active_weights</span><span class="p">)),</span>
</span><span id="TzimtzumESN-538"><a href="#TzimtzumESN-538"><span class="linenos">538</span></a>                <span class="s1">&#39;std&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">active_weights</span><span class="p">)),</span>
</span><span id="TzimtzumESN-539"><a href="#TzimtzumESN-539"><span class="linenos">539</span></a>                <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">active_weights</span><span class="p">)),</span>
</span><span id="TzimtzumESN-540"><a href="#TzimtzumESN-540"><span class="linenos">540</span></a>                <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">active_weights</span><span class="p">)),</span>
</span><span id="TzimtzumESN-541"><a href="#TzimtzumESN-541"><span class="linenos">541</span></a>                <span class="s1">&#39;median&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">active_weights</span><span class="p">))</span>
</span><span id="TzimtzumESN-542"><a href="#TzimtzumESN-542"><span class="linenos">542</span></a>            <span class="p">}</span>
</span><span id="TzimtzumESN-543"><a href="#TzimtzumESN-543"><span class="linenos">543</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TzimtzumESN-544"><a href="#TzimtzumESN-544"><span class="linenos">544</span></a>            <span class="n">weight_stats</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;median&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</span><span id="TzimtzumESN-545"><a href="#TzimtzumESN-545"><span class="linenos">545</span></a>        
</span><span id="TzimtzumESN-546"><a href="#TzimtzumESN-546"><span class="linenos">546</span></a>        <span class="c1"># Conectividad por neurona</span>
</span><span id="TzimtzumESN-547"><a href="#TzimtzumESN-547"><span class="linenos">547</span></a>        <span class="n">in_degree</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_connection_mask</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="TzimtzumESN-548"><a href="#TzimtzumESN-548"><span class="linenos">548</span></a>        <span class="n">out_degree</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_connection_mask</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="TzimtzumESN-549"><a href="#TzimtzumESN-549"><span class="linenos">549</span></a>        
</span><span id="TzimtzumESN-550"><a href="#TzimtzumESN-550"><span class="linenos">550</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="TzimtzumESN-551"><a href="#TzimtzumESN-551"><span class="linenos">551</span></a>            <span class="s1">&#39;total_possible_connections&#39;</span><span class="p">:</span> <span class="n">total_possible</span><span class="p">,</span>
</span><span id="TzimtzumESN-552"><a href="#TzimtzumESN-552"><span class="linenos">552</span></a>            <span class="s1">&#39;active_connections&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">active</span><span class="p">),</span>
</span><span id="TzimtzumESN-553"><a href="#TzimtzumESN-553"><span class="linenos">553</span></a>            <span class="s1">&#39;sparsity&#39;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">active</span> <span class="o">/</span> <span class="n">total_possible</span><span class="p">),</span>
</span><span id="TzimtzumESN-554"><a href="#TzimtzumESN-554"><span class="linenos">554</span></a>            <span class="s1">&#39;compression_ratio&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">compression_ratio</span><span class="p">,</span>
</span><span id="TzimtzumESN-555"><a href="#TzimtzumESN-555"><span class="linenos">555</span></a>            <span class="s1">&#39;weight_statistics&#39;</span><span class="p">:</span> <span class="n">weight_stats</span><span class="p">,</span>
</span><span id="TzimtzumESN-556"><a href="#TzimtzumESN-556"><span class="linenos">556</span></a>            <span class="s1">&#39;connectivity&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="TzimtzumESN-557"><a href="#TzimtzumESN-557"><span class="linenos">557</span></a>                <span class="s1">&#39;mean_in_degree&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">in_degree</span><span class="p">)),</span>
</span><span id="TzimtzumESN-558"><a href="#TzimtzumESN-558"><span class="linenos">558</span></a>                <span class="s1">&#39;mean_out_degree&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">out_degree</span><span class="p">)),</span>
</span><span id="TzimtzumESN-559"><a href="#TzimtzumESN-559"><span class="linenos">559</span></a>                <span class="s1">&#39;isolated_neurons&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">in_degree</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">out_degree</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)))</span>
</span><span id="TzimtzumESN-560"><a href="#TzimtzumESN-560"><span class="linenos">560</span></a>            <span class="p">},</span>
</span><span id="TzimtzumESN-561"><a href="#TzimtzumESN-561"><span class="linenos">561</span></a>            <span class="s1">&#39;tzimtzum_state&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
</span><span id="TzimtzumESN-562"><a href="#TzimtzumESN-562"><span class="linenos">562</span></a>            <span class="s1">&#39;pruning_history&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pruning_history</span>
</span><span id="TzimtzumESN-563"><a href="#TzimtzumESN-563"><span class="linenos">563</span></a>        <span class="p">}</span>
</span><span id="TzimtzumESN-564"><a href="#TzimtzumESN-564"><span class="linenos">564</span></a>    
</span><span id="TzimtzumESN-565"><a href="#TzimtzumESN-565"><span class="linenos">565</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">visualize_contraction</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="TzimtzumESN-566"><a href="#TzimtzumESN-566"><span class="linenos">566</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TzimtzumESN-567"><a href="#TzimtzumESN-567"><span class="linenos">567</span></a><span class="sd">        Genera visualización ASCII del estado de contracción.</span>
</span><span id="TzimtzumESN-568"><a href="#TzimtzumESN-568"><span class="linenos">568</span></a><span class="sd">        </span>
</span><span id="TzimtzumESN-569"><a href="#TzimtzumESN-569"><span class="linenos">569</span></a><span class="sd">        Returns:</span>
</span><span id="TzimtzumESN-570"><a href="#TzimtzumESN-570"><span class="linenos">570</span></a><span class="sd">            String con visualización ASCII</span>
</span><span id="TzimtzumESN-571"><a href="#TzimtzumESN-571"><span class="linenos">571</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TzimtzumESN-572"><a href="#TzimtzumESN-572"><span class="linenos">572</span></a>        <span class="n">phase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">phase</span><span class="o">.</span><span class="n">name</span>
</span><span id="TzimtzumESN-573"><a href="#TzimtzumESN-573"><span class="linenos">573</span></a>        <span class="n">ratio</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">compression_ratio</span>
</span><span id="TzimtzumESN-574"><a href="#TzimtzumESN-574"><span class="linenos">574</span></a>        <span class="n">cycles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">pruning_cycles</span>
</span><span id="TzimtzumESN-575"><a href="#TzimtzumESN-575"><span class="linenos">575</span></a>        
</span><span id="TzimtzumESN-576"><a href="#TzimtzumESN-576"><span class="linenos">576</span></a>        <span class="c1"># Barra de compresión visual</span>
</span><span id="TzimtzumESN-577"><a href="#TzimtzumESN-577"><span class="linenos">577</span></a>        <span class="n">bar_width</span> <span class="o">=</span> <span class="mi">40</span>
</span><span id="TzimtzumESN-578"><a href="#TzimtzumESN-578"><span class="linenos">578</span></a>        <span class="n">filled</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ratio</span> <span class="o">*</span> <span class="n">bar_width</span><span class="p">)</span>
</span><span id="TzimtzumESN-579"><a href="#TzimtzumESN-579"><span class="linenos">579</span></a>        <span class="n">empty</span> <span class="o">=</span> <span class="n">bar_width</span> <span class="o">-</span> <span class="n">filled</span>
</span><span id="TzimtzumESN-580"><a href="#TzimtzumESN-580"><span class="linenos">580</span></a>        <span class="n">bar</span> <span class="o">=</span> <span class="s1">&#39;█&#39;</span> <span class="o">*</span> <span class="n">filled</span> <span class="o">+</span> <span class="s1">&#39;░&#39;</span> <span class="o">*</span> <span class="n">empty</span>
</span><span id="TzimtzumESN-581"><a href="#TzimtzumESN-581"><span class="linenos">581</span></a>        
</span><span id="TzimtzumESN-582"><a href="#TzimtzumESN-582"><span class="linenos">582</span></a>        <span class="c1"># Fase emoji</span>
</span><span id="TzimtzumESN-583"><a href="#TzimtzumESN-583"><span class="linenos">583</span></a>        <span class="n">phase_emoji</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="TzimtzumESN-584"><a href="#TzimtzumESN-584"><span class="linenos">584</span></a>            <span class="s1">&#39;PLENITUD&#39;</span><span class="p">:</span> <span class="s1">&#39;🌕&#39;</span><span class="p">,</span>
</span><span id="TzimtzumESN-585"><a href="#TzimtzumESN-585"><span class="linenos">585</span></a>            <span class="s1">&#39;DARK_NIGHT&#39;</span><span class="p">:</span> <span class="s1">&#39;🌑&#39;</span><span class="p">,</span>
</span><span id="TzimtzumESN-586"><a href="#TzimtzumESN-586"><span class="linenos">586</span></a>            <span class="s1">&#39;CHALLAL&#39;</span><span class="p">:</span> <span class="s1">&#39;⚫&#39;</span><span class="p">,</span>
</span><span id="TzimtzumESN-587"><a href="#TzimtzumESN-587"><span class="linenos">587</span></a>            <span class="s1">&#39;RENACIMIENTO&#39;</span><span class="p">:</span> <span class="s1">&#39;🌅&#39;</span>
</span><span id="TzimtzumESN-588"><a href="#TzimtzumESN-588"><span class="linenos">588</span></a>        <span class="p">}</span>
</span><span id="TzimtzumESN-589"><a href="#TzimtzumESN-589"><span class="linenos">589</span></a>        
</span><span id="TzimtzumESN-590"><a href="#TzimtzumESN-590"><span class="linenos">590</span></a>        <span class="n">viz</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="TzimtzumESN-591"><a href="#TzimtzumESN-591"><span class="linenos">591</span></a><span class="s2">╔════════════════════════════════════════════════════╗</span>
</span><span id="TzimtzumESN-592"><a href="#TzimtzumESN-592"><span class="linenos">592</span></a><span class="s2">║              TZIMTZUM STATE MONITOR                ║</span>
</span><span id="TzimtzumESN-593"><a href="#TzimtzumESN-593"><span class="linenos">593</span></a><span class="s2">╠════════════════════════════════════════════════════╣</span>
</span><span id="TzimtzumESN-594"><a href="#TzimtzumESN-594"><span class="linenos">594</span></a><span class="s2">║  Phase: </span><span class="si">{</span><span class="n">phase_emoji</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">phase</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;○&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">phase</span><span class="si">:</span><span class="s2">15s</span><span class="si">}</span><span class="s2">                  ║</span>
</span><span id="TzimtzumESN-595"><a href="#TzimtzumESN-595"><span class="linenos">595</span></a><span class="s2">║                                                    ║</span>
</span><span id="TzimtzumESN-596"><a href="#TzimtzumESN-596"><span class="linenos">596</span></a><span class="s2">║  Compression: [</span><span class="si">{</span><span class="n">bar</span><span class="si">}</span><span class="s2">]                              ║</span>
</span><span id="TzimtzumESN-597"><a href="#TzimtzumESN-597"><span class="linenos">597</span></a><span class="s2">║  Ratio: </span><span class="si">{</span><span class="n">ratio</span><span class="si">:</span><span class="s2">.1%</span><span class="si">}</span><span class="s2"> of original connections         ║</span>
</span><span id="TzimtzumESN-598"><a href="#TzimtzumESN-598"><span class="linenos">598</span></a><span class="s2">║                                                    ║</span>
</span><span id="TzimtzumESN-599"><a href="#TzimtzumESN-599"><span class="linenos">599</span></a><span class="s2">║  📊 Statistics:                                    ║</span>
</span><span id="TzimtzumESN-600"><a href="#TzimtzumESN-600"><span class="linenos">600</span></a><span class="s2">║     Total Connections: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">total_connections</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">                      ║</span>
</span><span id="TzimtzumESN-601"><a href="#TzimtzumESN-601"><span class="linenos">601</span></a><span class="s2">║     Pruned Total:      </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">pruned_connections</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">                      ║</span>
</span><span id="TzimtzumESN-602"><a href="#TzimtzumESN-602"><span class="linenos">602</span></a><span class="s2">║     Regrown Total:     </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">regrown_connections</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">                       ║</span>
</span><span id="TzimtzumESN-603"><a href="#TzimtzumESN-603"><span class="linenos">603</span></a><span class="s2">║     Dark Night Cycles: </span><span class="si">{</span><span class="n">cycles</span><span class="si">}</span><span class="s2">                           ║</span>
</span><span id="TzimtzumESN-604"><a href="#TzimtzumESN-604"><span class="linenos">604</span></a><span class="s2">║     Memory Saved:      </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">memory_saved_bytes</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2"> bytes              ║</span>
</span><span id="TzimtzumESN-605"><a href="#TzimtzumESN-605"><span class="linenos">605</span></a><span class="s2">╚════════════════════════════════════════════════════╝</span>
</span><span id="TzimtzumESN-606"><a href="#TzimtzumESN-606"><span class="linenos">606</span></a><span class="s2">&quot;&quot;&quot;</span>
</span><span id="TzimtzumESN-607"><a href="#TzimtzumESN-607"><span class="linenos">607</span></a>        <span class="k">return</span> <span class="n">viz</span>
</span></pre></div>


            <div class="docstring"><p>Echo State Network con protocolo de contracción Tzimtzum.</p>

<p>Implementa poda sináptica dinámica inspirada en:</p>

<ul>
<li>Tzimtzum cabalístico (contracción del infinito)</li>
<li>Poda sináptica biológica (adolescencia neuronal)</li>
<li>Lottery Ticket Hypothesis (redes sparse superiores)</li>
</ul>

<p>FILOSOFÍA:
──────────
"La vasija que está llena no puede recibir más agua.
 Solo el vacío puede ser llenado."</p>

<p>Una red saturada de conexiones pierde la capacidad de
aprender patrones nuevos. El Tzimtzum crea espacio para
el crecimiento futuro eliminando las conexiones más débiles.</p>

<p>PROCESO:
────────</p>

<ol>
<li>PLENITUD: Red opera normalmente, acumulando conexiones</li>
<li>DARK NIGHT: Identificar y podar el 50% más débil</li>
<li>CHALLAL: Estado de vacío, mínima conectividad</li>
<li>RENACIMIENTO: Regrowth selectivo de nuevas conexiones</li>
</ol>

<p>Ejemplo:</p>

<blockquote>
  <blockquote>
    <blockquote>
      <p>tzim = TzimtzumESN(
          ...     input_size=3,
          ...     reservoir_size=100,
          ...     config=TzimtzumConfig(pruning_fraction=0.5)
          ... )</p>
      
      <h1 id="entrenar-normalmente">Entrenar normalmente</h1>
      
      <p>tzim.fit(X_train, y_train)</p>
      
      <h1 id="ejecutar-dark-night-poda">Ejecutar Dark Night (poda)</h1>
      
      <p>stats = tzim.dark_night()
      print(f"Podadas {stats['pruned_count']} conexiones")</p>
      
      <h1 id="el-reservoir-ahora-tiene-50-menos-conexiones">El reservoir ahora tiene 50% menos conexiones</h1>
      
      <h1 id="pero-mantiene-o-mejora-su-capacidad">pero mantiene (o mejora) su capacidad</h1>
    </blockquote>
  </blockquote>
</blockquote>
</div>


                            <div id="TzimtzumESN.__init__" class="classattr">
                                        <input id="TzimtzumESN.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">TzimtzumESN</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">n_inputs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">n_reservoir</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span>,</span><span class="param">	<span class="n">n_outputs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">spectral_radius</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.9</span>,</span><span class="param">	<span class="n">sparsity</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.9</span>,</span><span class="param">	<span class="n">noise</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.001</span>,</span><span class="param">	<span class="n">config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n"><a href="#TzimtzumConfig">TzimtzumConfig</a></span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">random_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="TzimtzumESN.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TzimtzumESN.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TzimtzumESN.__init__-181"><a href="#TzimtzumESN.__init__-181"><span class="linenos">181</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="TzimtzumESN.__init__-182"><a href="#TzimtzumESN.__init__-182"><span class="linenos">182</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="TzimtzumESN.__init__-183"><a href="#TzimtzumESN.__init__-183"><span class="linenos">183</span></a>        <span class="n">n_inputs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="TzimtzumESN.__init__-184"><a href="#TzimtzumESN.__init__-184"><span class="linenos">184</span></a>        <span class="n">n_reservoir</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
</span><span id="TzimtzumESN.__init__-185"><a href="#TzimtzumESN.__init__-185"><span class="linenos">185</span></a>        <span class="n">n_outputs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="TzimtzumESN.__init__-186"><a href="#TzimtzumESN.__init__-186"><span class="linenos">186</span></a>        <span class="n">spectral_radius</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span>
</span><span id="TzimtzumESN.__init__-187"><a href="#TzimtzumESN.__init__-187"><span class="linenos">187</span></a>        <span class="n">sparsity</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span>
</span><span id="TzimtzumESN.__init__-188"><a href="#TzimtzumESN.__init__-188"><span class="linenos">188</span></a>        <span class="n">noise</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">,</span>
</span><span id="TzimtzumESN.__init__-189"><a href="#TzimtzumESN.__init__-189"><span class="linenos">189</span></a>        <span class="n">config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TzimtzumConfig</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TzimtzumESN.__init__-190"><a href="#TzimtzumESN.__init__-190"><span class="linenos">190</span></a>        <span class="n">random_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TzimtzumESN.__init__-191"><a href="#TzimtzumESN.__init__-191"><span class="linenos">191</span></a>    <span class="p">):</span>
</span><span id="TzimtzumESN.__init__-192"><a href="#TzimtzumESN.__init__-192"><span class="linenos">192</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TzimtzumESN.__init__-193"><a href="#TzimtzumESN.__init__-193"><span class="linenos">193</span></a><span class="sd">        Inicializa TzimtzumESN.</span>
</span><span id="TzimtzumESN.__init__-194"><a href="#TzimtzumESN.__init__-194"><span class="linenos">194</span></a><span class="sd">        </span>
</span><span id="TzimtzumESN.__init__-195"><a href="#TzimtzumESN.__init__-195"><span class="linenos">195</span></a><span class="sd">        Args:</span>
</span><span id="TzimtzumESN.__init__-196"><a href="#TzimtzumESN.__init__-196"><span class="linenos">196</span></a><span class="sd">            n_inputs: Dimensión de entrada</span>
</span><span id="TzimtzumESN.__init__-197"><a href="#TzimtzumESN.__init__-197"><span class="linenos">197</span></a><span class="sd">            n_reservoir: Número de neuronas en reservoir</span>
</span><span id="TzimtzumESN.__init__-198"><a href="#TzimtzumESN.__init__-198"><span class="linenos">198</span></a><span class="sd">            n_outputs: Dimensión de salida</span>
</span><span id="TzimtzumESN.__init__-199"><a href="#TzimtzumESN.__init__-199"><span class="linenos">199</span></a><span class="sd">            spectral_radius: Radio espectral del reservoir</span>
</span><span id="TzimtzumESN.__init__-200"><a href="#TzimtzumESN.__init__-200"><span class="linenos">200</span></a><span class="sd">            sparsity: Sparsity inicial (fracción de ceros)</span>
</span><span id="TzimtzumESN.__init__-201"><a href="#TzimtzumESN.__init__-201"><span class="linenos">201</span></a><span class="sd">            noise: Ruido de regularización</span>
</span><span id="TzimtzumESN.__init__-202"><a href="#TzimtzumESN.__init__-202"><span class="linenos">202</span></a><span class="sd">            config: Configuración Tzimtzum</span>
</span><span id="TzimtzumESN.__init__-203"><a href="#TzimtzumESN.__init__-203"><span class="linenos">203</span></a><span class="sd">            random_state: Semilla aleatoria</span>
</span><span id="TzimtzumESN.__init__-204"><a href="#TzimtzumESN.__init__-204"><span class="linenos">204</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TzimtzumESN.__init__-205"><a href="#TzimtzumESN.__init__-205"><span class="linenos">205</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="TzimtzumESN.__init__-206"><a href="#TzimtzumESN.__init__-206"><span class="linenos">206</span></a>            <span class="n">n_inputs</span><span class="o">=</span><span class="n">n_inputs</span><span class="p">,</span>
</span><span id="TzimtzumESN.__init__-207"><a href="#TzimtzumESN.__init__-207"><span class="linenos">207</span></a>            <span class="n">n_reservoir</span><span class="o">=</span><span class="n">n_reservoir</span><span class="p">,</span>
</span><span id="TzimtzumESN.__init__-208"><a href="#TzimtzumESN.__init__-208"><span class="linenos">208</span></a>            <span class="n">n_outputs</span><span class="o">=</span><span class="n">n_outputs</span><span class="p">,</span>
</span><span id="TzimtzumESN.__init__-209"><a href="#TzimtzumESN.__init__-209"><span class="linenos">209</span></a>            <span class="n">spectral_radius</span><span class="o">=</span><span class="n">spectral_radius</span><span class="p">,</span>
</span><span id="TzimtzumESN.__init__-210"><a href="#TzimtzumESN.__init__-210"><span class="linenos">210</span></a>            <span class="n">sparsity</span><span class="o">=</span><span class="n">sparsity</span><span class="p">,</span>
</span><span id="TzimtzumESN.__init__-211"><a href="#TzimtzumESN.__init__-211"><span class="linenos">211</span></a>            <span class="n">noise</span><span class="o">=</span><span class="n">noise</span><span class="p">,</span>
</span><span id="TzimtzumESN.__init__-212"><a href="#TzimtzumESN.__init__-212"><span class="linenos">212</span></a>            <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span>
</span><span id="TzimtzumESN.__init__-213"><a href="#TzimtzumESN.__init__-213"><span class="linenos">213</span></a>        <span class="p">)</span>
</span><span id="TzimtzumESN.__init__-214"><a href="#TzimtzumESN.__init__-214"><span class="linenos">214</span></a>        
</span><span id="TzimtzumESN.__init__-215"><a href="#TzimtzumESN.__init__-215"><span class="linenos">215</span></a>        <span class="c1"># Alias for compatibility</span>
</span><span id="TzimtzumESN.__init__-216"><a href="#TzimtzumESN.__init__-216"><span class="linenos">216</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_reservoir</span> <span class="o">=</span> <span class="n">n_reservoir</span>
</span><span id="TzimtzumESN.__init__-217"><a href="#TzimtzumESN.__init__-217"><span class="linenos">217</span></a>        
</span><span id="TzimtzumESN.__init__-218"><a href="#TzimtzumESN.__init__-218"><span class="linenos">218</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span> <span class="ow">or</span> <span class="n">TzimtzumConfig</span><span class="p">()</span>
</span><span id="TzimtzumESN.__init__-219"><a href="#TzimtzumESN.__init__-219"><span class="linenos">219</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span> <span class="o">=</span> <span class="n">TzimtzumState</span><span class="p">()</span>
</span><span id="TzimtzumESN.__init__-220"><a href="#TzimtzumESN.__init__-220"><span class="linenos">220</span></a>        
</span><span id="TzimtzumESN.__init__-221"><a href="#TzimtzumESN.__init__-221"><span class="linenos">221</span></a>        <span class="c1"># RNG para regrowth</span>
</span><span id="TzimtzumESN.__init__-222"><a href="#TzimtzumESN.__init__-222"><span class="linenos">222</span></a>        <span class="n">regrowth_seed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">regrowth_seed</span> <span class="ow">or</span> <span class="n">random_state</span>
</span><span id="TzimtzumESN.__init__-223"><a href="#TzimtzumESN.__init__-223"><span class="linenos">223</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_regrowth_rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">regrowth_seed</span><span class="p">)</span>
</span><span id="TzimtzumESN.__init__-224"><a href="#TzimtzumESN.__init__-224"><span class="linenos">224</span></a>        
</span><span id="TzimtzumESN.__init__-225"><a href="#TzimtzumESN.__init__-225"><span class="linenos">225</span></a>        <span class="c1"># Máscara de conexiones activas</span>
</span><span id="TzimtzumESN.__init__-226"><a href="#TzimtzumESN.__init__-226"><span class="linenos">226</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_connection_mask</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="TzimtzumESN.__init__-227"><a href="#TzimtzumESN.__init__-227"><span class="linenos">227</span></a>        
</span><span id="TzimtzumESN.__init__-228"><a href="#TzimtzumESN.__init__-228"><span class="linenos">228</span></a>        <span class="c1"># Importancia de conexiones (actualizada durante forward)</span>
</span><span id="TzimtzumESN.__init__-229"><a href="#TzimtzumESN.__init__-229"><span class="linenos">229</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_connection_importance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span><span class="p">)</span>
</span><span id="TzimtzumESN.__init__-230"><a href="#TzimtzumESN.__init__-230"><span class="linenos">230</span></a>        
</span><span id="TzimtzumESN.__init__-231"><a href="#TzimtzumESN.__init__-231"><span class="linenos">231</span></a>        <span class="c1"># Historial para análisis</span>
</span><span id="TzimtzumESN.__init__-232"><a href="#TzimtzumESN.__init__-232"><span class="linenos">232</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pruning_history</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="TzimtzumESN.__init__-233"><a href="#TzimtzumESN.__init__-233"><span class="linenos">233</span></a>        
</span><span id="TzimtzumESN.__init__-234"><a href="#TzimtzumESN.__init__-234"><span class="linenos">234</span></a>        <span class="c1"># Contador de pasos para auto-poda</span>
</span><span id="TzimtzumESN.__init__-235"><a href="#TzimtzumESN.__init__-235"><span class="linenos">235</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_step_count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="TzimtzumESN.__init__-236"><a href="#TzimtzumESN.__init__-236"><span class="linenos">236</span></a>        
</span><span id="TzimtzumESN.__init__-237"><a href="#TzimtzumESN.__init__-237"><span class="linenos">237</span></a>        <span class="c1"># Inicializar métricas</span>
</span><span id="TzimtzumESN.__init__-238"><a href="#TzimtzumESN.__init__-238"><span class="linenos">238</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_update_state_metrics</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Inicializa TzimtzumESN.</p>

<p>Args:
    n_inputs: Dimensión de entrada
    n_reservoir: Número de neuronas en reservoir
    n_outputs: Dimensión de salida
    spectral_radius: Radio espectral del reservoir
    sparsity: Sparsity inicial (fracción de ceros)
    noise: Ruido de regularización
    config: Configuración Tzimtzum
    random_state: Semilla aleatoria</p>
</div>


                            </div>
                            <div id="TzimtzumESN.n_reservoir" class="classattr">
                                <div class="attr variable">
            <span class="name">n_reservoir</span>

        
    </div>
    <a class="headerlink" href="#TzimtzumESN.n_reservoir"></a>
    
    

                            </div>
                            <div id="TzimtzumESN.config" class="classattr">
                                <div class="attr variable">
            <span class="name">config</span>

        
    </div>
    <a class="headerlink" href="#TzimtzumESN.config"></a>
    
    

                            </div>
                            <div id="TzimtzumESN.tzimtzum_state" class="classattr">
                                <div class="attr variable">
            <span class="name">tzimtzum_state</span>

        
    </div>
    <a class="headerlink" href="#TzimtzumESN.tzimtzum_state"></a>
    
    

                            </div>
                            <div id="TzimtzumESN.dark_night" class="classattr">
                                        <input id="TzimtzumESN.dark_night-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">dark_night</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">fraction</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">Dict</span>:</span></span>

                <label class="view-source-button" for="TzimtzumESN.dark_night-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TzimtzumESN.dark_night"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TzimtzumESN.dark_night-271"><a href="#TzimtzumESN.dark_night-271"><span class="linenos">271</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">dark_night</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fraction</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="TzimtzumESN.dark_night-272"><a href="#TzimtzumESN.dark_night-272"><span class="linenos">272</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TzimtzumESN.dark_night-273"><a href="#TzimtzumESN.dark_night-273"><span class="linenos">273</span></a><span class="sd">        Ejecuta el proceso de Dark Night (poda masiva).</span>
</span><span id="TzimtzumESN.dark_night-274"><a href="#TzimtzumESN.dark_night-274"><span class="linenos">274</span></a><span class="sd">        </span>
</span><span id="TzimtzumESN.dark_night-275"><a href="#TzimtzumESN.dark_night-275"><span class="linenos">275</span></a><span class="sd">        &quot;En la noche oscura del alma, brillan más las estrellas.&quot;</span>
</span><span id="TzimtzumESN.dark_night-276"><a href="#TzimtzumESN.dark_night-276"><span class="linenos">276</span></a><span class="sd">        - San Juan de la Cruz</span>
</span><span id="TzimtzumESN.dark_night-277"><a href="#TzimtzumESN.dark_night-277"><span class="linenos">277</span></a><span class="sd">        </span>
</span><span id="TzimtzumESN.dark_night-278"><a href="#TzimtzumESN.dark_night-278"><span class="linenos">278</span></a><span class="sd">        Este método elimina una fracción de las conexiones más débiles</span>
</span><span id="TzimtzumESN.dark_night-279"><a href="#TzimtzumESN.dark_night-279"><span class="linenos">279</span></a><span class="sd">        del reservoir, creando espacio para nuevo aprendizaje.</span>
</span><span id="TzimtzumESN.dark_night-280"><a href="#TzimtzumESN.dark_night-280"><span class="linenos">280</span></a><span class="sd">        </span>
</span><span id="TzimtzumESN.dark_night-281"><a href="#TzimtzumESN.dark_night-281"><span class="linenos">281</span></a><span class="sd">        Args:</span>
</span><span id="TzimtzumESN.dark_night-282"><a href="#TzimtzumESN.dark_night-282"><span class="linenos">282</span></a><span class="sd">            fraction: Fracción de conexiones a podar (default: config)</span>
</span><span id="TzimtzumESN.dark_night-283"><a href="#TzimtzumESN.dark_night-283"><span class="linenos">283</span></a><span class="sd">            </span>
</span><span id="TzimtzumESN.dark_night-284"><a href="#TzimtzumESN.dark_night-284"><span class="linenos">284</span></a><span class="sd">        Returns:</span>
</span><span id="TzimtzumESN.dark_night-285"><a href="#TzimtzumESN.dark_night-285"><span class="linenos">285</span></a><span class="sd">            Estadísticas del proceso de poda</span>
</span><span id="TzimtzumESN.dark_night-286"><a href="#TzimtzumESN.dark_night-286"><span class="linenos">286</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TzimtzumESN.dark_night-287"><a href="#TzimtzumESN.dark_night-287"><span class="linenos">287</span></a>        <span class="n">fraction</span> <span class="o">=</span> <span class="n">fraction</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">pruning_fraction</span>
</span><span id="TzimtzumESN.dark_night-288"><a href="#TzimtzumESN.dark_night-288"><span class="linenos">288</span></a>        
</span><span id="TzimtzumESN.dark_night-289"><a href="#TzimtzumESN.dark_night-289"><span class="linenos">289</span></a>        <span class="c1"># Cambiar fase</span>
</span><span id="TzimtzumESN.dark_night-290"><a href="#TzimtzumESN.dark_night-290"><span class="linenos">290</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="n">ContractionPhase</span><span class="o">.</span><span class="n">DARK_NIGHT</span>
</span><span id="TzimtzumESN.dark_night-291"><a href="#TzimtzumESN.dark_night-291"><span class="linenos">291</span></a>        
</span><span id="TzimtzumESN.dark_night-292"><a href="#TzimtzumESN.dark_night-292"><span class="linenos">292</span></a>        <span class="c1"># Calcular importancia actual</span>
</span><span id="TzimtzumESN.dark_night-293"><a href="#TzimtzumESN.dark_night-293"><span class="linenos">293</span></a>        <span class="n">importance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_connection_importance</span><span class="p">()</span>
</span><span id="TzimtzumESN.dark_night-294"><a href="#TzimtzumESN.dark_night-294"><span class="linenos">294</span></a>        
</span><span id="TzimtzumESN.dark_night-295"><a href="#TzimtzumESN.dark_night-295"><span class="linenos">295</span></a>        <span class="c1"># Solo considerar conexiones activas</span>
</span><span id="TzimtzumESN.dark_night-296"><a href="#TzimtzumESN.dark_night-296"><span class="linenos">296</span></a>        <span class="n">active_connections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection_mask</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="TzimtzumESN.dark_night-297"><a href="#TzimtzumESN.dark_night-297"><span class="linenos">297</span></a>        <span class="n">active_importance</span> <span class="o">=</span> <span class="n">importance</span><span class="p">[</span><span class="n">active_connections</span><span class="p">]</span>
</span><span id="TzimtzumESN.dark_night-298"><a href="#TzimtzumESN.dark_night-298"><span class="linenos">298</span></a>        
</span><span id="TzimtzumESN.dark_night-299"><a href="#TzimtzumESN.dark_night-299"><span class="linenos">299</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">active_importance</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="TzimtzumESN.dark_night-300"><a href="#TzimtzumESN.dark_night-300"><span class="linenos">300</span></a>            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;pruned_count&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;No hay conexiones que podar&#39;</span><span class="p">}</span>
</span><span id="TzimtzumESN.dark_night-301"><a href="#TzimtzumESN.dark_night-301"><span class="linenos">301</span></a>        
</span><span id="TzimtzumESN.dark_night-302"><a href="#TzimtzumESN.dark_night-302"><span class="linenos">302</span></a>        <span class="c1"># Calcular umbral de poda (percentil basado en fracción)</span>
</span><span id="TzimtzumESN.dark_night-303"><a href="#TzimtzumESN.dark_night-303"><span class="linenos">303</span></a>        <span class="n">prune_percentile</span> <span class="o">=</span> <span class="n">fraction</span> <span class="o">*</span> <span class="mi">100</span>
</span><span id="TzimtzumESN.dark_night-304"><a href="#TzimtzumESN.dark_night-304"><span class="linenos">304</span></a>        <span class="n">threshold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">active_importance</span><span class="p">,</span> <span class="n">prune_percentile</span><span class="p">)</span>
</span><span id="TzimtzumESN.dark_night-305"><a href="#TzimtzumESN.dark_night-305"><span class="linenos">305</span></a>        
</span><span id="TzimtzumESN.dark_night-306"><a href="#TzimtzumESN.dark_night-306"><span class="linenos">306</span></a>        <span class="c1"># Asegurar mínimo de conexiones</span>
</span><span id="TzimtzumESN.dark_night-307"><a href="#TzimtzumESN.dark_night-307"><span class="linenos">307</span></a>        <span class="n">min_connections</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_reservoir</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">min_connections_fraction</span><span class="p">)</span>
</span><span id="TzimtzumESN.dark_night-308"><a href="#TzimtzumESN.dark_night-308"><span class="linenos">308</span></a>        <span class="n">current_connections</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">active_connections</span><span class="p">)</span>
</span><span id="TzimtzumESN.dark_night-309"><a href="#TzimtzumESN.dark_night-309"><span class="linenos">309</span></a>        <span class="n">max_to_prune</span> <span class="o">=</span> <span class="n">current_connections</span> <span class="o">-</span> <span class="n">min_connections</span>
</span><span id="TzimtzumESN.dark_night-310"><a href="#TzimtzumESN.dark_night-310"><span class="linenos">310</span></a>        
</span><span id="TzimtzumESN.dark_night-311"><a href="#TzimtzumESN.dark_night-311"><span class="linenos">311</span></a>        <span class="k">if</span> <span class="n">max_to_prune</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="TzimtzumESN.dark_night-312"><a href="#TzimtzumESN.dark_night-312"><span class="linenos">312</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="TzimtzumESN.dark_night-313"><a href="#TzimtzumESN.dark_night-313"><span class="linenos">313</span></a>                <span class="s1">&#39;pruned_count&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> 
</span><span id="TzimtzumESN.dark_night-314"><a href="#TzimtzumESN.dark_night-314"><span class="linenos">314</span></a>                <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Ya en mínimo de conexiones (</span><span class="si">{</span><span class="n">min_connections</span><span class="si">}</span><span class="s1">)&#39;</span>
</span><span id="TzimtzumESN.dark_night-315"><a href="#TzimtzumESN.dark_night-315"><span class="linenos">315</span></a>            <span class="p">}</span>
</span><span id="TzimtzumESN.dark_night-316"><a href="#TzimtzumESN.dark_night-316"><span class="linenos">316</span></a>        
</span><span id="TzimtzumESN.dark_night-317"><a href="#TzimtzumESN.dark_night-317"><span class="linenos">317</span></a>        <span class="c1"># Crear máscara de poda basada SOLO en importancia</span>
</span><span id="TzimtzumESN.dark_night-318"><a href="#TzimtzumESN.dark_night-318"><span class="linenos">318</span></a>        <span class="c1"># Las conexiones por debajo del threshold serán podadas</span>
</span><span id="TzimtzumESN.dark_night-319"><a href="#TzimtzumESN.dark_night-319"><span class="linenos">319</span></a>        <span class="n">survival_mask</span> <span class="o">=</span> <span class="n">importance</span> <span class="o">&gt;=</span> <span class="n">threshold</span>
</span><span id="TzimtzumESN.dark_night-320"><a href="#TzimtzumESN.dark_night-320"><span class="linenos">320</span></a>        
</span><span id="TzimtzumESN.dark_night-321"><a href="#TzimtzumESN.dark_night-321"><span class="linenos">321</span></a>        <span class="c1"># min_survival_weight es solo para evitar eliminar conexiones ya casi muertas</span>
</span><span id="TzimtzumESN.dark_night-322"><a href="#TzimtzumESN.dark_night-322"><span class="linenos">322</span></a>        <span class="c1"># (no debería salvar conexiones que tienen peso pero baja importancia)</span>
</span><span id="TzimtzumESN.dark_night-323"><a href="#TzimtzumESN.dark_night-323"><span class="linenos">323</span></a>        <span class="c1"># Solo protege conexiones que de otra forma sobrevivirían</span>
</span><span id="TzimtzumESN.dark_night-324"><a href="#TzimtzumESN.dark_night-324"><span class="linenos">324</span></a>        
</span><span id="TzimtzumESN.dark_night-325"><a href="#TzimtzumESN.dark_night-325"><span class="linenos">325</span></a>        <span class="c1"># Preservar topología si está configurado</span>
</span><span id="TzimtzumESN.dark_night-326"><a href="#TzimtzumESN.dark_night-326"><span class="linenos">326</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">preserve_topology</span><span class="p">:</span>
</span><span id="TzimtzumESN.dark_night-327"><a href="#TzimtzumESN.dark_night-327"><span class="linenos">327</span></a>            <span class="c1"># Asegurar al menos una entrada y salida por neurona</span>
</span><span id="TzimtzumESN.dark_night-328"><a href="#TzimtzumESN.dark_night-328"><span class="linenos">328</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_reservoir</span><span class="p">):</span>
</span><span id="TzimtzumESN.dark_night-329"><a href="#TzimtzumESN.dark_night-329"><span class="linenos">329</span></a>                <span class="c1"># Al menos una entrada</span>
</span><span id="TzimtzumESN.dark_night-330"><a href="#TzimtzumESN.dark_night-330"><span class="linenos">330</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">survival_mask</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]):</span>
</span><span id="TzimtzumESN.dark_night-331"><a href="#TzimtzumESN.dark_night-331"><span class="linenos">331</span></a>                    <span class="n">best_in</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]))</span>
</span><span id="TzimtzumESN.dark_night-332"><a href="#TzimtzumESN.dark_night-332"><span class="linenos">332</span></a>                    <span class="n">survival_mask</span><span class="p">[</span><span class="n">best_in</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="TzimtzumESN.dark_night-333"><a href="#TzimtzumESN.dark_night-333"><span class="linenos">333</span></a>                <span class="c1"># Al menos una salida</span>
</span><span id="TzimtzumESN.dark_night-334"><a href="#TzimtzumESN.dark_night-334"><span class="linenos">334</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">survival_mask</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]):</span>
</span><span id="TzimtzumESN.dark_night-335"><a href="#TzimtzumESN.dark_night-335"><span class="linenos">335</span></a>                    <span class="n">best_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]))</span>
</span><span id="TzimtzumESN.dark_night-336"><a href="#TzimtzumESN.dark_night-336"><span class="linenos">336</span></a>                    <span class="n">survival_mask</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">best_out</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="TzimtzumESN.dark_night-337"><a href="#TzimtzumESN.dark_night-337"><span class="linenos">337</span></a>        
</span><span id="TzimtzumESN.dark_night-338"><a href="#TzimtzumESN.dark_night-338"><span class="linenos">338</span></a>        <span class="c1"># Aplicar poda</span>
</span><span id="TzimtzumESN.dark_night-339"><a href="#TzimtzumESN.dark_night-339"><span class="linenos">339</span></a>        <span class="n">pre_prune_connections</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="TzimtzumESN.dark_night-340"><a href="#TzimtzumESN.dark_night-340"><span class="linenos">340</span></a>        
</span><span id="TzimtzumESN.dark_night-341"><a href="#TzimtzumESN.dark_night-341"><span class="linenos">341</span></a>        <span class="n">prune_mask</span> <span class="o">=</span> <span class="o">~</span><span class="n">survival_mask</span> <span class="o">&amp;</span> <span class="n">active_connections</span>
</span><span id="TzimtzumESN.dark_night-342"><a href="#TzimtzumESN.dark_night-342"><span class="linenos">342</span></a>        <span class="n">pruned_count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">prune_mask</span><span class="p">)</span>
</span><span id="TzimtzumESN.dark_night-343"><a href="#TzimtzumESN.dark_night-343"><span class="linenos">343</span></a>        
</span><span id="TzimtzumESN.dark_night-344"><a href="#TzimtzumESN.dark_night-344"><span class="linenos">344</span></a>        <span class="c1"># Limitar poda a max_to_prune</span>
</span><span id="TzimtzumESN.dark_night-345"><a href="#TzimtzumESN.dark_night-345"><span class="linenos">345</span></a>        <span class="k">if</span> <span class="n">pruned_count</span> <span class="o">&gt;</span> <span class="n">max_to_prune</span><span class="p">:</span>
</span><span id="TzimtzumESN.dark_night-346"><a href="#TzimtzumESN.dark_night-346"><span class="linenos">346</span></a>            <span class="c1"># Podar solo las menos importantes</span>
</span><span id="TzimtzumESN.dark_night-347"><a href="#TzimtzumESN.dark_night-347"><span class="linenos">347</span></a>            <span class="n">prune_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">prune_mask</span><span class="p">)</span>
</span><span id="TzimtzumESN.dark_night-348"><a href="#TzimtzumESN.dark_night-348"><span class="linenos">348</span></a>            <span class="n">prune_importance</span> <span class="o">=</span> <span class="n">importance</span><span class="p">[</span><span class="n">prune_mask</span><span class="p">]</span>
</span><span id="TzimtzumESN.dark_night-349"><a href="#TzimtzumESN.dark_night-349"><span class="linenos">349</span></a>            <span class="n">sorted_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">prune_importance</span><span class="p">)</span>
</span><span id="TzimtzumESN.dark_night-350"><a href="#TzimtzumESN.dark_night-350"><span class="linenos">350</span></a>            
</span><span id="TzimtzumESN.dark_night-351"><a href="#TzimtzumESN.dark_night-351"><span class="linenos">351</span></a>            <span class="c1"># Mantener las más importantes entre las que iban a ser podadas</span>
</span><span id="TzimtzumESN.dark_night-352"><a href="#TzimtzumESN.dark_night-352"><span class="linenos">352</span></a>            <span class="n">keep_count</span> <span class="o">=</span> <span class="n">pruned_count</span> <span class="o">-</span> <span class="n">max_to_prune</span>
</span><span id="TzimtzumESN.dark_night-353"><a href="#TzimtzumESN.dark_night-353"><span class="linenos">353</span></a>            <span class="n">keep_indices</span> <span class="o">=</span> <span class="n">sorted_indices</span><span class="p">[</span><span class="o">-</span><span class="n">keep_count</span><span class="p">:]</span>
</span><span id="TzimtzumESN.dark_night-354"><a href="#TzimtzumESN.dark_night-354"><span class="linenos">354</span></a>            
</span><span id="TzimtzumESN.dark_night-355"><a href="#TzimtzumESN.dark_night-355"><span class="linenos">355</span></a>            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">keep_indices</span><span class="p">:</span>
</span><span id="TzimtzumESN.dark_night-356"><a href="#TzimtzumESN.dark_night-356"><span class="linenos">356</span></a>                <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">prune_indices</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
</span><span id="TzimtzumESN.dark_night-357"><a href="#TzimtzumESN.dark_night-357"><span class="linenos">357</span></a>                <span class="n">prune_mask</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="TzimtzumESN.dark_night-358"><a href="#TzimtzumESN.dark_night-358"><span class="linenos">358</span></a>            
</span><span id="TzimtzumESN.dark_night-359"><a href="#TzimtzumESN.dark_night-359"><span class="linenos">359</span></a>            <span class="n">pruned_count</span> <span class="o">=</span> <span class="n">max_to_prune</span>
</span><span id="TzimtzumESN.dark_night-360"><a href="#TzimtzumESN.dark_night-360"><span class="linenos">360</span></a>        
</span><span id="TzimtzumESN.dark_night-361"><a href="#TzimtzumESN.dark_night-361"><span class="linenos">361</span></a>        <span class="c1"># Ejecutar poda</span>
</span><span id="TzimtzumESN.dark_night-362"><a href="#TzimtzumESN.dark_night-362"><span class="linenos">362</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span><span class="p">[</span><span class="n">prune_mask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="TzimtzumESN.dark_night-363"><a href="#TzimtzumESN.dark_night-363"><span class="linenos">363</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_connection_mask</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="TzimtzumESN.dark_night-364"><a href="#TzimtzumESN.dark_night-364"><span class="linenos">364</span></a>        
</span><span id="TzimtzumESN.dark_night-365"><a href="#TzimtzumESN.dark_night-365"><span class="linenos">365</span></a>        <span class="c1"># Renormalizar radio espectral</span>
</span><span id="TzimtzumESN.dark_night-366"><a href="#TzimtzumESN.dark_night-366"><span class="linenos">366</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_spectral_radius</span><span class="p">()</span>
</span><span id="TzimtzumESN.dark_night-367"><a href="#TzimtzumESN.dark_night-367"><span class="linenos">367</span></a>        
</span><span id="TzimtzumESN.dark_night-368"><a href="#TzimtzumESN.dark_night-368"><span class="linenos">368</span></a>        <span class="c1"># Estadísticas</span>
</span><span id="TzimtzumESN.dark_night-369"><a href="#TzimtzumESN.dark_night-369"><span class="linenos">369</span></a>        <span class="n">post_prune_connections</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="TzimtzumESN.dark_night-370"><a href="#TzimtzumESN.dark_night-370"><span class="linenos">370</span></a>        <span class="n">memory_saved</span> <span class="o">=</span> <span class="p">(</span><span class="n">pre_prune_connections</span> <span class="o">-</span> <span class="n">post_prune_connections</span><span class="p">)</span> <span class="o">*</span> <span class="mi">8</span>  <span class="c1"># 8 bytes per float64</span>
</span><span id="TzimtzumESN.dark_night-371"><a href="#TzimtzumESN.dark_night-371"><span class="linenos">371</span></a>        
</span><span id="TzimtzumESN.dark_night-372"><a href="#TzimtzumESN.dark_night-372"><span class="linenos">372</span></a>        <span class="c1"># Actualizar estado</span>
</span><span id="TzimtzumESN.dark_night-373"><a href="#TzimtzumESN.dark_night-373"><span class="linenos">373</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">pruned_connections</span> <span class="o">+=</span> <span class="n">pruned_count</span>
</span><span id="TzimtzumESN.dark_night-374"><a href="#TzimtzumESN.dark_night-374"><span class="linenos">374</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">pruning_cycles</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="TzimtzumESN.dark_night-375"><a href="#TzimtzumESN.dark_night-375"><span class="linenos">375</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">memory_saved_bytes</span> <span class="o">+=</span> <span class="n">memory_saved</span>
</span><span id="TzimtzumESN.dark_night-376"><a href="#TzimtzumESN.dark_night-376"><span class="linenos">376</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">current_threshold</span> <span class="o">=</span> <span class="n">threshold</span>
</span><span id="TzimtzumESN.dark_night-377"><a href="#TzimtzumESN.dark_night-377"><span class="linenos">377</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="n">ContractionPhase</span><span class="o">.</span><span class="n">CHALLAL</span>
</span><span id="TzimtzumESN.dark_night-378"><a href="#TzimtzumESN.dark_night-378"><span class="linenos">378</span></a>        
</span><span id="TzimtzumESN.dark_night-379"><a href="#TzimtzumESN.dark_night-379"><span class="linenos">379</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_update_state_metrics</span><span class="p">()</span>
</span><span id="TzimtzumESN.dark_night-380"><a href="#TzimtzumESN.dark_night-380"><span class="linenos">380</span></a>        
</span><span id="TzimtzumESN.dark_night-381"><a href="#TzimtzumESN.dark_night-381"><span class="linenos">381</span></a>        <span class="c1"># Registrar en historial</span>
</span><span id="TzimtzumESN.dark_night-382"><a href="#TzimtzumESN.dark_night-382"><span class="linenos">382</span></a>        <span class="n">stats</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="TzimtzumESN.dark_night-383"><a href="#TzimtzumESN.dark_night-383"><span class="linenos">383</span></a>            <span class="s1">&#39;cycle&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">pruning_cycles</span><span class="p">,</span>
</span><span id="TzimtzumESN.dark_night-384"><a href="#TzimtzumESN.dark_night-384"><span class="linenos">384</span></a>            <span class="s1">&#39;pruned_count&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">pruned_count</span><span class="p">),</span>
</span><span id="TzimtzumESN.dark_night-385"><a href="#TzimtzumESN.dark_night-385"><span class="linenos">385</span></a>            <span class="s1">&#39;threshold&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">threshold</span><span class="p">),</span>
</span><span id="TzimtzumESN.dark_night-386"><a href="#TzimtzumESN.dark_night-386"><span class="linenos">386</span></a>            <span class="s1">&#39;pre_connections&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">pre_prune_connections</span><span class="p">),</span>
</span><span id="TzimtzumESN.dark_night-387"><a href="#TzimtzumESN.dark_night-387"><span class="linenos">387</span></a>            <span class="s1">&#39;post_connections&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">post_prune_connections</span><span class="p">),</span>
</span><span id="TzimtzumESN.dark_night-388"><a href="#TzimtzumESN.dark_night-388"><span class="linenos">388</span></a>            <span class="s1">&#39;memory_saved_bytes&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">memory_saved</span><span class="p">),</span>
</span><span id="TzimtzumESN.dark_night-389"><a href="#TzimtzumESN.dark_night-389"><span class="linenos">389</span></a>            <span class="s1">&#39;compression_ratio&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">compression_ratio</span>
</span><span id="TzimtzumESN.dark_night-390"><a href="#TzimtzumESN.dark_night-390"><span class="linenos">390</span></a>        <span class="p">}</span>
</span><span id="TzimtzumESN.dark_night-391"><a href="#TzimtzumESN.dark_night-391"><span class="linenos">391</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pruning_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stats</span><span class="p">)</span>
</span><span id="TzimtzumESN.dark_night-392"><a href="#TzimtzumESN.dark_night-392"><span class="linenos">392</span></a>        
</span><span id="TzimtzumESN.dark_night-393"><a href="#TzimtzumESN.dark_night-393"><span class="linenos">393</span></a>        <span class="k">return</span> <span class="n">stats</span>
</span></pre></div>


            <div class="docstring"><p>Ejecuta el proceso de Dark Night (poda masiva).</p>

<p>"En la noche oscura del alma, brillan más las estrellas."</p>

<ul>
<li>San Juan de la Cruz</li>
</ul>

<p>Este método elimina una fracción de las conexiones más débiles
del reservoir, creando espacio para nuevo aprendizaje.</p>

<p>Args:
    fraction: Fracción de conexiones a podar (default: config)</p>

<p>Returns:
    Estadísticas del proceso de poda</p>
</div>


                            </div>
                            <div id="TzimtzumESN.renacimiento" class="classattr">
                                        <input id="TzimtzumESN.renacimiento-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">renacimiento</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">fraction</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">Dict</span>:</span></span>

                <label class="view-source-button" for="TzimtzumESN.renacimiento-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TzimtzumESN.renacimiento"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TzimtzumESN.renacimiento-403"><a href="#TzimtzumESN.renacimiento-403"><span class="linenos">403</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">renacimiento</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fraction</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="TzimtzumESN.renacimiento-404"><a href="#TzimtzumESN.renacimiento-404"><span class="linenos">404</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TzimtzumESN.renacimiento-405"><a href="#TzimtzumESN.renacimiento-405"><span class="linenos">405</span></a><span class="sd">        Proceso de regrowth controlado después del Dark Night.</span>
</span><span id="TzimtzumESN.renacimiento-406"><a href="#TzimtzumESN.renacimiento-406"><span class="linenos">406</span></a><span class="sd">        </span>
</span><span id="TzimtzumESN.renacimiento-407"><a href="#TzimtzumESN.renacimiento-407"><span class="linenos">407</span></a><span class="sd">        &quot;De la nada, algo nuevo puede nacer.&quot;</span>
</span><span id="TzimtzumESN.renacimiento-408"><a href="#TzimtzumESN.renacimiento-408"><span class="linenos">408</span></a><span class="sd">        </span>
</span><span id="TzimtzumESN.renacimiento-409"><a href="#TzimtzumESN.renacimiento-409"><span class="linenos">409</span></a><span class="sd">        Permite que nuevas conexiones emerjan en el vacío</span>
</span><span id="TzimtzumESN.renacimiento-410"><a href="#TzimtzumESN.renacimiento-410"><span class="linenos">410</span></a><span class="sd">        creado por el Tzimtzum.</span>
</span><span id="TzimtzumESN.renacimiento-411"><a href="#TzimtzumESN.renacimiento-411"><span class="linenos">411</span></a><span class="sd">        </span>
</span><span id="TzimtzumESN.renacimiento-412"><a href="#TzimtzumESN.renacimiento-412"><span class="linenos">412</span></a><span class="sd">        Args:</span>
</span><span id="TzimtzumESN.renacimiento-413"><a href="#TzimtzumESN.renacimiento-413"><span class="linenos">413</span></a><span class="sd">            fraction: Fracción de conexiones podadas a recrecer</span>
</span><span id="TzimtzumESN.renacimiento-414"><a href="#TzimtzumESN.renacimiento-414"><span class="linenos">414</span></a><span class="sd">            </span>
</span><span id="TzimtzumESN.renacimiento-415"><a href="#TzimtzumESN.renacimiento-415"><span class="linenos">415</span></a><span class="sd">        Returns:</span>
</span><span id="TzimtzumESN.renacimiento-416"><a href="#TzimtzumESN.renacimiento-416"><span class="linenos">416</span></a><span class="sd">            Estadísticas del regrowth</span>
</span><span id="TzimtzumESN.renacimiento-417"><a href="#TzimtzumESN.renacimiento-417"><span class="linenos">417</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TzimtzumESN.renacimiento-418"><a href="#TzimtzumESN.renacimiento-418"><span class="linenos">418</span></a>        <span class="n">fraction</span> <span class="o">=</span> <span class="n">fraction</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">regrowth_fraction</span>
</span><span id="TzimtzumESN.renacimiento-419"><a href="#TzimtzumESN.renacimiento-419"><span class="linenos">419</span></a>        
</span><span id="TzimtzumESN.renacimiento-420"><a href="#TzimtzumESN.renacimiento-420"><span class="linenos">420</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="n">ContractionPhase</span><span class="o">.</span><span class="n">RENACIMIENTO</span>
</span><span id="TzimtzumESN.renacimiento-421"><a href="#TzimtzumESN.renacimiento-421"><span class="linenos">421</span></a>        
</span><span id="TzimtzumESN.renacimiento-422"><a href="#TzimtzumESN.renacimiento-422"><span class="linenos">422</span></a>        <span class="c1"># Calcular cuántas conexiones regenerar</span>
</span><span id="TzimtzumESN.renacimiento-423"><a href="#TzimtzumESN.renacimiento-423"><span class="linenos">423</span></a>        <span class="n">pruned_this_cycle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">pruned_connections</span>
</span><span id="TzimtzumESN.renacimiento-424"><a href="#TzimtzumESN.renacimiento-424"><span class="linenos">424</span></a>        <span class="n">regrow_count</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">pruned_this_cycle</span> <span class="o">*</span> <span class="n">fraction</span><span class="p">)</span>
</span><span id="TzimtzumESN.renacimiento-425"><a href="#TzimtzumESN.renacimiento-425"><span class="linenos">425</span></a>        
</span><span id="TzimtzumESN.renacimiento-426"><a href="#TzimtzumESN.renacimiento-426"><span class="linenos">426</span></a>        <span class="k">if</span> <span class="n">regrow_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="TzimtzumESN.renacimiento-427"><a href="#TzimtzumESN.renacimiento-427"><span class="linenos">427</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="n">ContractionPhase</span><span class="o">.</span><span class="n">PLENITUD</span>
</span><span id="TzimtzumESN.renacimiento-428"><a href="#TzimtzumESN.renacimiento-428"><span class="linenos">428</span></a>            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;regrown_count&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;No hay espacio para regrowth&#39;</span><span class="p">}</span>
</span><span id="TzimtzumESN.renacimiento-429"><a href="#TzimtzumESN.renacimiento-429"><span class="linenos">429</span></a>        
</span><span id="TzimtzumESN.renacimiento-430"><a href="#TzimtzumESN.renacimiento-430"><span class="linenos">430</span></a>        <span class="c1"># Encontrar posiciones vacías</span>
</span><span id="TzimtzumESN.renacimiento-431"><a href="#TzimtzumESN.renacimiento-431"><span class="linenos">431</span></a>        <span class="n">empty_positions</span> <span class="o">=</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">_connection_mask</span>
</span><span id="TzimtzumESN.renacimiento-432"><a href="#TzimtzumESN.renacimiento-432"><span class="linenos">432</span></a>        <span class="n">empty_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">empty_positions</span><span class="p">)</span>
</span><span id="TzimtzumESN.renacimiento-433"><a href="#TzimtzumESN.renacimiento-433"><span class="linenos">433</span></a>        
</span><span id="TzimtzumESN.renacimiento-434"><a href="#TzimtzumESN.renacimiento-434"><span class="linenos">434</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">empty_indices</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="TzimtzumESN.renacimiento-435"><a href="#TzimtzumESN.renacimiento-435"><span class="linenos">435</span></a>            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;regrown_count&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;No hay posiciones vacías&#39;</span><span class="p">}</span>
</span><span id="TzimtzumESN.renacimiento-436"><a href="#TzimtzumESN.renacimiento-436"><span class="linenos">436</span></a>        
</span><span id="TzimtzumESN.renacimiento-437"><a href="#TzimtzumESN.renacimiento-437"><span class="linenos">437</span></a>        <span class="c1"># Seleccionar posiciones para regrowth</span>
</span><span id="TzimtzumESN.renacimiento-438"><a href="#TzimtzumESN.renacimiento-438"><span class="linenos">438</span></a>        <span class="n">regrow_count</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">regrow_count</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">empty_indices</span><span class="p">))</span>
</span><span id="TzimtzumESN.renacimiento-439"><a href="#TzimtzumESN.renacimiento-439"><span class="linenos">439</span></a>        <span class="n">selected_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_regrowth_rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
</span><span id="TzimtzumESN.renacimiento-440"><a href="#TzimtzumESN.renacimiento-440"><span class="linenos">440</span></a>            <span class="nb">len</span><span class="p">(</span><span class="n">empty_indices</span><span class="p">),</span> 
</span><span id="TzimtzumESN.renacimiento-441"><a href="#TzimtzumESN.renacimiento-441"><span class="linenos">441</span></a>            <span class="n">size</span><span class="o">=</span><span class="n">regrow_count</span><span class="p">,</span> 
</span><span id="TzimtzumESN.renacimiento-442"><a href="#TzimtzumESN.renacimiento-442"><span class="linenos">442</span></a>            <span class="n">replace</span><span class="o">=</span><span class="kc">False</span>
</span><span id="TzimtzumESN.renacimiento-443"><a href="#TzimtzumESN.renacimiento-443"><span class="linenos">443</span></a>        <span class="p">)</span>
</span><span id="TzimtzumESN.renacimiento-444"><a href="#TzimtzumESN.renacimiento-444"><span class="linenos">444</span></a>        
</span><span id="TzimtzumESN.renacimiento-445"><a href="#TzimtzumESN.renacimiento-445"><span class="linenos">445</span></a>        <span class="c1"># Crear nuevas conexiones con pesos pequeños</span>
</span><span id="TzimtzumESN.renacimiento-446"><a href="#TzimtzumESN.renacimiento-446"><span class="linenos">446</span></a>        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">selected_indices</span><span class="p">:</span>
</span><span id="TzimtzumESN.renacimiento-447"><a href="#TzimtzumESN.renacimiento-447"><span class="linenos">447</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">empty_indices</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
</span><span id="TzimtzumESN.renacimiento-448"><a href="#TzimtzumESN.renacimiento-448"><span class="linenos">448</span></a>            <span class="c1"># Peso inicial pequeño (debe ganarse su lugar)</span>
</span><span id="TzimtzumESN.renacimiento-449"><a href="#TzimtzumESN.renacimiento-449"><span class="linenos">449</span></a>            <span class="n">new_weight</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_regrowth_rng</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
</span><span id="TzimtzumESN.renacimiento-450"><a href="#TzimtzumESN.renacimiento-450"><span class="linenos">450</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_weight</span>
</span><span id="TzimtzumESN.renacimiento-451"><a href="#TzimtzumESN.renacimiento-451"><span class="linenos">451</span></a>        
</span><span id="TzimtzumESN.renacimiento-452"><a href="#TzimtzumESN.renacimiento-452"><span class="linenos">452</span></a>        <span class="c1"># Actualizar máscara y métricas</span>
</span><span id="TzimtzumESN.renacimiento-453"><a href="#TzimtzumESN.renacimiento-453"><span class="linenos">453</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_connection_mask</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="TzimtzumESN.renacimiento-454"><a href="#TzimtzumESN.renacimiento-454"><span class="linenos">454</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">regrown_connections</span> <span class="o">+=</span> <span class="n">regrow_count</span>
</span><span id="TzimtzumESN.renacimiento-455"><a href="#TzimtzumESN.renacimiento-455"><span class="linenos">455</span></a>        
</span><span id="TzimtzumESN.renacimiento-456"><a href="#TzimtzumESN.renacimiento-456"><span class="linenos">456</span></a>        <span class="c1"># Renormalizar</span>
</span><span id="TzimtzumESN.renacimiento-457"><a href="#TzimtzumESN.renacimiento-457"><span class="linenos">457</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_spectral_radius</span><span class="p">()</span>
</span><span id="TzimtzumESN.renacimiento-458"><a href="#TzimtzumESN.renacimiento-458"><span class="linenos">458</span></a>        
</span><span id="TzimtzumESN.renacimiento-459"><a href="#TzimtzumESN.renacimiento-459"><span class="linenos">459</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_update_state_metrics</span><span class="p">()</span>
</span><span id="TzimtzumESN.renacimiento-460"><a href="#TzimtzumESN.renacimiento-460"><span class="linenos">460</span></a>        
</span><span id="TzimtzumESN.renacimiento-461"><a href="#TzimtzumESN.renacimiento-461"><span class="linenos">461</span></a>        <span class="c1"># Volver a plenitud</span>
</span><span id="TzimtzumESN.renacimiento-462"><a href="#TzimtzumESN.renacimiento-462"><span class="linenos">462</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="n">ContractionPhase</span><span class="o">.</span><span class="n">PLENITUD</span>
</span><span id="TzimtzumESN.renacimiento-463"><a href="#TzimtzumESN.renacimiento-463"><span class="linenos">463</span></a>        
</span><span id="TzimtzumESN.renacimiento-464"><a href="#TzimtzumESN.renacimiento-464"><span class="linenos">464</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="TzimtzumESN.renacimiento-465"><a href="#TzimtzumESN.renacimiento-465"><span class="linenos">465</span></a>            <span class="s1">&#39;regrown_count&#39;</span><span class="p">:</span> <span class="n">regrow_count</span><span class="p">,</span>
</span><span id="TzimtzumESN.renacimiento-466"><a href="#TzimtzumESN.renacimiento-466"><span class="linenos">466</span></a>            <span class="s1">&#39;new_compression_ratio&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">compression_ratio</span>
</span><span id="TzimtzumESN.renacimiento-467"><a href="#TzimtzumESN.renacimiento-467"><span class="linenos">467</span></a>        <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Proceso de regrowth controlado después del Dark Night.</p>

<p>"De la nada, algo nuevo puede nacer."</p>

<p>Permite que nuevas conexiones emerjan en el vacío
creado por el Tzimtzum.</p>

<p>Args:
    fraction: Fracción de conexiones podadas a recrecer</p>

<p>Returns:
    Estadísticas del regrowth</p>
</div>


                            </div>
                            <div id="TzimtzumESN.full_tzimtzum_cycle" class="classattr">
                                        <input id="TzimtzumESN.full_tzimtzum_cycle-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">full_tzimtzum_cycle</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">Dict</span>:</span></span>

                <label class="view-source-button" for="TzimtzumESN.full_tzimtzum_cycle-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TzimtzumESN.full_tzimtzum_cycle"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TzimtzumESN.full_tzimtzum_cycle-469"><a href="#TzimtzumESN.full_tzimtzum_cycle-469"><span class="linenos">469</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">full_tzimtzum_cycle</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="TzimtzumESN.full_tzimtzum_cycle-470"><a href="#TzimtzumESN.full_tzimtzum_cycle-470"><span class="linenos">470</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TzimtzumESN.full_tzimtzum_cycle-471"><a href="#TzimtzumESN.full_tzimtzum_cycle-471"><span class="linenos">471</span></a><span class="sd">        Ejecuta un ciclo completo de Tzimtzum.</span>
</span><span id="TzimtzumESN.full_tzimtzum_cycle-472"><a href="#TzimtzumESN.full_tzimtzum_cycle-472"><span class="linenos">472</span></a><span class="sd">        </span>
</span><span id="TzimtzumESN.full_tzimtzum_cycle-473"><a href="#TzimtzumESN.full_tzimtzum_cycle-473"><span class="linenos">473</span></a><span class="sd">        PLENITUD → DARK NIGHT → CHALLAL → RENACIMIENTO → PLENITUD</span>
</span><span id="TzimtzumESN.full_tzimtzum_cycle-474"><a href="#TzimtzumESN.full_tzimtzum_cycle-474"><span class="linenos">474</span></a><span class="sd">        </span>
</span><span id="TzimtzumESN.full_tzimtzum_cycle-475"><a href="#TzimtzumESN.full_tzimtzum_cycle-475"><span class="linenos">475</span></a><span class="sd">        Returns:</span>
</span><span id="TzimtzumESN.full_tzimtzum_cycle-476"><a href="#TzimtzumESN.full_tzimtzum_cycle-476"><span class="linenos">476</span></a><span class="sd">            Estadísticas del ciclo completo</span>
</span><span id="TzimtzumESN.full_tzimtzum_cycle-477"><a href="#TzimtzumESN.full_tzimtzum_cycle-477"><span class="linenos">477</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TzimtzumESN.full_tzimtzum_cycle-478"><a href="#TzimtzumESN.full_tzimtzum_cycle-478"><span class="linenos">478</span></a>        <span class="c1"># Fase 1: Dark Night</span>
</span><span id="TzimtzumESN.full_tzimtzum_cycle-479"><a href="#TzimtzumESN.full_tzimtzum_cycle-479"><span class="linenos">479</span></a>        <span class="n">dark_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dark_night</span><span class="p">()</span>
</span><span id="TzimtzumESN.full_tzimtzum_cycle-480"><a href="#TzimtzumESN.full_tzimtzum_cycle-480"><span class="linenos">480</span></a>        
</span><span id="TzimtzumESN.full_tzimtzum_cycle-481"><a href="#TzimtzumESN.full_tzimtzum_cycle-481"><span class="linenos">481</span></a>        <span class="c1"># Fase 2: Renacimiento</span>
</span><span id="TzimtzumESN.full_tzimtzum_cycle-482"><a href="#TzimtzumESN.full_tzimtzum_cycle-482"><span class="linenos">482</span></a>        <span class="n">rebirth_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">renacimiento</span><span class="p">()</span>
</span><span id="TzimtzumESN.full_tzimtzum_cycle-483"><a href="#TzimtzumESN.full_tzimtzum_cycle-483"><span class="linenos">483</span></a>        
</span><span id="TzimtzumESN.full_tzimtzum_cycle-484"><a href="#TzimtzumESN.full_tzimtzum_cycle-484"><span class="linenos">484</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="TzimtzumESN.full_tzimtzum_cycle-485"><a href="#TzimtzumESN.full_tzimtzum_cycle-485"><span class="linenos">485</span></a>            <span class="s1">&#39;dark_night&#39;</span><span class="p">:</span> <span class="n">dark_stats</span><span class="p">,</span>
</span><span id="TzimtzumESN.full_tzimtzum_cycle-486"><a href="#TzimtzumESN.full_tzimtzum_cycle-486"><span class="linenos">486</span></a>            <span class="s1">&#39;renacimiento&#39;</span><span class="p">:</span> <span class="n">rebirth_stats</span><span class="p">,</span>
</span><span id="TzimtzumESN.full_tzimtzum_cycle-487"><a href="#TzimtzumESN.full_tzimtzum_cycle-487"><span class="linenos">487</span></a>            <span class="s1">&#39;final_connections&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">total_connections</span><span class="p">,</span>
</span><span id="TzimtzumESN.full_tzimtzum_cycle-488"><a href="#TzimtzumESN.full_tzimtzum_cycle-488"><span class="linenos">488</span></a>            <span class="s1">&#39;total_cycles&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">pruning_cycles</span>
</span><span id="TzimtzumESN.full_tzimtzum_cycle-489"><a href="#TzimtzumESN.full_tzimtzum_cycle-489"><span class="linenos">489</span></a>        <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Ejecuta un ciclo completo de Tzimtzum.</p>

<p>PLENITUD → DARK NIGHT → CHALLAL → RENACIMIENTO → PLENITUD</p>

<p>Returns:
    Estadísticas del ciclo completo</p>
</div>


                            </div>
                            <div id="TzimtzumESN.get_sparsity_report" class="classattr">
                                        <input id="TzimtzumESN.get_sparsity_report-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_sparsity_report</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">Dict</span>:</span></span>

                <label class="view-source-button" for="TzimtzumESN.get_sparsity_report-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TzimtzumESN.get_sparsity_report"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TzimtzumESN.get_sparsity_report-522"><a href="#TzimtzumESN.get_sparsity_report-522"><span class="linenos">522</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_sparsity_report</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="TzimtzumESN.get_sparsity_report-523"><a href="#TzimtzumESN.get_sparsity_report-523"><span class="linenos">523</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TzimtzumESN.get_sparsity_report-524"><a href="#TzimtzumESN.get_sparsity_report-524"><span class="linenos">524</span></a><span class="sd">        Genera reporte detallado de sparsity actual.</span>
</span><span id="TzimtzumESN.get_sparsity_report-525"><a href="#TzimtzumESN.get_sparsity_report-525"><span class="linenos">525</span></a><span class="sd">        </span>
</span><span id="TzimtzumESN.get_sparsity_report-526"><a href="#TzimtzumESN.get_sparsity_report-526"><span class="linenos">526</span></a><span class="sd">        Returns:</span>
</span><span id="TzimtzumESN.get_sparsity_report-527"><a href="#TzimtzumESN.get_sparsity_report-527"><span class="linenos">527</span></a><span class="sd">            Diccionario con métricas de sparsity</span>
</span><span id="TzimtzumESN.get_sparsity_report-528"><a href="#TzimtzumESN.get_sparsity_report-528"><span class="linenos">528</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TzimtzumESN.get_sparsity_report-529"><a href="#TzimtzumESN.get_sparsity_report-529"><span class="linenos">529</span></a>        <span class="n">total_possible</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_reservoir</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="TzimtzumESN.get_sparsity_report-530"><a href="#TzimtzumESN.get_sparsity_report-530"><span class="linenos">530</span></a>        <span class="n">active</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_connection_mask</span><span class="p">)</span>
</span><span id="TzimtzumESN.get_sparsity_report-531"><a href="#TzimtzumESN.get_sparsity_report-531"><span class="linenos">531</span></a>        
</span><span id="TzimtzumESN.get_sparsity_report-532"><a href="#TzimtzumESN.get_sparsity_report-532"><span class="linenos">532</span></a>        <span class="c1"># Distribución de pesos</span>
</span><span id="TzimtzumESN.get_sparsity_report-533"><a href="#TzimtzumESN.get_sparsity_report-533"><span class="linenos">533</span></a>        <span class="n">active_weights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_connection_mask</span><span class="p">]</span>
</span><span id="TzimtzumESN.get_sparsity_report-534"><a href="#TzimtzumESN.get_sparsity_report-534"><span class="linenos">534</span></a>        
</span><span id="TzimtzumESN.get_sparsity_report-535"><a href="#TzimtzumESN.get_sparsity_report-535"><span class="linenos">535</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">active_weights</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="TzimtzumESN.get_sparsity_report-536"><a href="#TzimtzumESN.get_sparsity_report-536"><span class="linenos">536</span></a>            <span class="n">weight_stats</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="TzimtzumESN.get_sparsity_report-537"><a href="#TzimtzumESN.get_sparsity_report-537"><span class="linenos">537</span></a>                <span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">active_weights</span><span class="p">)),</span>
</span><span id="TzimtzumESN.get_sparsity_report-538"><a href="#TzimtzumESN.get_sparsity_report-538"><span class="linenos">538</span></a>                <span class="s1">&#39;std&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">active_weights</span><span class="p">)),</span>
</span><span id="TzimtzumESN.get_sparsity_report-539"><a href="#TzimtzumESN.get_sparsity_report-539"><span class="linenos">539</span></a>                <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">active_weights</span><span class="p">)),</span>
</span><span id="TzimtzumESN.get_sparsity_report-540"><a href="#TzimtzumESN.get_sparsity_report-540"><span class="linenos">540</span></a>                <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">active_weights</span><span class="p">)),</span>
</span><span id="TzimtzumESN.get_sparsity_report-541"><a href="#TzimtzumESN.get_sparsity_report-541"><span class="linenos">541</span></a>                <span class="s1">&#39;median&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">active_weights</span><span class="p">))</span>
</span><span id="TzimtzumESN.get_sparsity_report-542"><a href="#TzimtzumESN.get_sparsity_report-542"><span class="linenos">542</span></a>            <span class="p">}</span>
</span><span id="TzimtzumESN.get_sparsity_report-543"><a href="#TzimtzumESN.get_sparsity_report-543"><span class="linenos">543</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TzimtzumESN.get_sparsity_report-544"><a href="#TzimtzumESN.get_sparsity_report-544"><span class="linenos">544</span></a>            <span class="n">weight_stats</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;median&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</span><span id="TzimtzumESN.get_sparsity_report-545"><a href="#TzimtzumESN.get_sparsity_report-545"><span class="linenos">545</span></a>        
</span><span id="TzimtzumESN.get_sparsity_report-546"><a href="#TzimtzumESN.get_sparsity_report-546"><span class="linenos">546</span></a>        <span class="c1"># Conectividad por neurona</span>
</span><span id="TzimtzumESN.get_sparsity_report-547"><a href="#TzimtzumESN.get_sparsity_report-547"><span class="linenos">547</span></a>        <span class="n">in_degree</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_connection_mask</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="TzimtzumESN.get_sparsity_report-548"><a href="#TzimtzumESN.get_sparsity_report-548"><span class="linenos">548</span></a>        <span class="n">out_degree</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_connection_mask</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="TzimtzumESN.get_sparsity_report-549"><a href="#TzimtzumESN.get_sparsity_report-549"><span class="linenos">549</span></a>        
</span><span id="TzimtzumESN.get_sparsity_report-550"><a href="#TzimtzumESN.get_sparsity_report-550"><span class="linenos">550</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="TzimtzumESN.get_sparsity_report-551"><a href="#TzimtzumESN.get_sparsity_report-551"><span class="linenos">551</span></a>            <span class="s1">&#39;total_possible_connections&#39;</span><span class="p">:</span> <span class="n">total_possible</span><span class="p">,</span>
</span><span id="TzimtzumESN.get_sparsity_report-552"><a href="#TzimtzumESN.get_sparsity_report-552"><span class="linenos">552</span></a>            <span class="s1">&#39;active_connections&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">active</span><span class="p">),</span>
</span><span id="TzimtzumESN.get_sparsity_report-553"><a href="#TzimtzumESN.get_sparsity_report-553"><span class="linenos">553</span></a>            <span class="s1">&#39;sparsity&#39;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">active</span> <span class="o">/</span> <span class="n">total_possible</span><span class="p">),</span>
</span><span id="TzimtzumESN.get_sparsity_report-554"><a href="#TzimtzumESN.get_sparsity_report-554"><span class="linenos">554</span></a>            <span class="s1">&#39;compression_ratio&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">compression_ratio</span><span class="p">,</span>
</span><span id="TzimtzumESN.get_sparsity_report-555"><a href="#TzimtzumESN.get_sparsity_report-555"><span class="linenos">555</span></a>            <span class="s1">&#39;weight_statistics&#39;</span><span class="p">:</span> <span class="n">weight_stats</span><span class="p">,</span>
</span><span id="TzimtzumESN.get_sparsity_report-556"><a href="#TzimtzumESN.get_sparsity_report-556"><span class="linenos">556</span></a>            <span class="s1">&#39;connectivity&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="TzimtzumESN.get_sparsity_report-557"><a href="#TzimtzumESN.get_sparsity_report-557"><span class="linenos">557</span></a>                <span class="s1">&#39;mean_in_degree&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">in_degree</span><span class="p">)),</span>
</span><span id="TzimtzumESN.get_sparsity_report-558"><a href="#TzimtzumESN.get_sparsity_report-558"><span class="linenos">558</span></a>                <span class="s1">&#39;mean_out_degree&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">out_degree</span><span class="p">)),</span>
</span><span id="TzimtzumESN.get_sparsity_report-559"><a href="#TzimtzumESN.get_sparsity_report-559"><span class="linenos">559</span></a>                <span class="s1">&#39;isolated_neurons&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">in_degree</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">out_degree</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)))</span>
</span><span id="TzimtzumESN.get_sparsity_report-560"><a href="#TzimtzumESN.get_sparsity_report-560"><span class="linenos">560</span></a>            <span class="p">},</span>
</span><span id="TzimtzumESN.get_sparsity_report-561"><a href="#TzimtzumESN.get_sparsity_report-561"><span class="linenos">561</span></a>            <span class="s1">&#39;tzimtzum_state&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
</span><span id="TzimtzumESN.get_sparsity_report-562"><a href="#TzimtzumESN.get_sparsity_report-562"><span class="linenos">562</span></a>            <span class="s1">&#39;pruning_history&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pruning_history</span>
</span><span id="TzimtzumESN.get_sparsity_report-563"><a href="#TzimtzumESN.get_sparsity_report-563"><span class="linenos">563</span></a>        <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Genera reporte detallado de sparsity actual.</p>

<p>Returns:
    Diccionario con métricas de sparsity</p>
</div>


                            </div>
                            <div id="TzimtzumESN.visualize_contraction" class="classattr">
                                        <input id="TzimtzumESN.visualize_contraction-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">visualize_contraction</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="TzimtzumESN.visualize_contraction-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TzimtzumESN.visualize_contraction"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TzimtzumESN.visualize_contraction-565"><a href="#TzimtzumESN.visualize_contraction-565"><span class="linenos">565</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">visualize_contraction</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="TzimtzumESN.visualize_contraction-566"><a href="#TzimtzumESN.visualize_contraction-566"><span class="linenos">566</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TzimtzumESN.visualize_contraction-567"><a href="#TzimtzumESN.visualize_contraction-567"><span class="linenos">567</span></a><span class="sd">        Genera visualización ASCII del estado de contracción.</span>
</span><span id="TzimtzumESN.visualize_contraction-568"><a href="#TzimtzumESN.visualize_contraction-568"><span class="linenos">568</span></a><span class="sd">        </span>
</span><span id="TzimtzumESN.visualize_contraction-569"><a href="#TzimtzumESN.visualize_contraction-569"><span class="linenos">569</span></a><span class="sd">        Returns:</span>
</span><span id="TzimtzumESN.visualize_contraction-570"><a href="#TzimtzumESN.visualize_contraction-570"><span class="linenos">570</span></a><span class="sd">            String con visualización ASCII</span>
</span><span id="TzimtzumESN.visualize_contraction-571"><a href="#TzimtzumESN.visualize_contraction-571"><span class="linenos">571</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TzimtzumESN.visualize_contraction-572"><a href="#TzimtzumESN.visualize_contraction-572"><span class="linenos">572</span></a>        <span class="n">phase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">phase</span><span class="o">.</span><span class="n">name</span>
</span><span id="TzimtzumESN.visualize_contraction-573"><a href="#TzimtzumESN.visualize_contraction-573"><span class="linenos">573</span></a>        <span class="n">ratio</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">compression_ratio</span>
</span><span id="TzimtzumESN.visualize_contraction-574"><a href="#TzimtzumESN.visualize_contraction-574"><span class="linenos">574</span></a>        <span class="n">cycles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">pruning_cycles</span>
</span><span id="TzimtzumESN.visualize_contraction-575"><a href="#TzimtzumESN.visualize_contraction-575"><span class="linenos">575</span></a>        
</span><span id="TzimtzumESN.visualize_contraction-576"><a href="#TzimtzumESN.visualize_contraction-576"><span class="linenos">576</span></a>        <span class="c1"># Barra de compresión visual</span>
</span><span id="TzimtzumESN.visualize_contraction-577"><a href="#TzimtzumESN.visualize_contraction-577"><span class="linenos">577</span></a>        <span class="n">bar_width</span> <span class="o">=</span> <span class="mi">40</span>
</span><span id="TzimtzumESN.visualize_contraction-578"><a href="#TzimtzumESN.visualize_contraction-578"><span class="linenos">578</span></a>        <span class="n">filled</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ratio</span> <span class="o">*</span> <span class="n">bar_width</span><span class="p">)</span>
</span><span id="TzimtzumESN.visualize_contraction-579"><a href="#TzimtzumESN.visualize_contraction-579"><span class="linenos">579</span></a>        <span class="n">empty</span> <span class="o">=</span> <span class="n">bar_width</span> <span class="o">-</span> <span class="n">filled</span>
</span><span id="TzimtzumESN.visualize_contraction-580"><a href="#TzimtzumESN.visualize_contraction-580"><span class="linenos">580</span></a>        <span class="n">bar</span> <span class="o">=</span> <span class="s1">&#39;█&#39;</span> <span class="o">*</span> <span class="n">filled</span> <span class="o">+</span> <span class="s1">&#39;░&#39;</span> <span class="o">*</span> <span class="n">empty</span>
</span><span id="TzimtzumESN.visualize_contraction-581"><a href="#TzimtzumESN.visualize_contraction-581"><span class="linenos">581</span></a>        
</span><span id="TzimtzumESN.visualize_contraction-582"><a href="#TzimtzumESN.visualize_contraction-582"><span class="linenos">582</span></a>        <span class="c1"># Fase emoji</span>
</span><span id="TzimtzumESN.visualize_contraction-583"><a href="#TzimtzumESN.visualize_contraction-583"><span class="linenos">583</span></a>        <span class="n">phase_emoji</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="TzimtzumESN.visualize_contraction-584"><a href="#TzimtzumESN.visualize_contraction-584"><span class="linenos">584</span></a>            <span class="s1">&#39;PLENITUD&#39;</span><span class="p">:</span> <span class="s1">&#39;🌕&#39;</span><span class="p">,</span>
</span><span id="TzimtzumESN.visualize_contraction-585"><a href="#TzimtzumESN.visualize_contraction-585"><span class="linenos">585</span></a>            <span class="s1">&#39;DARK_NIGHT&#39;</span><span class="p">:</span> <span class="s1">&#39;🌑&#39;</span><span class="p">,</span>
</span><span id="TzimtzumESN.visualize_contraction-586"><a href="#TzimtzumESN.visualize_contraction-586"><span class="linenos">586</span></a>            <span class="s1">&#39;CHALLAL&#39;</span><span class="p">:</span> <span class="s1">&#39;⚫&#39;</span><span class="p">,</span>
</span><span id="TzimtzumESN.visualize_contraction-587"><a href="#TzimtzumESN.visualize_contraction-587"><span class="linenos">587</span></a>            <span class="s1">&#39;RENACIMIENTO&#39;</span><span class="p">:</span> <span class="s1">&#39;🌅&#39;</span>
</span><span id="TzimtzumESN.visualize_contraction-588"><a href="#TzimtzumESN.visualize_contraction-588"><span class="linenos">588</span></a>        <span class="p">}</span>
</span><span id="TzimtzumESN.visualize_contraction-589"><a href="#TzimtzumESN.visualize_contraction-589"><span class="linenos">589</span></a>        
</span><span id="TzimtzumESN.visualize_contraction-590"><a href="#TzimtzumESN.visualize_contraction-590"><span class="linenos">590</span></a>        <span class="n">viz</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="TzimtzumESN.visualize_contraction-591"><a href="#TzimtzumESN.visualize_contraction-591"><span class="linenos">591</span></a><span class="s2">╔════════════════════════════════════════════════════╗</span>
</span><span id="TzimtzumESN.visualize_contraction-592"><a href="#TzimtzumESN.visualize_contraction-592"><span class="linenos">592</span></a><span class="s2">║              TZIMTZUM STATE MONITOR                ║</span>
</span><span id="TzimtzumESN.visualize_contraction-593"><a href="#TzimtzumESN.visualize_contraction-593"><span class="linenos">593</span></a><span class="s2">╠════════════════════════════════════════════════════╣</span>
</span><span id="TzimtzumESN.visualize_contraction-594"><a href="#TzimtzumESN.visualize_contraction-594"><span class="linenos">594</span></a><span class="s2">║  Phase: </span><span class="si">{</span><span class="n">phase_emoji</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">phase</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;○&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">phase</span><span class="si">:</span><span class="s2">15s</span><span class="si">}</span><span class="s2">                  ║</span>
</span><span id="TzimtzumESN.visualize_contraction-595"><a href="#TzimtzumESN.visualize_contraction-595"><span class="linenos">595</span></a><span class="s2">║                                                    ║</span>
</span><span id="TzimtzumESN.visualize_contraction-596"><a href="#TzimtzumESN.visualize_contraction-596"><span class="linenos">596</span></a><span class="s2">║  Compression: [</span><span class="si">{</span><span class="n">bar</span><span class="si">}</span><span class="s2">]                              ║</span>
</span><span id="TzimtzumESN.visualize_contraction-597"><a href="#TzimtzumESN.visualize_contraction-597"><span class="linenos">597</span></a><span class="s2">║  Ratio: </span><span class="si">{</span><span class="n">ratio</span><span class="si">:</span><span class="s2">.1%</span><span class="si">}</span><span class="s2"> of original connections         ║</span>
</span><span id="TzimtzumESN.visualize_contraction-598"><a href="#TzimtzumESN.visualize_contraction-598"><span class="linenos">598</span></a><span class="s2">║                                                    ║</span>
</span><span id="TzimtzumESN.visualize_contraction-599"><a href="#TzimtzumESN.visualize_contraction-599"><span class="linenos">599</span></a><span class="s2">║  📊 Statistics:                                    ║</span>
</span><span id="TzimtzumESN.visualize_contraction-600"><a href="#TzimtzumESN.visualize_contraction-600"><span class="linenos">600</span></a><span class="s2">║     Total Connections: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">total_connections</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">                      ║</span>
</span><span id="TzimtzumESN.visualize_contraction-601"><a href="#TzimtzumESN.visualize_contraction-601"><span class="linenos">601</span></a><span class="s2">║     Pruned Total:      </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">pruned_connections</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">                      ║</span>
</span><span id="TzimtzumESN.visualize_contraction-602"><a href="#TzimtzumESN.visualize_contraction-602"><span class="linenos">602</span></a><span class="s2">║     Regrown Total:     </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">regrown_connections</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">                       ║</span>
</span><span id="TzimtzumESN.visualize_contraction-603"><a href="#TzimtzumESN.visualize_contraction-603"><span class="linenos">603</span></a><span class="s2">║     Dark Night Cycles: </span><span class="si">{</span><span class="n">cycles</span><span class="si">}</span><span class="s2">                           ║</span>
</span><span id="TzimtzumESN.visualize_contraction-604"><a href="#TzimtzumESN.visualize_contraction-604"><span class="linenos">604</span></a><span class="s2">║     Memory Saved:      </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">memory_saved_bytes</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2"> bytes              ║</span>
</span><span id="TzimtzumESN.visualize_contraction-605"><a href="#TzimtzumESN.visualize_contraction-605"><span class="linenos">605</span></a><span class="s2">╚════════════════════════════════════════════════════╝</span>
</span><span id="TzimtzumESN.visualize_contraction-606"><a href="#TzimtzumESN.visualize_contraction-606"><span class="linenos">606</span></a><span class="s2">&quot;&quot;&quot;</span>
</span><span id="TzimtzumESN.visualize_contraction-607"><a href="#TzimtzumESN.visualize_contraction-607"><span class="linenos">607</span></a>        <span class="k">return</span> <span class="n">viz</span>
</span></pre></div>


            <div class="docstring"><p>Genera visualización ASCII del estado de contracción.</p>

<p>Returns:
    String con visualización ASCII</p>
</div>


                            </div>
                </section>
                <section id="TzimtzumConfig">
                            <input id="TzimtzumConfig-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
                    <div class="decorator decorator-dataclass">@dataclass</div>

    <span class="def">class</span>
    <span class="name">TzimtzumConfig</span>:

                <label class="view-source-button" for="TzimtzumConfig-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TzimtzumConfig"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TzimtzumConfig-105"><a href="#TzimtzumConfig-105"><span class="linenos">105</span></a><span class="nd">@dataclass</span>
</span><span id="TzimtzumConfig-106"><a href="#TzimtzumConfig-106"><span class="linenos">106</span></a><span class="k">class</span><span class="w"> </span><span class="nc">TzimtzumConfig</span><span class="p">:</span>
</span><span id="TzimtzumConfig-107"><a href="#TzimtzumConfig-107"><span class="linenos">107</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TzimtzumConfig-108"><a href="#TzimtzumConfig-108"><span class="linenos">108</span></a><span class="sd">    Configuración del protocolo Tzimtzum.</span>
</span><span id="TzimtzumConfig-109"><a href="#TzimtzumConfig-109"><span class="linenos">109</span></a><span class="sd">    </span>
</span><span id="TzimtzumConfig-110"><a href="#TzimtzumConfig-110"><span class="linenos">110</span></a><span class="sd">    Parámetros que controlan la intensidad y frecuencia</span>
</span><span id="TzimtzumConfig-111"><a href="#TzimtzumConfig-111"><span class="linenos">111</span></a><span class="sd">    de los ciclos de contracción.</span>
</span><span id="TzimtzumConfig-112"><a href="#TzimtzumConfig-112"><span class="linenos">112</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="TzimtzumConfig-113"><a href="#TzimtzumConfig-113"><span class="linenos">113</span></a>    <span class="c1"># Fracción de conexiones a podar (default: 50% - número sagrado)</span>
</span><span id="TzimtzumConfig-114"><a href="#TzimtzumConfig-114"><span class="linenos">114</span></a>    <span class="n">pruning_fraction</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span>
</span><span id="TzimtzumConfig-115"><a href="#TzimtzumConfig-115"><span class="linenos">115</span></a>    
</span><span id="TzimtzumConfig-116"><a href="#TzimtzumConfig-116"><span class="linenos">116</span></a>    <span class="c1"># Frecuencia de Dark Night (cada N pasos de adaptación)</span>
</span><span id="TzimtzumConfig-117"><a href="#TzimtzumConfig-117"><span class="linenos">117</span></a>    <span class="n">dark_night_interval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span>
</span><span id="TzimtzumConfig-118"><a href="#TzimtzumConfig-118"><span class="linenos">118</span></a>    
</span><span id="TzimtzumConfig-119"><a href="#TzimtzumConfig-119"><span class="linenos">119</span></a>    <span class="c1"># Regrowth después de poda (fracción de lo podado)</span>
</span><span id="TzimtzumConfig-120"><a href="#TzimtzumConfig-120"><span class="linenos">120</span></a>    <span class="n">regrowth_fraction</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span>
</span><span id="TzimtzumConfig-121"><a href="#TzimtzumConfig-121"><span class="linenos">121</span></a>    
</span><span id="TzimtzumConfig-122"><a href="#TzimtzumConfig-122"><span class="linenos">122</span></a>    <span class="c1"># Umbral mínimo de peso para sobrevivir (absoluto)</span>
</span><span id="TzimtzumConfig-123"><a href="#TzimtzumConfig-123"><span class="linenos">123</span></a>    <span class="n">min_survival_weight</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-6</span>
</span><span id="TzimtzumConfig-124"><a href="#TzimtzumConfig-124"><span class="linenos">124</span></a>    
</span><span id="TzimtzumConfig-125"><a href="#TzimtzumConfig-125"><span class="linenos">125</span></a>    <span class="c1"># Número mínimo de conexiones (nunca bajar de esto)</span>
</span><span id="TzimtzumConfig-126"><a href="#TzimtzumConfig-126"><span class="linenos">126</span></a>    <span class="n">min_connections_fraction</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span>
</span><span id="TzimtzumConfig-127"><a href="#TzimtzumConfig-127"><span class="linenos">127</span></a>    
</span><span id="TzimtzumConfig-128"><a href="#TzimtzumConfig-128"><span class="linenos">128</span></a>    <span class="c1"># Forzar sparsity estructurada (preservar topología)</span>
</span><span id="TzimtzumConfig-129"><a href="#TzimtzumConfig-129"><span class="linenos">129</span></a>    <span class="n">preserve_topology</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="TzimtzumConfig-130"><a href="#TzimtzumConfig-130"><span class="linenos">130</span></a>    
</span><span id="TzimtzumConfig-131"><a href="#TzimtzumConfig-131"><span class="linenos">131</span></a>    <span class="c1"># Usar importancia basada en gradiente (si está disponible)</span>
</span><span id="TzimtzumConfig-132"><a href="#TzimtzumConfig-132"><span class="linenos">132</span></a>    <span class="n">use_gradient_importance</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="TzimtzumConfig-133"><a href="#TzimtzumConfig-133"><span class="linenos">133</span></a>    
</span><span id="TzimtzumConfig-134"><a href="#TzimtzumConfig-134"><span class="linenos">134</span></a>    <span class="c1"># Semilla para reproducibilidad del regrowth</span>
</span><span id="TzimtzumConfig-135"><a href="#TzimtzumConfig-135"><span class="linenos">135</span></a>    <span class="n">regrowth_seed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Configuración del protocolo Tzimtzum.</p>

<p>Parámetros que controlan la intensidad y frecuencia
de los ciclos de contracción.</p>
</div>


                            <div id="TzimtzumConfig.__init__" class="classattr">
                                <div class="attr function">
            
        <span class="name">TzimtzumConfig</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">pruning_fraction</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span>,</span><span class="param">	<span class="n">dark_night_interval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span>,</span><span class="param">	<span class="n">regrowth_fraction</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span>,</span><span class="param">	<span class="n">min_survival_weight</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-06</span>,</span><span class="param">	<span class="n">min_connections_fraction</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span>,</span><span class="param">	<span class="n">preserve_topology</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">use_gradient_importance</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">regrowth_seed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#TzimtzumConfig.__init__"></a>
    
    

                            </div>
                            <div id="TzimtzumConfig.pruning_fraction" class="classattr">
                                <div class="attr variable">
            <span class="name">pruning_fraction</span><span class="annotation">: float</span>        =
<span class="default_value">0.5</span>

        
    </div>
    <a class="headerlink" href="#TzimtzumConfig.pruning_fraction"></a>
    
    

                            </div>
                            <div id="TzimtzumConfig.dark_night_interval" class="classattr">
                                <div class="attr variable">
            <span class="name">dark_night_interval</span><span class="annotation">: int</span>        =
<span class="default_value">1000</span>

        
    </div>
    <a class="headerlink" href="#TzimtzumConfig.dark_night_interval"></a>
    
    

                            </div>
                            <div id="TzimtzumConfig.regrowth_fraction" class="classattr">
                                <div class="attr variable">
            <span class="name">regrowth_fraction</span><span class="annotation">: float</span>        =
<span class="default_value">0.1</span>

        
    </div>
    <a class="headerlink" href="#TzimtzumConfig.regrowth_fraction"></a>
    
    

                            </div>
                            <div id="TzimtzumConfig.min_survival_weight" class="classattr">
                                <div class="attr variable">
            <span class="name">min_survival_weight</span><span class="annotation">: float</span>        =
<span class="default_value">1e-06</span>

        
    </div>
    <a class="headerlink" href="#TzimtzumConfig.min_survival_weight"></a>
    
    

                            </div>
                            <div id="TzimtzumConfig.min_connections_fraction" class="classattr">
                                <div class="attr variable">
            <span class="name">min_connections_fraction</span><span class="annotation">: float</span>        =
<span class="default_value">0.1</span>

        
    </div>
    <a class="headerlink" href="#TzimtzumConfig.min_connections_fraction"></a>
    
    

                            </div>
                            <div id="TzimtzumConfig.preserve_topology" class="classattr">
                                <div class="attr variable">
            <span class="name">preserve_topology</span><span class="annotation">: bool</span>        =
<span class="default_value">True</span>

        
    </div>
    <a class="headerlink" href="#TzimtzumConfig.preserve_topology"></a>
    
    

                            </div>
                            <div id="TzimtzumConfig.use_gradient_importance" class="classattr">
                                <div class="attr variable">
            <span class="name">use_gradient_importance</span><span class="annotation">: bool</span>        =
<span class="default_value">False</span>

        
    </div>
    <a class="headerlink" href="#TzimtzumConfig.use_gradient_importance"></a>
    
    

                            </div>
                            <div id="TzimtzumConfig.regrowth_seed" class="classattr">
                                <div class="attr variable">
            <span class="name">regrowth_seed</span><span class="annotation">: Optional[int]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#TzimtzumConfig.regrowth_seed"></a>
    
    

                            </div>
                </section>
                <section id="TzimtzumState">
                            <input id="TzimtzumState-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
                    <div class="decorator decorator-dataclass">@dataclass</div>

    <span class="def">class</span>
    <span class="name">TzimtzumState</span>:

                <label class="view-source-button" for="TzimtzumState-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TzimtzumState"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TzimtzumState-64"><a href="#TzimtzumState-64"><span class="linenos"> 64</span></a><span class="nd">@dataclass</span>
</span><span id="TzimtzumState-65"><a href="#TzimtzumState-65"><span class="linenos"> 65</span></a><span class="k">class</span><span class="w"> </span><span class="nc">TzimtzumState</span><span class="p">:</span>
</span><span id="TzimtzumState-66"><a href="#TzimtzumState-66"><span class="linenos"> 66</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TzimtzumState-67"><a href="#TzimtzumState-67"><span class="linenos"> 67</span></a><span class="sd">    Estado del proceso de contracción.</span>
</span><span id="TzimtzumState-68"><a href="#TzimtzumState-68"><span class="linenos"> 68</span></a><span class="sd">    </span>
</span><span id="TzimtzumState-69"><a href="#TzimtzumState-69"><span class="linenos"> 69</span></a><span class="sd">    Rastrea métricas del ciclo Tzimtzum para monitoreo</span>
</span><span id="TzimtzumState-70"><a href="#TzimtzumState-70"><span class="linenos"> 70</span></a><span class="sd">    y ajuste dinámico.</span>
</span><span id="TzimtzumState-71"><a href="#TzimtzumState-71"><span class="linenos"> 71</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="TzimtzumState-72"><a href="#TzimtzumState-72"><span class="linenos"> 72</span></a>    <span class="n">phase</span><span class="p">:</span> <span class="n">ContractionPhase</span> <span class="o">=</span> <span class="n">ContractionPhase</span><span class="o">.</span><span class="n">PLENITUD</span>
</span><span id="TzimtzumState-73"><a href="#TzimtzumState-73"><span class="linenos"> 73</span></a>    
</span><span id="TzimtzumState-74"><a href="#TzimtzumState-74"><span class="linenos"> 74</span></a>    <span class="c1"># Métricas de poda</span>
</span><span id="TzimtzumState-75"><a href="#TzimtzumState-75"><span class="linenos"> 75</span></a>    <span class="n">total_connections</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="TzimtzumState-76"><a href="#TzimtzumState-76"><span class="linenos"> 76</span></a>    <span class="n">pruned_connections</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="TzimtzumState-77"><a href="#TzimtzumState-77"><span class="linenos"> 77</span></a>    <span class="n">regrown_connections</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="TzimtzumState-78"><a href="#TzimtzumState-78"><span class="linenos"> 78</span></a>    
</span><span id="TzimtzumState-79"><a href="#TzimtzumState-79"><span class="linenos"> 79</span></a>    <span class="c1"># Historial</span>
</span><span id="TzimtzumState-80"><a href="#TzimtzumState-80"><span class="linenos"> 80</span></a>    <span class="n">pruning_cycles</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="TzimtzumState-81"><a href="#TzimtzumState-81"><span class="linenos"> 81</span></a>    <span class="n">memory_saved_bytes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="TzimtzumState-82"><a href="#TzimtzumState-82"><span class="linenos"> 82</span></a>    
</span><span id="TzimtzumState-83"><a href="#TzimtzumState-83"><span class="linenos"> 83</span></a>    <span class="c1"># Umbrales dinámicos</span>
</span><span id="TzimtzumState-84"><a href="#TzimtzumState-84"><span class="linenos"> 84</span></a>    <span class="n">current_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="TzimtzumState-85"><a href="#TzimtzumState-85"><span class="linenos"> 85</span></a>    <span class="n">min_weight_survived</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="TzimtzumState-86"><a href="#TzimtzumState-86"><span class="linenos"> 86</span></a>    <span class="n">max_weight_pruned</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="TzimtzumState-87"><a href="#TzimtzumState-87"><span class="linenos"> 87</span></a>    
</span><span id="TzimtzumState-88"><a href="#TzimtzumState-88"><span class="linenos"> 88</span></a>    <span class="c1"># Eficiencia</span>
</span><span id="TzimtzumState-89"><a href="#TzimtzumState-89"><span class="linenos"> 89</span></a>    <span class="n">compression_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="TzimtzumState-90"><a href="#TzimtzumState-90"><span class="linenos"> 90</span></a>    
</span><span id="TzimtzumState-91"><a href="#TzimtzumState-91"><span class="linenos"> 91</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="TzimtzumState-92"><a href="#TzimtzumState-92"><span class="linenos"> 92</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Serializa el estado a diccionario.&quot;&quot;&quot;</span>
</span><span id="TzimtzumState-93"><a href="#TzimtzumState-93"><span class="linenos"> 93</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="TzimtzumState-94"><a href="#TzimtzumState-94"><span class="linenos"> 94</span></a>            <span class="s1">&#39;phase&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="TzimtzumState-95"><a href="#TzimtzumState-95"><span class="linenos"> 95</span></a>            <span class="s1">&#39;total_connections&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_connections</span><span class="p">,</span>
</span><span id="TzimtzumState-96"><a href="#TzimtzumState-96"><span class="linenos"> 96</span></a>            <span class="s1">&#39;pruned_connections&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pruned_connections</span><span class="p">,</span>
</span><span id="TzimtzumState-97"><a href="#TzimtzumState-97"><span class="linenos"> 97</span></a>            <span class="s1">&#39;regrown_connections&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">regrown_connections</span><span class="p">,</span>
</span><span id="TzimtzumState-98"><a href="#TzimtzumState-98"><span class="linenos"> 98</span></a>            <span class="s1">&#39;pruning_cycles&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pruning_cycles</span><span class="p">,</span>
</span><span id="TzimtzumState-99"><a href="#TzimtzumState-99"><span class="linenos"> 99</span></a>            <span class="s1">&#39;memory_saved_bytes&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory_saved_bytes</span><span class="p">,</span>
</span><span id="TzimtzumState-100"><a href="#TzimtzumState-100"><span class="linenos">100</span></a>            <span class="s1">&#39;current_threshold&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_threshold</span><span class="p">),</span>
</span><span id="TzimtzumState-101"><a href="#TzimtzumState-101"><span class="linenos">101</span></a>            <span class="s1">&#39;compression_ratio&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">compression_ratio</span>
</span><span id="TzimtzumState-102"><a href="#TzimtzumState-102"><span class="linenos">102</span></a>        <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Estado del proceso de contracción.</p>

<p>Rastrea métricas del ciclo Tzimtzum para monitoreo
y ajuste dinámico.</p>
</div>


                            <div id="TzimtzumState.__init__" class="classattr">
                                <div class="attr function">
            
        <span class="name">TzimtzumState</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">phase</span><span class="p">:</span> <span class="n"><a href="#ContractionPhase">ContractionPhase</a></span> <span class="o">=</span> <span class="o">&lt;</span><span class="n"><a href="#ContractionPhase.PLENITUD">ContractionPhase.PLENITUD</a></span><span class="p">:</span> <span class="mi">1</span><span class="o">&gt;</span>,</span><span class="param">	<span class="n">total_connections</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">pruned_connections</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">regrown_connections</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">pruning_cycles</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">memory_saved_bytes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">current_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>,</span><span class="param">	<span class="n">min_weight_survived</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>,</span><span class="param">	<span class="n">max_weight_pruned</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>,</span><span class="param">	<span class="n">compression_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#TzimtzumState.__init__"></a>
    
    

                            </div>
                            <div id="TzimtzumState.phase" class="classattr">
                                <div class="attr variable">
            <span class="name">phase</span><span class="annotation">: <a href="#ContractionPhase">ContractionPhase</a></span>        =
<span class="default_value">&lt;<a href="#ContractionPhase.PLENITUD">ContractionPhase.PLENITUD</a>: 1&gt;</span>

        
    </div>
    <a class="headerlink" href="#TzimtzumState.phase"></a>
    
    

                            </div>
                            <div id="TzimtzumState.total_connections" class="classattr">
                                <div class="attr variable">
            <span class="name">total_connections</span><span class="annotation">: int</span>        =
<span class="default_value">0</span>

        
    </div>
    <a class="headerlink" href="#TzimtzumState.total_connections"></a>
    
    

                            </div>
                            <div id="TzimtzumState.pruned_connections" class="classattr">
                                <div class="attr variable">
            <span class="name">pruned_connections</span><span class="annotation">: int</span>        =
<span class="default_value">0</span>

        
    </div>
    <a class="headerlink" href="#TzimtzumState.pruned_connections"></a>
    
    

                            </div>
                            <div id="TzimtzumState.regrown_connections" class="classattr">
                                <div class="attr variable">
            <span class="name">regrown_connections</span><span class="annotation">: int</span>        =
<span class="default_value">0</span>

        
    </div>
    <a class="headerlink" href="#TzimtzumState.regrown_connections"></a>
    
    

                            </div>
                            <div id="TzimtzumState.pruning_cycles" class="classattr">
                                <div class="attr variable">
            <span class="name">pruning_cycles</span><span class="annotation">: int</span>        =
<span class="default_value">0</span>

        
    </div>
    <a class="headerlink" href="#TzimtzumState.pruning_cycles"></a>
    
    

                            </div>
                            <div id="TzimtzumState.memory_saved_bytes" class="classattr">
                                <div class="attr variable">
            <span class="name">memory_saved_bytes</span><span class="annotation">: int</span>        =
<span class="default_value">0</span>

        
    </div>
    <a class="headerlink" href="#TzimtzumState.memory_saved_bytes"></a>
    
    

                            </div>
                            <div id="TzimtzumState.current_threshold" class="classattr">
                                <div class="attr variable">
            <span class="name">current_threshold</span><span class="annotation">: float</span>        =
<span class="default_value">0.0</span>

        
    </div>
    <a class="headerlink" href="#TzimtzumState.current_threshold"></a>
    
    

                            </div>
                            <div id="TzimtzumState.min_weight_survived" class="classattr">
                                <div class="attr variable">
            <span class="name">min_weight_survived</span><span class="annotation">: float</span>        =
<span class="default_value">0.0</span>

        
    </div>
    <a class="headerlink" href="#TzimtzumState.min_weight_survived"></a>
    
    

                            </div>
                            <div id="TzimtzumState.max_weight_pruned" class="classattr">
                                <div class="attr variable">
            <span class="name">max_weight_pruned</span><span class="annotation">: float</span>        =
<span class="default_value">0.0</span>

        
    </div>
    <a class="headerlink" href="#TzimtzumState.max_weight_pruned"></a>
    
    

                            </div>
                            <div id="TzimtzumState.compression_ratio" class="classattr">
                                <div class="attr variable">
            <span class="name">compression_ratio</span><span class="annotation">: float</span>        =
<span class="default_value">1.0</span>

        
    </div>
    <a class="headerlink" href="#TzimtzumState.compression_ratio"></a>
    
    

                            </div>
                            <div id="TzimtzumState.to_dict" class="classattr">
                                        <input id="TzimtzumState.to_dict-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">to_dict</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">dict</span>:</span></span>

                <label class="view-source-button" for="TzimtzumState.to_dict-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TzimtzumState.to_dict"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TzimtzumState.to_dict-91"><a href="#TzimtzumState.to_dict-91"><span class="linenos"> 91</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="TzimtzumState.to_dict-92"><a href="#TzimtzumState.to_dict-92"><span class="linenos"> 92</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Serializa el estado a diccionario.&quot;&quot;&quot;</span>
</span><span id="TzimtzumState.to_dict-93"><a href="#TzimtzumState.to_dict-93"><span class="linenos"> 93</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="TzimtzumState.to_dict-94"><a href="#TzimtzumState.to_dict-94"><span class="linenos"> 94</span></a>            <span class="s1">&#39;phase&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="TzimtzumState.to_dict-95"><a href="#TzimtzumState.to_dict-95"><span class="linenos"> 95</span></a>            <span class="s1">&#39;total_connections&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_connections</span><span class="p">,</span>
</span><span id="TzimtzumState.to_dict-96"><a href="#TzimtzumState.to_dict-96"><span class="linenos"> 96</span></a>            <span class="s1">&#39;pruned_connections&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pruned_connections</span><span class="p">,</span>
</span><span id="TzimtzumState.to_dict-97"><a href="#TzimtzumState.to_dict-97"><span class="linenos"> 97</span></a>            <span class="s1">&#39;regrown_connections&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">regrown_connections</span><span class="p">,</span>
</span><span id="TzimtzumState.to_dict-98"><a href="#TzimtzumState.to_dict-98"><span class="linenos"> 98</span></a>            <span class="s1">&#39;pruning_cycles&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pruning_cycles</span><span class="p">,</span>
</span><span id="TzimtzumState.to_dict-99"><a href="#TzimtzumState.to_dict-99"><span class="linenos"> 99</span></a>            <span class="s1">&#39;memory_saved_bytes&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory_saved_bytes</span><span class="p">,</span>
</span><span id="TzimtzumState.to_dict-100"><a href="#TzimtzumState.to_dict-100"><span class="linenos">100</span></a>            <span class="s1">&#39;current_threshold&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_threshold</span><span class="p">),</span>
</span><span id="TzimtzumState.to_dict-101"><a href="#TzimtzumState.to_dict-101"><span class="linenos">101</span></a>            <span class="s1">&#39;compression_ratio&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">compression_ratio</span>
</span><span id="TzimtzumState.to_dict-102"><a href="#TzimtzumState.to_dict-102"><span class="linenos">102</span></a>        <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Serializa el estado a diccionario.</p>
</div>


                            </div>
                </section>
                <section id="TzimtzumMixin">
                            <input id="TzimtzumMixin-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">TzimtzumMixin</span>:

                <label class="view-source-button" for="TzimtzumMixin-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TzimtzumMixin"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TzimtzumMixin-610"><a href="#TzimtzumMixin-610"><span class="linenos">610</span></a><span class="k">class</span><span class="w"> </span><span class="nc">TzimtzumMixin</span><span class="p">:</span>
</span><span id="TzimtzumMixin-611"><a href="#TzimtzumMixin-611"><span class="linenos">611</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TzimtzumMixin-612"><a href="#TzimtzumMixin-612"><span class="linenos">612</span></a><span class="sd">    Mixin para agregar capacidades Tzimtzum a cualquier ESN.</span>
</span><span id="TzimtzumMixin-613"><a href="#TzimtzumMixin-613"><span class="linenos">613</span></a><span class="sd">    </span>
</span><span id="TzimtzumMixin-614"><a href="#TzimtzumMixin-614"><span class="linenos">614</span></a><span class="sd">    Permite convertir un ESN existente en un ESN con poda dinámica</span>
</span><span id="TzimtzumMixin-615"><a href="#TzimtzumMixin-615"><span class="linenos">615</span></a><span class="sd">    sin necesidad de herencia directa.</span>
</span><span id="TzimtzumMixin-616"><a href="#TzimtzumMixin-616"><span class="linenos">616</span></a><span class="sd">    </span>
</span><span id="TzimtzumMixin-617"><a href="#TzimtzumMixin-617"><span class="linenos">617</span></a><span class="sd">    Ejemplo:</span>
</span><span id="TzimtzumMixin-618"><a href="#TzimtzumMixin-618"><span class="linenos">618</span></a><span class="sd">        &gt;&gt;&gt; class MyHebbianTzimtzum(TzimtzumMixin, HebbianESN):</span>
</span><span id="TzimtzumMixin-619"><a href="#TzimtzumMixin-619"><span class="linenos">619</span></a><span class="sd">        ...     pass</span>
</span><span id="TzimtzumMixin-620"><a href="#TzimtzumMixin-620"><span class="linenos">620</span></a><span class="sd">        &gt;&gt;&gt; </span>
</span><span id="TzimtzumMixin-621"><a href="#TzimtzumMixin-621"><span class="linenos">621</span></a><span class="sd">        &gt;&gt;&gt; esn = MyHebbianTzimtzum(input_size=3, reservoir_size=100)</span>
</span><span id="TzimtzumMixin-622"><a href="#TzimtzumMixin-622"><span class="linenos">622</span></a><span class="sd">        &gt;&gt;&gt; esn.dark_night()  # Ahora tiene capacidad Tzimtzum</span>
</span><span id="TzimtzumMixin-623"><a href="#TzimtzumMixin-623"><span class="linenos">623</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="TzimtzumMixin-624"><a href="#TzimtzumMixin-624"><span class="linenos">624</span></a>    
</span><span id="TzimtzumMixin-625"><a href="#TzimtzumMixin-625"><span class="linenos">625</span></a>    <span class="n">_tzimtzum_initialized</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="TzimtzumMixin-626"><a href="#TzimtzumMixin-626"><span class="linenos">626</span></a>    
</span><span id="TzimtzumMixin-627"><a href="#TzimtzumMixin-627"><span class="linenos">627</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">init_tzimtzum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TzimtzumConfig</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="TzimtzumMixin-628"><a href="#TzimtzumMixin-628"><span class="linenos">628</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Inicializa las capacidades Tzimtzum.&quot;&quot;&quot;</span>
</span><span id="TzimtzumMixin-629"><a href="#TzimtzumMixin-629"><span class="linenos">629</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_config</span> <span class="o">=</span> <span class="n">config</span> <span class="ow">or</span> <span class="n">TzimtzumConfig</span><span class="p">()</span>
</span><span id="TzimtzumMixin-630"><a href="#TzimtzumMixin-630"><span class="linenos">630</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span> <span class="o">=</span> <span class="n">TzimtzumState</span><span class="p">()</span>
</span><span id="TzimtzumMixin-631"><a href="#TzimtzumMixin-631"><span class="linenos">631</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_connection_mask</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="TzimtzumMixin-632"><a href="#TzimtzumMixin-632"><span class="linenos">632</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_connection_importance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span><span class="p">)</span>
</span><span id="TzimtzumMixin-633"><a href="#TzimtzumMixin-633"><span class="linenos">633</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pruning_history</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="TzimtzumMixin-634"><a href="#TzimtzumMixin-634"><span class="linenos">634</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_tzimtzum_initialized</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="TzimtzumMixin-635"><a href="#TzimtzumMixin-635"><span class="linenos">635</span></a>    
</span><span id="TzimtzumMixin-636"><a href="#TzimtzumMixin-636"><span class="linenos">636</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">dark_night</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fraction</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="TzimtzumMixin-637"><a href="#TzimtzumMixin-637"><span class="linenos">637</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Ejecuta poda Tzimtzum.&quot;&quot;&quot;</span>
</span><span id="TzimtzumMixin-638"><a href="#TzimtzumMixin-638"><span class="linenos">638</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tzimtzum_initialized</span><span class="p">:</span>
</span><span id="TzimtzumMixin-639"><a href="#TzimtzumMixin-639"><span class="linenos">639</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">init_tzimtzum</span><span class="p">()</span>
</span><span id="TzimtzumMixin-640"><a href="#TzimtzumMixin-640"><span class="linenos">640</span></a>        
</span><span id="TzimtzumMixin-641"><a href="#TzimtzumMixin-641"><span class="linenos">641</span></a>        <span class="n">fraction</span> <span class="o">=</span> <span class="n">fraction</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_config</span><span class="o">.</span><span class="n">pruning_fraction</span>
</span><span id="TzimtzumMixin-642"><a href="#TzimtzumMixin-642"><span class="linenos">642</span></a>        
</span><span id="TzimtzumMixin-643"><a href="#TzimtzumMixin-643"><span class="linenos">643</span></a>        <span class="c1"># Implementación simplificada</span>
</span><span id="TzimtzumMixin-644"><a href="#TzimtzumMixin-644"><span class="linenos">644</span></a>        <span class="n">importance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span><span class="p">)</span>
</span><span id="TzimtzumMixin-645"><a href="#TzimtzumMixin-645"><span class="linenos">645</span></a>        <span class="n">threshold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">importance</span><span class="p">[</span><span class="n">importance</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">],</span> <span class="n">fraction</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
</span><span id="TzimtzumMixin-646"><a href="#TzimtzumMixin-646"><span class="linenos">646</span></a>        
</span><span id="TzimtzumMixin-647"><a href="#TzimtzumMixin-647"><span class="linenos">647</span></a>        <span class="n">prune_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="TzimtzumMixin-648"><a href="#TzimtzumMixin-648"><span class="linenos">648</span></a>        <span class="n">pruned_count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">prune_mask</span><span class="p">)</span>
</span><span id="TzimtzumMixin-649"><a href="#TzimtzumMixin-649"><span class="linenos">649</span></a>        
</span><span id="TzimtzumMixin-650"><a href="#TzimtzumMixin-650"><span class="linenos">650</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span><span class="p">[</span><span class="n">prune_mask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="TzimtzumMixin-651"><a href="#TzimtzumMixin-651"><span class="linenos">651</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_connection_mask</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="TzimtzumMixin-652"><a href="#TzimtzumMixin-652"><span class="linenos">652</span></a>        
</span><span id="TzimtzumMixin-653"><a href="#TzimtzumMixin-653"><span class="linenos">653</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">pruned_connections</span> <span class="o">+=</span> <span class="n">pruned_count</span>
</span><span id="TzimtzumMixin-654"><a href="#TzimtzumMixin-654"><span class="linenos">654</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">pruning_cycles</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="TzimtzumMixin-655"><a href="#TzimtzumMixin-655"><span class="linenos">655</span></a>        
</span><span id="TzimtzumMixin-656"><a href="#TzimtzumMixin-656"><span class="linenos">656</span></a>        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;pruned_count&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">pruned_count</span><span class="p">)}</span>
</span></pre></div>


            <div class="docstring"><p>Mixin para agregar capacidades Tzimtzum a cualquier ESN.</p>

<p>Permite convertir un ESN existente en un ESN con poda dinámica
sin necesidad de herencia directa.</p>

<p>Ejemplo:</p>

<blockquote>
  <blockquote>
    <blockquote>
      <p>class MyHebbianTzimtzum(TzimtzumMixin, HebbianESN):
          ...     pass</p>
      
      <p>esn = MyHebbianTzimtzum(input_size=3, reservoir_size=100)
      esn.dark_night()  # Ahora tiene capacidad Tzimtzum</p>
    </blockquote>
  </blockquote>
</blockquote>
</div>


                            <div id="TzimtzumMixin.init_tzimtzum" class="classattr">
                                        <input id="TzimtzumMixin.init_tzimtzum-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">init_tzimtzum</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n"><a href="#TzimtzumConfig">TzimtzumConfig</a></span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TzimtzumMixin.init_tzimtzum-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TzimtzumMixin.init_tzimtzum"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TzimtzumMixin.init_tzimtzum-627"><a href="#TzimtzumMixin.init_tzimtzum-627"><span class="linenos">627</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">init_tzimtzum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TzimtzumConfig</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="TzimtzumMixin.init_tzimtzum-628"><a href="#TzimtzumMixin.init_tzimtzum-628"><span class="linenos">628</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Inicializa las capacidades Tzimtzum.&quot;&quot;&quot;</span>
</span><span id="TzimtzumMixin.init_tzimtzum-629"><a href="#TzimtzumMixin.init_tzimtzum-629"><span class="linenos">629</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_config</span> <span class="o">=</span> <span class="n">config</span> <span class="ow">or</span> <span class="n">TzimtzumConfig</span><span class="p">()</span>
</span><span id="TzimtzumMixin.init_tzimtzum-630"><a href="#TzimtzumMixin.init_tzimtzum-630"><span class="linenos">630</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span> <span class="o">=</span> <span class="n">TzimtzumState</span><span class="p">()</span>
</span><span id="TzimtzumMixin.init_tzimtzum-631"><a href="#TzimtzumMixin.init_tzimtzum-631"><span class="linenos">631</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_connection_mask</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="TzimtzumMixin.init_tzimtzum-632"><a href="#TzimtzumMixin.init_tzimtzum-632"><span class="linenos">632</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_connection_importance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span><span class="p">)</span>
</span><span id="TzimtzumMixin.init_tzimtzum-633"><a href="#TzimtzumMixin.init_tzimtzum-633"><span class="linenos">633</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pruning_history</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="TzimtzumMixin.init_tzimtzum-634"><a href="#TzimtzumMixin.init_tzimtzum-634"><span class="linenos">634</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_tzimtzum_initialized</span> <span class="o">=</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>Inicializa las capacidades Tzimtzum.</p>
</div>


                            </div>
                            <div id="TzimtzumMixin.dark_night" class="classattr">
                                        <input id="TzimtzumMixin.dark_night-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">dark_night</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">fraction</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">Dict</span>:</span></span>

                <label class="view-source-button" for="TzimtzumMixin.dark_night-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TzimtzumMixin.dark_night"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TzimtzumMixin.dark_night-636"><a href="#TzimtzumMixin.dark_night-636"><span class="linenos">636</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">dark_night</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fraction</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="TzimtzumMixin.dark_night-637"><a href="#TzimtzumMixin.dark_night-637"><span class="linenos">637</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Ejecuta poda Tzimtzum.&quot;&quot;&quot;</span>
</span><span id="TzimtzumMixin.dark_night-638"><a href="#TzimtzumMixin.dark_night-638"><span class="linenos">638</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tzimtzum_initialized</span><span class="p">:</span>
</span><span id="TzimtzumMixin.dark_night-639"><a href="#TzimtzumMixin.dark_night-639"><span class="linenos">639</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">init_tzimtzum</span><span class="p">()</span>
</span><span id="TzimtzumMixin.dark_night-640"><a href="#TzimtzumMixin.dark_night-640"><span class="linenos">640</span></a>        
</span><span id="TzimtzumMixin.dark_night-641"><a href="#TzimtzumMixin.dark_night-641"><span class="linenos">641</span></a>        <span class="n">fraction</span> <span class="o">=</span> <span class="n">fraction</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_config</span><span class="o">.</span><span class="n">pruning_fraction</span>
</span><span id="TzimtzumMixin.dark_night-642"><a href="#TzimtzumMixin.dark_night-642"><span class="linenos">642</span></a>        
</span><span id="TzimtzumMixin.dark_night-643"><a href="#TzimtzumMixin.dark_night-643"><span class="linenos">643</span></a>        <span class="c1"># Implementación simplificada</span>
</span><span id="TzimtzumMixin.dark_night-644"><a href="#TzimtzumMixin.dark_night-644"><span class="linenos">644</span></a>        <span class="n">importance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span><span class="p">)</span>
</span><span id="TzimtzumMixin.dark_night-645"><a href="#TzimtzumMixin.dark_night-645"><span class="linenos">645</span></a>        <span class="n">threshold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">importance</span><span class="p">[</span><span class="n">importance</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">],</span> <span class="n">fraction</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
</span><span id="TzimtzumMixin.dark_night-646"><a href="#TzimtzumMixin.dark_night-646"><span class="linenos">646</span></a>        
</span><span id="TzimtzumMixin.dark_night-647"><a href="#TzimtzumMixin.dark_night-647"><span class="linenos">647</span></a>        <span class="n">prune_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="TzimtzumMixin.dark_night-648"><a href="#TzimtzumMixin.dark_night-648"><span class="linenos">648</span></a>        <span class="n">pruned_count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">prune_mask</span><span class="p">)</span>
</span><span id="TzimtzumMixin.dark_night-649"><a href="#TzimtzumMixin.dark_night-649"><span class="linenos">649</span></a>        
</span><span id="TzimtzumMixin.dark_night-650"><a href="#TzimtzumMixin.dark_night-650"><span class="linenos">650</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span><span class="p">[</span><span class="n">prune_mask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="TzimtzumMixin.dark_night-651"><a href="#TzimtzumMixin.dark_night-651"><span class="linenos">651</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_connection_mask</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="TzimtzumMixin.dark_night-652"><a href="#TzimtzumMixin.dark_night-652"><span class="linenos">652</span></a>        
</span><span id="TzimtzumMixin.dark_night-653"><a href="#TzimtzumMixin.dark_night-653"><span class="linenos">653</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">pruned_connections</span> <span class="o">+=</span> <span class="n">pruned_count</span>
</span><span id="TzimtzumMixin.dark_night-654"><a href="#TzimtzumMixin.dark_night-654"><span class="linenos">654</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">pruning_cycles</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="TzimtzumMixin.dark_night-655"><a href="#TzimtzumMixin.dark_night-655"><span class="linenos">655</span></a>        
</span><span id="TzimtzumMixin.dark_night-656"><a href="#TzimtzumMixin.dark_night-656"><span class="linenos">656</span></a>        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;pruned_count&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">pruned_count</span><span class="p">)}</span>
</span></pre></div>


            <div class="docstring"><p>Ejecuta poda Tzimtzum.</p>
</div>


                            </div>
                </section>
                <section id="ContractionPhase">
                            <input id="ContractionPhase-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ContractionPhase</span><wbr>(<span class="base">enum.Enum</span>):

                <label class="view-source-button" for="ContractionPhase-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ContractionPhase"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ContractionPhase-51"><a href="#ContractionPhase-51"><span class="linenos">51</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ContractionPhase</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
</span><span id="ContractionPhase-52"><a href="#ContractionPhase-52"><span class="linenos">52</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ContractionPhase-53"><a href="#ContractionPhase-53"><span class="linenos">53</span></a><span class="sd">    Fases del ciclo Tzimtzum.</span>
</span><span id="ContractionPhase-54"><a href="#ContractionPhase-54"><span class="linenos">54</span></a><span class="sd">    </span>
</span><span id="ContractionPhase-55"><a href="#ContractionPhase-55"><span class="linenos">55</span></a><span class="sd">    El proceso de contracción-expansión es cíclico, reflejando</span>
</span><span id="ContractionPhase-56"><a href="#ContractionPhase-56"><span class="linenos">56</span></a><span class="sd">    el ritmo cósmico de creación y destrucción.</span>
</span><span id="ContractionPhase-57"><a href="#ContractionPhase-57"><span class="linenos">57</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="ContractionPhase-58"><a href="#ContractionPhase-58"><span class="linenos">58</span></a>    <span class="n">PLENITUD</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>       <span class="c1"># Red saturada, muchas conexiones</span>
</span><span id="ContractionPhase-59"><a href="#ContractionPhase-59"><span class="linenos">59</span></a>    <span class="n">DARK_NIGHT</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>     <span class="c1"># Proceso de poda activo</span>
</span><span id="ContractionPhase-60"><a href="#ContractionPhase-60"><span class="linenos">60</span></a>    <span class="n">CHALLAL</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>        <span class="c1"># Vacío primordial, mínimas conexiones</span>
</span><span id="ContractionPhase-61"><a href="#ContractionPhase-61"><span class="linenos">61</span></a>    <span class="n">RENACIMIENTO</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>   <span class="c1"># Recrecimiento de conexiones</span>
</span></pre></div>


            <div class="docstring"><p>Fases del ciclo Tzimtzum.</p>

<p>El proceso de contracción-expansión es cíclico, reflejando
el ritmo cósmico de creación y destrucción.</p>
</div>


                            <div id="ContractionPhase.PLENITUD" class="classattr">
                                <div class="attr variable">
            <span class="name">PLENITUD</span>        =
<span class="default_value">&lt;<a href="#ContractionPhase.PLENITUD">ContractionPhase.PLENITUD</a>: 1&gt;</span>

        
    </div>
    <a class="headerlink" href="#ContractionPhase.PLENITUD"></a>
    
    

                            </div>
                            <div id="ContractionPhase.DARK_NIGHT" class="classattr">
                                <div class="attr variable">
            <span class="name">DARK_NIGHT</span>        =
<span class="default_value">&lt;<a href="#ContractionPhase.DARK_NIGHT">ContractionPhase.DARK_NIGHT</a>: 2&gt;</span>

        
    </div>
    <a class="headerlink" href="#ContractionPhase.DARK_NIGHT"></a>
    
    

                            </div>
                            <div id="ContractionPhase.CHALLAL" class="classattr">
                                <div class="attr variable">
            <span class="name">CHALLAL</span>        =
<span class="default_value">&lt;<a href="#ContractionPhase.CHALLAL">ContractionPhase.CHALLAL</a>: 3&gt;</span>

        
    </div>
    <a class="headerlink" href="#ContractionPhase.CHALLAL"></a>
    
    

                            </div>
                            <div id="ContractionPhase.RENACIMIENTO" class="classattr">
                                <div class="attr variable">
            <span class="name">RENACIMIENTO</span>        =
<span class="default_value">&lt;<a href="#ContractionPhase.RENACIMIENTO">ContractionPhase.RENACIMIENTO</a>: 4&gt;</span>

        
    </div>
    <a class="headerlink" href="#ContractionPhase.RENACIMIENTO"></a>
    
    

                            </div>
                </section>
                <section id="HebbianTzimtzumESN">
                            <input id="HebbianTzimtzumESN-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">HebbianTzimtzumESN</span><wbr>(<span class="base"><a href="#HebbianESN">plasticity.HebbianESN</a></span>):

                <label class="view-source-button" for="HebbianTzimtzumESN-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HebbianTzimtzumESN"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HebbianTzimtzumESN-35"><a href="#HebbianTzimtzumESN-35"><span class="linenos"> 35</span></a><span class="k">class</span><span class="w"> </span><span class="nc">HebbianTzimtzumESN</span><span class="p">(</span><span class="n">HebbianESN</span><span class="p">):</span>
</span><span id="HebbianTzimtzumESN-36"><a href="#HebbianTzimtzumESN-36"><span class="linenos"> 36</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HebbianTzimtzumESN-37"><a href="#HebbianTzimtzumESN-37"><span class="linenos"> 37</span></a><span class="sd">    Echo State Network con Plasticidad Hebbiana y Protocolo Tzimtzum.</span>
</span><span id="HebbianTzimtzumESN-38"><a href="#HebbianTzimtzumESN-38"><span class="linenos"> 38</span></a><span class="sd">    </span>
</span><span id="HebbianTzimtzumESN-39"><a href="#HebbianTzimtzumESN-39"><span class="linenos"> 39</span></a><span class="sd">    Combina dos paradigmas de aprendizaje complementarios:</span>
</span><span id="HebbianTzimtzumESN-40"><a href="#HebbianTzimtzumESN-40"><span class="linenos"> 40</span></a><span class="sd">    </span>
</span><span id="HebbianTzimtzumESN-41"><a href="#HebbianTzimtzumESN-41"><span class="linenos"> 41</span></a><span class="sd">    1. PLASTICIDAD HEBBIANA (continua):</span>
</span><span id="HebbianTzimtzumESN-42"><a href="#HebbianTzimtzumESN-42"><span class="linenos"> 42</span></a><span class="sd">       - Fortalece conexiones entre neuronas co-activas</span>
</span><span id="HebbianTzimtzumESN-43"><a href="#HebbianTzimtzumESN-43"><span class="linenos"> 43</span></a><span class="sd">       - Opera en cada paso de tiempo</span>
</span><span id="HebbianTzimtzumESN-44"><a href="#HebbianTzimtzumESN-44"><span class="linenos"> 44</span></a><span class="sd">       - &quot;Células que disparan juntas, permanecen juntas&quot;</span>
</span><span id="HebbianTzimtzumESN-45"><a href="#HebbianTzimtzumESN-45"><span class="linenos"> 45</span></a><span class="sd">    </span>
</span><span id="HebbianTzimtzumESN-46"><a href="#HebbianTzimtzumESN-46"><span class="linenos"> 46</span></a><span class="sd">    2. PROTOCOLO TZIMTZUM (cíclico):</span>
</span><span id="HebbianTzimtzumESN-47"><a href="#HebbianTzimtzumESN-47"><span class="linenos"> 47</span></a><span class="sd">       - Elimina periódicamente conexiones débiles</span>
</span><span id="HebbianTzimtzumESN-48"><a href="#HebbianTzimtzumESN-48"><span class="linenos"> 48</span></a><span class="sd">       - Crea &quot;vacío&quot; para nuevo aprendizaje</span>
</span><span id="HebbianTzimtzumESN-49"><a href="#HebbianTzimtzumESN-49"><span class="linenos"> 49</span></a><span class="sd">       - &quot;Para aprender algo nuevo, primero debo olvidar&quot;</span>
</span><span id="HebbianTzimtzumESN-50"><a href="#HebbianTzimtzumESN-50"><span class="linenos"> 50</span></a><span class="sd">    </span>
</span><span id="HebbianTzimtzumESN-51"><a href="#HebbianTzimtzumESN-51"><span class="linenos"> 51</span></a><span class="sd">    FILOSOFÍA:</span>
</span><span id="HebbianTzimtzumESN-52"><a href="#HebbianTzimtzumESN-52"><span class="linenos"> 52</span></a><span class="sd">    ──────────</span>
</span><span id="HebbianTzimtzumESN-53"><a href="#HebbianTzimtzumESN-53"><span class="linenos"> 53</span></a><span class="sd">    La vida neuronal es un balance entre:</span>
</span><span id="HebbianTzimtzumESN-54"><a href="#HebbianTzimtzumESN-54"><span class="linenos"> 54</span></a><span class="sd">    - Crecimiento (Hebbian): Acumular conocimiento</span>
</span><span id="HebbianTzimtzumESN-55"><a href="#HebbianTzimtzumESN-55"><span class="linenos"> 55</span></a><span class="sd">    - Poda (Tzimtzum): Liberar lo obsoleto</span>
</span><span id="HebbianTzimtzumESN-56"><a href="#HebbianTzimtzumESN-56"><span class="linenos"> 56</span></a><span class="sd">    </span>
</span><span id="HebbianTzimtzumESN-57"><a href="#HebbianTzimtzumESN-57"><span class="linenos"> 57</span></a><span class="sd">    Sin poda, la red se satura.</span>
</span><span id="HebbianTzimtzumESN-58"><a href="#HebbianTzimtzumESN-58"><span class="linenos"> 58</span></a><span class="sd">    Sin crecimiento, la red muere.</span>
</span><span id="HebbianTzimtzumESN-59"><a href="#HebbianTzimtzumESN-59"><span class="linenos"> 59</span></a><span class="sd">    </span>
</span><span id="HebbianTzimtzumESN-60"><a href="#HebbianTzimtzumESN-60"><span class="linenos"> 60</span></a><span class="sd">    El HebbianTzimtzumESN implementa este ciclo vital.</span>
</span><span id="HebbianTzimtzumESN-61"><a href="#HebbianTzimtzumESN-61"><span class="linenos"> 61</span></a><span class="sd">    </span>
</span><span id="HebbianTzimtzumESN-62"><a href="#HebbianTzimtzumESN-62"><span class="linenos"> 62</span></a><span class="sd">    Ejemplo:</span>
</span><span id="HebbianTzimtzumESN-63"><a href="#HebbianTzimtzumESN-63"><span class="linenos"> 63</span></a><span class="sd">        &gt;&gt;&gt; esn = HebbianTzimtzumESN(</span>
</span><span id="HebbianTzimtzumESN-64"><a href="#HebbianTzimtzumESN-64"><span class="linenos"> 64</span></a><span class="sd">        ...     input_size=3,</span>
</span><span id="HebbianTzimtzumESN-65"><a href="#HebbianTzimtzumESN-65"><span class="linenos"> 65</span></a><span class="sd">        ...     reservoir_size=100,</span>
</span><span id="HebbianTzimtzumESN-66"><a href="#HebbianTzimtzumESN-66"><span class="linenos"> 66</span></a><span class="sd">        ...     plasticity_type=&#39;hebbian&#39;,</span>
</span><span id="HebbianTzimtzumESN-67"><a href="#HebbianTzimtzumESN-67"><span class="linenos"> 67</span></a><span class="sd">        ...     tzimtzum_config=TzimtzumConfig(pruning_fraction=0.5)</span>
</span><span id="HebbianTzimtzumESN-68"><a href="#HebbianTzimtzumESN-68"><span class="linenos"> 68</span></a><span class="sd">        ... )</span>
</span><span id="HebbianTzimtzumESN-69"><a href="#HebbianTzimtzumESN-69"><span class="linenos"> 69</span></a><span class="sd">        &gt;&gt;&gt; </span>
</span><span id="HebbianTzimtzumESN-70"><a href="#HebbianTzimtzumESN-70"><span class="linenos"> 70</span></a><span class="sd">        &gt;&gt;&gt; # Entrenar con adaptación online</span>
</span><span id="HebbianTzimtzumESN-71"><a href="#HebbianTzimtzumESN-71"><span class="linenos"> 71</span></a><span class="sd">        &gt;&gt;&gt; esn.adapt_online(X_train)</span>
</span><span id="HebbianTzimtzumESN-72"><a href="#HebbianTzimtzumESN-72"><span class="linenos"> 72</span></a><span class="sd">        &gt;&gt;&gt; </span>
</span><span id="HebbianTzimtzumESN-73"><a href="#HebbianTzimtzumESN-73"><span class="linenos"> 73</span></a><span class="sd">        &gt;&gt;&gt; # Ejecutar Dark Night</span>
</span><span id="HebbianTzimtzumESN-74"><a href="#HebbianTzimtzumESN-74"><span class="linenos"> 74</span></a><span class="sd">        &gt;&gt;&gt; esn.dark_night()</span>
</span><span id="HebbianTzimtzumESN-75"><a href="#HebbianTzimtzumESN-75"><span class="linenos"> 75</span></a><span class="sd">        &gt;&gt;&gt; </span>
</span><span id="HebbianTzimtzumESN-76"><a href="#HebbianTzimtzumESN-76"><span class="linenos"> 76</span></a><span class="sd">        &gt;&gt;&gt; # Continuar adaptación</span>
</span><span id="HebbianTzimtzumESN-77"><a href="#HebbianTzimtzumESN-77"><span class="linenos"> 77</span></a><span class="sd">        &gt;&gt;&gt; esn.adapt_online(X_new)</span>
</span><span id="HebbianTzimtzumESN-78"><a href="#HebbianTzimtzumESN-78"><span class="linenos"> 78</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="HebbianTzimtzumESN-79"><a href="#HebbianTzimtzumESN-79"><span class="linenos"> 79</span></a>    
</span><span id="HebbianTzimtzumESN-80"><a href="#HebbianTzimtzumESN-80"><span class="linenos"> 80</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="HebbianTzimtzumESN-81"><a href="#HebbianTzimtzumESN-81"><span class="linenos"> 81</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN-82"><a href="#HebbianTzimtzumESN-82"><span class="linenos"> 82</span></a>        <span class="n">n_inputs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN-83"><a href="#HebbianTzimtzumESN-83"><span class="linenos"> 83</span></a>        <span class="n">n_reservoir</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN-84"><a href="#HebbianTzimtzumESN-84"><span class="linenos"> 84</span></a>        <span class="n">n_outputs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN-85"><a href="#HebbianTzimtzumESN-85"><span class="linenos"> 85</span></a>        <span class="n">spectral_radius</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN-86"><a href="#HebbianTzimtzumESN-86"><span class="linenos"> 86</span></a>        <span class="n">sparsity</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN-87"><a href="#HebbianTzimtzumESN-87"><span class="linenos"> 87</span></a>        <span class="n">noise</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN-88"><a href="#HebbianTzimtzumESN-88"><span class="linenos"> 88</span></a>        <span class="n">learning_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN-89"><a href="#HebbianTzimtzumESN-89"><span class="linenos"> 89</span></a>        <span class="n">plasticity_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;hebbian&#39;</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN-90"><a href="#HebbianTzimtzumESN-90"><span class="linenos"> 90</span></a>        <span class="n">tzimtzum_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TzimtzumConfig</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN-91"><a href="#HebbianTzimtzumESN-91"><span class="linenos"> 91</span></a>        <span class="n">random_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="HebbianTzimtzumESN-92"><a href="#HebbianTzimtzumESN-92"><span class="linenos"> 92</span></a>    <span class="p">):</span>
</span><span id="HebbianTzimtzumESN-93"><a href="#HebbianTzimtzumESN-93"><span class="linenos"> 93</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HebbianTzimtzumESN-94"><a href="#HebbianTzimtzumESN-94"><span class="linenos"> 94</span></a><span class="sd">        Inicializa HebbianTzimtzumESN.</span>
</span><span id="HebbianTzimtzumESN-95"><a href="#HebbianTzimtzumESN-95"><span class="linenos"> 95</span></a><span class="sd">        </span>
</span><span id="HebbianTzimtzumESN-96"><a href="#HebbianTzimtzumESN-96"><span class="linenos"> 96</span></a><span class="sd">        Args:</span>
</span><span id="HebbianTzimtzumESN-97"><a href="#HebbianTzimtzumESN-97"><span class="linenos"> 97</span></a><span class="sd">            n_inputs: Dimensión de entrada</span>
</span><span id="HebbianTzimtzumESN-98"><a href="#HebbianTzimtzumESN-98"><span class="linenos"> 98</span></a><span class="sd">            n_reservoir: Número de neuronas</span>
</span><span id="HebbianTzimtzumESN-99"><a href="#HebbianTzimtzumESN-99"><span class="linenos"> 99</span></a><span class="sd">            n_outputs: Dimensión de salida</span>
</span><span id="HebbianTzimtzumESN-100"><a href="#HebbianTzimtzumESN-100"><span class="linenos">100</span></a><span class="sd">            spectral_radius: Radio espectral</span>
</span><span id="HebbianTzimtzumESN-101"><a href="#HebbianTzimtzumESN-101"><span class="linenos">101</span></a><span class="sd">            sparsity: Sparsity inicial</span>
</span><span id="HebbianTzimtzumESN-102"><a href="#HebbianTzimtzumESN-102"><span class="linenos">102</span></a><span class="sd">            noise: Ruido de regularización</span>
</span><span id="HebbianTzimtzumESN-103"><a href="#HebbianTzimtzumESN-103"><span class="linenos">103</span></a><span class="sd">            learning_rate: Tasa de aprendizaje Hebbiano</span>
</span><span id="HebbianTzimtzumESN-104"><a href="#HebbianTzimtzumESN-104"><span class="linenos">104</span></a><span class="sd">            plasticity_type: &#39;hebbian&#39;, &#39;stdp&#39;, o &#39;anti_hebbian&#39;</span>
</span><span id="HebbianTzimtzumESN-105"><a href="#HebbianTzimtzumESN-105"><span class="linenos">105</span></a><span class="sd">            tzimtzum_config: Configuración del protocolo Tzimtzum</span>
</span><span id="HebbianTzimtzumESN-106"><a href="#HebbianTzimtzumESN-106"><span class="linenos">106</span></a><span class="sd">            random_state: Semilla aleatoria</span>
</span><span id="HebbianTzimtzumESN-107"><a href="#HebbianTzimtzumESN-107"><span class="linenos">107</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HebbianTzimtzumESN-108"><a href="#HebbianTzimtzumESN-108"><span class="linenos">108</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="HebbianTzimtzumESN-109"><a href="#HebbianTzimtzumESN-109"><span class="linenos">109</span></a>            <span class="n">n_inputs</span><span class="o">=</span><span class="n">n_inputs</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN-110"><a href="#HebbianTzimtzumESN-110"><span class="linenos">110</span></a>            <span class="n">n_reservoir</span><span class="o">=</span><span class="n">n_reservoir</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN-111"><a href="#HebbianTzimtzumESN-111"><span class="linenos">111</span></a>            <span class="n">n_outputs</span><span class="o">=</span><span class="n">n_outputs</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN-112"><a href="#HebbianTzimtzumESN-112"><span class="linenos">112</span></a>            <span class="n">spectral_radius</span><span class="o">=</span><span class="n">spectral_radius</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN-113"><a href="#HebbianTzimtzumESN-113"><span class="linenos">113</span></a>            <span class="n">sparsity</span><span class="o">=</span><span class="n">sparsity</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN-114"><a href="#HebbianTzimtzumESN-114"><span class="linenos">114</span></a>            <span class="n">noise</span><span class="o">=</span><span class="n">noise</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN-115"><a href="#HebbianTzimtzumESN-115"><span class="linenos">115</span></a>            <span class="n">learning_rate</span><span class="o">=</span><span class="n">learning_rate</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN-116"><a href="#HebbianTzimtzumESN-116"><span class="linenos">116</span></a>            <span class="n">plasticity_type</span><span class="o">=</span><span class="n">plasticity_type</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN-117"><a href="#HebbianTzimtzumESN-117"><span class="linenos">117</span></a>            <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span>
</span><span id="HebbianTzimtzumESN-118"><a href="#HebbianTzimtzumESN-118"><span class="linenos">118</span></a>        <span class="p">)</span>
</span><span id="HebbianTzimtzumESN-119"><a href="#HebbianTzimtzumESN-119"><span class="linenos">119</span></a>        
</span><span id="HebbianTzimtzumESN-120"><a href="#HebbianTzimtzumESN-120"><span class="linenos">120</span></a>        <span class="c1"># Configuración Tzimtzum</span>
</span><span id="HebbianTzimtzumESN-121"><a href="#HebbianTzimtzumESN-121"><span class="linenos">121</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_config</span> <span class="o">=</span> <span class="n">tzimtzum_config</span> <span class="ow">or</span> <span class="n">TzimtzumConfig</span><span class="p">()</span>
</span><span id="HebbianTzimtzumESN-122"><a href="#HebbianTzimtzumESN-122"><span class="linenos">122</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span> <span class="o">=</span> <span class="n">TzimtzumState</span><span class="p">()</span>
</span><span id="HebbianTzimtzumESN-123"><a href="#HebbianTzimtzumESN-123"><span class="linenos">123</span></a>        
</span><span id="HebbianTzimtzumESN-124"><a href="#HebbianTzimtzumESN-124"><span class="linenos">124</span></a>        <span class="c1"># RNG para regrowth</span>
</span><span id="HebbianTzimtzumESN-125"><a href="#HebbianTzimtzumESN-125"><span class="linenos">125</span></a>        <span class="n">regrowth_seed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_config</span><span class="o">.</span><span class="n">regrowth_seed</span> <span class="ow">or</span> <span class="n">random_state</span>
</span><span id="HebbianTzimtzumESN-126"><a href="#HebbianTzimtzumESN-126"><span class="linenos">126</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_regrowth_rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">regrowth_seed</span><span class="p">)</span>
</span><span id="HebbianTzimtzumESN-127"><a href="#HebbianTzimtzumESN-127"><span class="linenos">127</span></a>        
</span><span id="HebbianTzimtzumESN-128"><a href="#HebbianTzimtzumESN-128"><span class="linenos">128</span></a>        <span class="c1"># Tracking de conexiones</span>
</span><span id="HebbianTzimtzumESN-129"><a href="#HebbianTzimtzumESN-129"><span class="linenos">129</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_connection_mask</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="HebbianTzimtzumESN-130"><a href="#HebbianTzimtzumESN-130"><span class="linenos">130</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_connection_importance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span><span class="p">)</span>
</span><span id="HebbianTzimtzumESN-131"><a href="#HebbianTzimtzumESN-131"><span class="linenos">131</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_hebbian_contribution</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span><span class="p">)</span>
</span><span id="HebbianTzimtzumESN-132"><a href="#HebbianTzimtzumESN-132"><span class="linenos">132</span></a>        
</span><span id="HebbianTzimtzumESN-133"><a href="#HebbianTzimtzumESN-133"><span class="linenos">133</span></a>        <span class="c1"># Historial</span>
</span><span id="HebbianTzimtzumESN-134"><a href="#HebbianTzimtzumESN-134"><span class="linenos">134</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pruning_history</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="HebbianTzimtzumESN-135"><a href="#HebbianTzimtzumESN-135"><span class="linenos">135</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_step_count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="HebbianTzimtzumESN-136"><a href="#HebbianTzimtzumESN-136"><span class="linenos">136</span></a>        
</span><span id="HebbianTzimtzumESN-137"><a href="#HebbianTzimtzumESN-137"><span class="linenos">137</span></a>        <span class="c1"># Inicializar métricas</span>
</span><span id="HebbianTzimtzumESN-138"><a href="#HebbianTzimtzumESN-138"><span class="linenos">138</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_update_tzimtzum_metrics</span><span class="p">()</span>
</span><span id="HebbianTzimtzumESN-139"><a href="#HebbianTzimtzumESN-139"><span class="linenos">139</span></a>    
</span><span id="HebbianTzimtzumESN-140"><a href="#HebbianTzimtzumESN-140"><span class="linenos">140</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_update_tzimtzum_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="HebbianTzimtzumESN-141"><a href="#HebbianTzimtzumESN-141"><span class="linenos">141</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Actualiza métricas del estado Tzimtzum.&quot;&quot;&quot;</span>
</span><span id="HebbianTzimtzumESN-142"><a href="#HebbianTzimtzumESN-142"><span class="linenos">142</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">total_connections</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_connection_mask</span><span class="p">))</span>
</span><span id="HebbianTzimtzumESN-143"><a href="#HebbianTzimtzumESN-143"><span class="linenos">143</span></a>        <span class="n">max_connections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_reservoir</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="HebbianTzimtzumESN-144"><a href="#HebbianTzimtzumESN-144"><span class="linenos">144</span></a>        <span class="n">active</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">total_connections</span>
</span><span id="HebbianTzimtzumESN-145"><a href="#HebbianTzimtzumESN-145"><span class="linenos">145</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">compression_ratio</span> <span class="o">=</span> <span class="n">active</span> <span class="o">/</span> <span class="n">max_connections</span> <span class="k">if</span> <span class="n">max_connections</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
</span><span id="HebbianTzimtzumESN-146"><a href="#HebbianTzimtzumESN-146"><span class="linenos">146</span></a>    
</span><span id="HebbianTzimtzumESN-147"><a href="#HebbianTzimtzumESN-147"><span class="linenos">147</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_plasticity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_vector</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">new_state</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span><span id="HebbianTzimtzumESN-148"><a href="#HebbianTzimtzumESN-148"><span class="linenos">148</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HebbianTzimtzumESN-149"><a href="#HebbianTzimtzumESN-149"><span class="linenos">149</span></a><span class="sd">        Aplica plasticidad Hebbiana con tracking para Tzimtzum.</span>
</span><span id="HebbianTzimtzumESN-150"><a href="#HebbianTzimtzumESN-150"><span class="linenos">150</span></a><span class="sd">        </span>
</span><span id="HebbianTzimtzumESN-151"><a href="#HebbianTzimtzumESN-151"><span class="linenos">151</span></a><span class="sd">        Además del update Hebbiano normal, rastrea qué conexiones</span>
</span><span id="HebbianTzimtzumESN-152"><a href="#HebbianTzimtzumESN-152"><span class="linenos">152</span></a><span class="sd">        están siendo fortalecidas para informar decisiones de poda.</span>
</span><span id="HebbianTzimtzumESN-153"><a href="#HebbianTzimtzumESN-153"><span class="linenos">153</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HebbianTzimtzumESN-154"><a href="#HebbianTzimtzumESN-154"><span class="linenos">154</span></a>        <span class="c1"># Obtener delta antes de aplicar</span>
</span><span id="HebbianTzimtzumESN-155"><a href="#HebbianTzimtzumESN-155"><span class="linenos">155</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plasticity_type</span> <span class="o">==</span> <span class="s1">&#39;hebbian&#39;</span><span class="p">:</span>
</span><span id="HebbianTzimtzumESN-156"><a href="#HebbianTzimtzumESN-156"><span class="linenos">156</span></a>            <span class="n">delta_w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hebbian_update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_prev_state</span><span class="p">,</span> <span class="n">new_state</span><span class="p">)</span>
</span><span id="HebbianTzimtzumESN-157"><a href="#HebbianTzimtzumESN-157"><span class="linenos">157</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">plasticity_type</span> <span class="o">==</span> <span class="s1">&#39;stdp&#39;</span><span class="p">:</span>
</span><span id="HebbianTzimtzumESN-158"><a href="#HebbianTzimtzumESN-158"><span class="linenos">158</span></a>            <span class="n">delta_w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stdp_update</span><span class="p">(</span>
</span><span id="HebbianTzimtzumESN-159"><a href="#HebbianTzimtzumESN-159"><span class="linenos">159</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_prev_state</span><span class="p">,</span> <span class="n">new_state</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN-160"><a href="#HebbianTzimtzumESN-160"><span class="linenos">160</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_prev_state</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span>
</span><span id="HebbianTzimtzumESN-161"><a href="#HebbianTzimtzumESN-161"><span class="linenos">161</span></a>            <span class="p">)</span>
</span><span id="HebbianTzimtzumESN-162"><a href="#HebbianTzimtzumESN-162"><span class="linenos">162</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">plasticity_type</span> <span class="o">==</span> <span class="s1">&#39;anti_hebbian&#39;</span><span class="p">:</span>
</span><span id="HebbianTzimtzumESN-163"><a href="#HebbianTzimtzumESN-163"><span class="linenos">163</span></a>            <span class="n">delta_w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_anti_hebbian_update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_prev_state</span><span class="p">,</span> <span class="n">new_state</span><span class="p">)</span>
</span><span id="HebbianTzimtzumESN-164"><a href="#HebbianTzimtzumESN-164"><span class="linenos">164</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="HebbianTzimtzumESN-165"><a href="#HebbianTzimtzumESN-165"><span class="linenos">165</span></a>            <span class="k">return</span>
</span><span id="HebbianTzimtzumESN-166"><a href="#HebbianTzimtzumESN-166"><span class="linenos">166</span></a>        
</span><span id="HebbianTzimtzumESN-167"><a href="#HebbianTzimtzumESN-167"><span class="linenos">167</span></a>        <span class="c1"># Aplicar solo a conexiones activas</span>
</span><span id="HebbianTzimtzumESN-168"><a href="#HebbianTzimtzumESN-168"><span class="linenos">168</span></a>        <span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection_mask</span>
</span><span id="HebbianTzimtzumESN-169"><a href="#HebbianTzimtzumESN-169"><span class="linenos">169</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span> <span class="o">+=</span> <span class="n">delta_w</span> <span class="o">*</span> <span class="n">mask</span>
</span><span id="HebbianTzimtzumESN-170"><a href="#HebbianTzimtzumESN-170"><span class="linenos">170</span></a>        
</span><span id="HebbianTzimtzumESN-171"><a href="#HebbianTzimtzumESN-171"><span class="linenos">171</span></a>        <span class="c1"># Tracking de contribución Hebbiana</span>
</span><span id="HebbianTzimtzumESN-172"><a href="#HebbianTzimtzumESN-172"><span class="linenos">172</span></a>        <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.99</span>
</span><span id="HebbianTzimtzumESN-173"><a href="#HebbianTzimtzumESN-173"><span class="linenos">173</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_hebbian_contribution</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="HebbianTzimtzumESN-174"><a href="#HebbianTzimtzumESN-174"><span class="linenos">174</span></a>            <span class="n">alpha</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hebbian_contribution</span> <span class="o">+</span>
</span><span id="HebbianTzimtzumESN-175"><a href="#HebbianTzimtzumESN-175"><span class="linenos">175</span></a>            <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">delta_w</span><span class="p">)</span>
</span><span id="HebbianTzimtzumESN-176"><a href="#HebbianTzimtzumESN-176"><span class="linenos">176</span></a>        <span class="p">)</span>
</span><span id="HebbianTzimtzumESN-177"><a href="#HebbianTzimtzumESN-177"><span class="linenos">177</span></a>        
</span><span id="HebbianTzimtzumESN-178"><a href="#HebbianTzimtzumESN-178"><span class="linenos">178</span></a>        <span class="c1"># Mantener estabilidad</span>
</span><span id="HebbianTzimtzumESN-179"><a href="#HebbianTzimtzumESN-179"><span class="linenos">179</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_spectral_radius</span><span class="p">()</span>
</span><span id="HebbianTzimtzumESN-180"><a href="#HebbianTzimtzumESN-180"><span class="linenos">180</span></a>        
</span><span id="HebbianTzimtzumESN-181"><a href="#HebbianTzimtzumESN-181"><span class="linenos">181</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_adaptation_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="HebbianTzimtzumESN-182"><a href="#HebbianTzimtzumESN-182"><span class="linenos">182</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_step_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="HebbianTzimtzumESN-183"><a href="#HebbianTzimtzumESN-183"><span class="linenos">183</span></a>        
</span><span id="HebbianTzimtzumESN-184"><a href="#HebbianTzimtzumESN-184"><span class="linenos">184</span></a>        <span class="c1"># Auto-poda si está configurado</span>
</span><span id="HebbianTzimtzumESN-185"><a href="#HebbianTzimtzumESN-185"><span class="linenos">185</span></a>        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_config</span><span class="o">.</span><span class="n">dark_night_interval</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span>
</span><span id="HebbianTzimtzumESN-186"><a href="#HebbianTzimtzumESN-186"><span class="linenos">186</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_step_count</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_config</span><span class="o">.</span><span class="n">dark_night_interval</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="HebbianTzimtzumESN-187"><a href="#HebbianTzimtzumESN-187"><span class="linenos">187</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">full_tzimtzum_cycle</span><span class="p">()</span>
</span><span id="HebbianTzimtzumESN-188"><a href="#HebbianTzimtzumESN-188"><span class="linenos">188</span></a>    
</span><span id="HebbianTzimtzumESN-189"><a href="#HebbianTzimtzumESN-189"><span class="linenos">189</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_importance</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="HebbianTzimtzumESN-190"><a href="#HebbianTzimtzumESN-190"><span class="linenos">190</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HebbianTzimtzumESN-191"><a href="#HebbianTzimtzumESN-191"><span class="linenos">191</span></a><span class="sd">        Calcula importancia de conexiones combinando múltiples señales.</span>
</span><span id="HebbianTzimtzumESN-192"><a href="#HebbianTzimtzumESN-192"><span class="linenos">192</span></a><span class="sd">        </span>
</span><span id="HebbianTzimtzumESN-193"><a href="#HebbianTzimtzumESN-193"><span class="linenos">193</span></a><span class="sd">        Combina:</span>
</span><span id="HebbianTzimtzumESN-194"><a href="#HebbianTzimtzumESN-194"><span class="linenos">194</span></a><span class="sd">        1. Magnitud del peso actual</span>
</span><span id="HebbianTzimtzumESN-195"><a href="#HebbianTzimtzumESN-195"><span class="linenos">195</span></a><span class="sd">        2. Contribución Hebbiana acumulada</span>
</span><span id="HebbianTzimtzumESN-196"><a href="#HebbianTzimtzumESN-196"><span class="linenos">196</span></a><span class="sd">        3. Frecuencia de uso</span>
</span><span id="HebbianTzimtzumESN-197"><a href="#HebbianTzimtzumESN-197"><span class="linenos">197</span></a><span class="sd">        </span>
</span><span id="HebbianTzimtzumESN-198"><a href="#HebbianTzimtzumESN-198"><span class="linenos">198</span></a><span class="sd">        Conexiones que son fuertes Y activamente reforzadas por</span>
</span><span id="HebbianTzimtzumESN-199"><a href="#HebbianTzimtzumESN-199"><span class="linenos">199</span></a><span class="sd">        plasticidad tienen mayor probabilidad de sobrevivir.</span>
</span><span id="HebbianTzimtzumESN-200"><a href="#HebbianTzimtzumESN-200"><span class="linenos">200</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HebbianTzimtzumESN-201"><a href="#HebbianTzimtzumESN-201"><span class="linenos">201</span></a>        <span class="c1"># Componente 1: Magnitud absoluta</span>
</span><span id="HebbianTzimtzumESN-202"><a href="#HebbianTzimtzumESN-202"><span class="linenos">202</span></a>        <span class="n">weight_importance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span><span class="p">)</span>
</span><span id="HebbianTzimtzumESN-203"><a href="#HebbianTzimtzumESN-203"><span class="linenos">203</span></a>        
</span><span id="HebbianTzimtzumESN-204"><a href="#HebbianTzimtzumESN-204"><span class="linenos">204</span></a>        <span class="c1"># Componente 2: Contribución Hebbiana (cuánto se refuerza)</span>
</span><span id="HebbianTzimtzumESN-205"><a href="#HebbianTzimtzumESN-205"><span class="linenos">205</span></a>        <span class="n">hebbian_importance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hebbian_contribution</span>
</span><span id="HebbianTzimtzumESN-206"><a href="#HebbianTzimtzumESN-206"><span class="linenos">206</span></a>        
</span><span id="HebbianTzimtzumESN-207"><a href="#HebbianTzimtzumESN-207"><span class="linenos">207</span></a>        <span class="c1"># Normalizar componentes</span>
</span><span id="HebbianTzimtzumESN-208"><a href="#HebbianTzimtzumESN-208"><span class="linenos">208</span></a>        <span class="k">if</span> <span class="n">weight_importance</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="HebbianTzimtzumESN-209"><a href="#HebbianTzimtzumESN-209"><span class="linenos">209</span></a>            <span class="n">weight_importance</span> <span class="o">=</span> <span class="n">weight_importance</span> <span class="o">/</span> <span class="n">weight_importance</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="HebbianTzimtzumESN-210"><a href="#HebbianTzimtzumESN-210"><span class="linenos">210</span></a>        <span class="k">if</span> <span class="n">hebbian_importance</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="HebbianTzimtzumESN-211"><a href="#HebbianTzimtzumESN-211"><span class="linenos">211</span></a>            <span class="n">hebbian_importance</span> <span class="o">=</span> <span class="n">hebbian_importance</span> <span class="o">/</span> <span class="n">hebbian_importance</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="HebbianTzimtzumESN-212"><a href="#HebbianTzimtzumESN-212"><span class="linenos">212</span></a>        
</span><span id="HebbianTzimtzumESN-213"><a href="#HebbianTzimtzumESN-213"><span class="linenos">213</span></a>        <span class="c1"># Combinación ponderada</span>
</span><span id="HebbianTzimtzumESN-214"><a href="#HebbianTzimtzumESN-214"><span class="linenos">214</span></a>        <span class="c1"># Pesos que son fuertes Y reforzados son más importantes</span>
</span><span id="HebbianTzimtzumESN-215"><a href="#HebbianTzimtzumESN-215"><span class="linenos">215</span></a>        <span class="n">importance</span> <span class="o">=</span> <span class="mf">0.6</span> <span class="o">*</span> <span class="n">weight_importance</span> <span class="o">+</span> <span class="mf">0.4</span> <span class="o">*</span> <span class="n">hebbian_importance</span>
</span><span id="HebbianTzimtzumESN-216"><a href="#HebbianTzimtzumESN-216"><span class="linenos">216</span></a>        
</span><span id="HebbianTzimtzumESN-217"><a href="#HebbianTzimtzumESN-217"><span class="linenos">217</span></a>        <span class="k">return</span> <span class="n">importance</span>
</span><span id="HebbianTzimtzumESN-218"><a href="#HebbianTzimtzumESN-218"><span class="linenos">218</span></a>    
</span><span id="HebbianTzimtzumESN-219"><a href="#HebbianTzimtzumESN-219"><span class="linenos">219</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">dark_night</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fraction</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="HebbianTzimtzumESN-220"><a href="#HebbianTzimtzumESN-220"><span class="linenos">220</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HebbianTzimtzumESN-221"><a href="#HebbianTzimtzumESN-221"><span class="linenos">221</span></a><span class="sd">        Ejecuta Dark Night con criterio Hebbiano.</span>
</span><span id="HebbianTzimtzumESN-222"><a href="#HebbianTzimtzumESN-222"><span class="linenos">222</span></a><span class="sd">        </span>
</span><span id="HebbianTzimtzumESN-223"><a href="#HebbianTzimtzumESN-223"><span class="linenos">223</span></a><span class="sd">        Las conexiones que han sido activamente reforzadas por</span>
</span><span id="HebbianTzimtzumESN-224"><a href="#HebbianTzimtzumESN-224"><span class="linenos">224</span></a><span class="sd">        plasticidad Hebbiana tienen mayor probabilidad de sobrevivir.</span>
</span><span id="HebbianTzimtzumESN-225"><a href="#HebbianTzimtzumESN-225"><span class="linenos">225</span></a><span class="sd">        </span>
</span><span id="HebbianTzimtzumESN-226"><a href="#HebbianTzimtzumESN-226"><span class="linenos">226</span></a><span class="sd">        Args:</span>
</span><span id="HebbianTzimtzumESN-227"><a href="#HebbianTzimtzumESN-227"><span class="linenos">227</span></a><span class="sd">            fraction: Fracción de conexiones a podar</span>
</span><span id="HebbianTzimtzumESN-228"><a href="#HebbianTzimtzumESN-228"><span class="linenos">228</span></a><span class="sd">            </span>
</span><span id="HebbianTzimtzumESN-229"><a href="#HebbianTzimtzumESN-229"><span class="linenos">229</span></a><span class="sd">        Returns:</span>
</span><span id="HebbianTzimtzumESN-230"><a href="#HebbianTzimtzumESN-230"><span class="linenos">230</span></a><span class="sd">            Estadísticas de poda</span>
</span><span id="HebbianTzimtzumESN-231"><a href="#HebbianTzimtzumESN-231"><span class="linenos">231</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HebbianTzimtzumESN-232"><a href="#HebbianTzimtzumESN-232"><span class="linenos">232</span></a>        <span class="n">fraction</span> <span class="o">=</span> <span class="n">fraction</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_config</span><span class="o">.</span><span class="n">pruning_fraction</span>
</span><span id="HebbianTzimtzumESN-233"><a href="#HebbianTzimtzumESN-233"><span class="linenos">233</span></a>        
</span><span id="HebbianTzimtzumESN-234"><a href="#HebbianTzimtzumESN-234"><span class="linenos">234</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="n">ContractionPhase</span><span class="o">.</span><span class="n">DARK_NIGHT</span>
</span><span id="HebbianTzimtzumESN-235"><a href="#HebbianTzimtzumESN-235"><span class="linenos">235</span></a>        
</span><span id="HebbianTzimtzumESN-236"><a href="#HebbianTzimtzumESN-236"><span class="linenos">236</span></a>        <span class="c1"># Importancia combinada</span>
</span><span id="HebbianTzimtzumESN-237"><a href="#HebbianTzimtzumESN-237"><span class="linenos">237</span></a>        <span class="n">importance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_importance</span><span class="p">()</span>
</span><span id="HebbianTzimtzumESN-238"><a href="#HebbianTzimtzumESN-238"><span class="linenos">238</span></a>        
</span><span id="HebbianTzimtzumESN-239"><a href="#HebbianTzimtzumESN-239"><span class="linenos">239</span></a>        <span class="c1"># Solo conexiones activas</span>
</span><span id="HebbianTzimtzumESN-240"><a href="#HebbianTzimtzumESN-240"><span class="linenos">240</span></a>        <span class="n">active_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection_mask</span>
</span><span id="HebbianTzimtzumESN-241"><a href="#HebbianTzimtzumESN-241"><span class="linenos">241</span></a>        <span class="n">active_importance</span> <span class="o">=</span> <span class="n">importance</span><span class="p">[</span><span class="n">active_mask</span><span class="p">]</span>
</span><span id="HebbianTzimtzumESN-242"><a href="#HebbianTzimtzumESN-242"><span class="linenos">242</span></a>        
</span><span id="HebbianTzimtzumESN-243"><a href="#HebbianTzimtzumESN-243"><span class="linenos">243</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">active_importance</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="HebbianTzimtzumESN-244"><a href="#HebbianTzimtzumESN-244"><span class="linenos">244</span></a>            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;pruned_count&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;No hay conexiones activas&#39;</span><span class="p">}</span>
</span><span id="HebbianTzimtzumESN-245"><a href="#HebbianTzimtzumESN-245"><span class="linenos">245</span></a>        
</span><span id="HebbianTzimtzumESN-246"><a href="#HebbianTzimtzumESN-246"><span class="linenos">246</span></a>        <span class="c1"># Calcular umbral</span>
</span><span id="HebbianTzimtzumESN-247"><a href="#HebbianTzimtzumESN-247"><span class="linenos">247</span></a>        <span class="n">threshold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">active_importance</span><span class="p">,</span> <span class="n">fraction</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
</span><span id="HebbianTzimtzumESN-248"><a href="#HebbianTzimtzumESN-248"><span class="linenos">248</span></a>        
</span><span id="HebbianTzimtzumESN-249"><a href="#HebbianTzimtzumESN-249"><span class="linenos">249</span></a>        <span class="c1"># Mínimo de conexiones</span>
</span><span id="HebbianTzimtzumESN-250"><a href="#HebbianTzimtzumESN-250"><span class="linenos">250</span></a>        <span class="n">min_connections</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
</span><span id="HebbianTzimtzumESN-251"><a href="#HebbianTzimtzumESN-251"><span class="linenos">251</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_reservoir</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_config</span><span class="o">.</span><span class="n">min_connections_fraction</span>
</span><span id="HebbianTzimtzumESN-252"><a href="#HebbianTzimtzumESN-252"><span class="linenos">252</span></a>        <span class="p">)</span>
</span><span id="HebbianTzimtzumESN-253"><a href="#HebbianTzimtzumESN-253"><span class="linenos">253</span></a>        <span class="n">current_connections</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">active_mask</span><span class="p">)</span>
</span><span id="HebbianTzimtzumESN-254"><a href="#HebbianTzimtzumESN-254"><span class="linenos">254</span></a>        <span class="n">max_to_prune</span> <span class="o">=</span> <span class="n">current_connections</span> <span class="o">-</span> <span class="n">min_connections</span>
</span><span id="HebbianTzimtzumESN-255"><a href="#HebbianTzimtzumESN-255"><span class="linenos">255</span></a>        
</span><span id="HebbianTzimtzumESN-256"><a href="#HebbianTzimtzumESN-256"><span class="linenos">256</span></a>        <span class="k">if</span> <span class="n">max_to_prune</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="HebbianTzimtzumESN-257"><a href="#HebbianTzimtzumESN-257"><span class="linenos">257</span></a>            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;pruned_count&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;Ya en mínimo de conexiones&#39;</span><span class="p">}</span>
</span><span id="HebbianTzimtzumESN-258"><a href="#HebbianTzimtzumESN-258"><span class="linenos">258</span></a>        
</span><span id="HebbianTzimtzumESN-259"><a href="#HebbianTzimtzumESN-259"><span class="linenos">259</span></a>        <span class="c1"># Máscara de supervivencia</span>
</span><span id="HebbianTzimtzumESN-260"><a href="#HebbianTzimtzumESN-260"><span class="linenos">260</span></a>        <span class="n">survival_mask</span> <span class="o">=</span> <span class="n">importance</span> <span class="o">&gt;=</span> <span class="n">threshold</span>
</span><span id="HebbianTzimtzumESN-261"><a href="#HebbianTzimtzumESN-261"><span class="linenos">261</span></a>        
</span><span id="HebbianTzimtzumESN-262"><a href="#HebbianTzimtzumESN-262"><span class="linenos">262</span></a>        <span class="c1"># Preservar topología</span>
</span><span id="HebbianTzimtzumESN-263"><a href="#HebbianTzimtzumESN-263"><span class="linenos">263</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_config</span><span class="o">.</span><span class="n">preserve_topology</span><span class="p">:</span>
</span><span id="HebbianTzimtzumESN-264"><a href="#HebbianTzimtzumESN-264"><span class="linenos">264</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_reservoir</span><span class="p">):</span>
</span><span id="HebbianTzimtzumESN-265"><a href="#HebbianTzimtzumESN-265"><span class="linenos">265</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">survival_mask</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]):</span>
</span><span id="HebbianTzimtzumESN-266"><a href="#HebbianTzimtzumESN-266"><span class="linenos">266</span></a>                    <span class="n">best_in</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]))</span>
</span><span id="HebbianTzimtzumESN-267"><a href="#HebbianTzimtzumESN-267"><span class="linenos">267</span></a>                    <span class="n">survival_mask</span><span class="p">[</span><span class="n">best_in</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="HebbianTzimtzumESN-268"><a href="#HebbianTzimtzumESN-268"><span class="linenos">268</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">survival_mask</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]):</span>
</span><span id="HebbianTzimtzumESN-269"><a href="#HebbianTzimtzumESN-269"><span class="linenos">269</span></a>                    <span class="n">best_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]))</span>
</span><span id="HebbianTzimtzumESN-270"><a href="#HebbianTzimtzumESN-270"><span class="linenos">270</span></a>                    <span class="n">survival_mask</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">best_out</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="HebbianTzimtzumESN-271"><a href="#HebbianTzimtzumESN-271"><span class="linenos">271</span></a>        
</span><span id="HebbianTzimtzumESN-272"><a href="#HebbianTzimtzumESN-272"><span class="linenos">272</span></a>        <span class="c1"># Ejecutar poda</span>
</span><span id="HebbianTzimtzumESN-273"><a href="#HebbianTzimtzumESN-273"><span class="linenos">273</span></a>        <span class="n">pre_count</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="HebbianTzimtzumESN-274"><a href="#HebbianTzimtzumESN-274"><span class="linenos">274</span></a>        
</span><span id="HebbianTzimtzumESN-275"><a href="#HebbianTzimtzumESN-275"><span class="linenos">275</span></a>        <span class="n">prune_mask</span> <span class="o">=</span> <span class="o">~</span><span class="n">survival_mask</span> <span class="o">&amp;</span> <span class="n">active_mask</span>
</span><span id="HebbianTzimtzumESN-276"><a href="#HebbianTzimtzumESN-276"><span class="linenos">276</span></a>        <span class="n">pruned_count</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">prune_mask</span><span class="p">)),</span> <span class="n">max_to_prune</span><span class="p">)</span>
</span><span id="HebbianTzimtzumESN-277"><a href="#HebbianTzimtzumESN-277"><span class="linenos">277</span></a>        
</span><span id="HebbianTzimtzumESN-278"><a href="#HebbianTzimtzumESN-278"><span class="linenos">278</span></a>        <span class="c1"># Si hay más que max_to_prune, podar solo las menos importantes</span>
</span><span id="HebbianTzimtzumESN-279"><a href="#HebbianTzimtzumESN-279"><span class="linenos">279</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">prune_mask</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_to_prune</span><span class="p">:</span>
</span><span id="HebbianTzimtzumESN-280"><a href="#HebbianTzimtzumESN-280"><span class="linenos">280</span></a>            <span class="n">prune_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">prune_mask</span><span class="p">)</span>
</span><span id="HebbianTzimtzumESN-281"><a href="#HebbianTzimtzumESN-281"><span class="linenos">281</span></a>            <span class="n">prune_importance</span> <span class="o">=</span> <span class="n">importance</span><span class="p">[</span><span class="n">prune_mask</span><span class="p">]</span>
</span><span id="HebbianTzimtzumESN-282"><a href="#HebbianTzimtzumESN-282"><span class="linenos">282</span></a>            <span class="n">sorted_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">prune_importance</span><span class="p">)[:</span><span class="n">max_to_prune</span><span class="p">]</span>
</span><span id="HebbianTzimtzumESN-283"><a href="#HebbianTzimtzumESN-283"><span class="linenos">283</span></a>            
</span><span id="HebbianTzimtzumESN-284"><a href="#HebbianTzimtzumESN-284"><span class="linenos">284</span></a>            <span class="n">prune_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">prune_mask</span><span class="p">)</span>
</span><span id="HebbianTzimtzumESN-285"><a href="#HebbianTzimtzumESN-285"><span class="linenos">285</span></a>            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">sorted_idx</span><span class="p">:</span>
</span><span id="HebbianTzimtzumESN-286"><a href="#HebbianTzimtzumESN-286"><span class="linenos">286</span></a>                <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">prune_indices</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
</span><span id="HebbianTzimtzumESN-287"><a href="#HebbianTzimtzumESN-287"><span class="linenos">287</span></a>                <span class="n">prune_mask</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="HebbianTzimtzumESN-288"><a href="#HebbianTzimtzumESN-288"><span class="linenos">288</span></a>        
</span><span id="HebbianTzimtzumESN-289"><a href="#HebbianTzimtzumESN-289"><span class="linenos">289</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span><span class="p">[</span><span class="n">prune_mask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="HebbianTzimtzumESN-290"><a href="#HebbianTzimtzumESN-290"><span class="linenos">290</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_connection_mask</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="HebbianTzimtzumESN-291"><a href="#HebbianTzimtzumESN-291"><span class="linenos">291</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_hebbian_contribution</span><span class="p">[</span><span class="n">prune_mask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="HebbianTzimtzumESN-292"><a href="#HebbianTzimtzumESN-292"><span class="linenos">292</span></a>        
</span><span id="HebbianTzimtzumESN-293"><a href="#HebbianTzimtzumESN-293"><span class="linenos">293</span></a>        <span class="c1"># Renormalizar</span>
</span><span id="HebbianTzimtzumESN-294"><a href="#HebbianTzimtzumESN-294"><span class="linenos">294</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_spectral_radius</span><span class="p">()</span>
</span><span id="HebbianTzimtzumESN-295"><a href="#HebbianTzimtzumESN-295"><span class="linenos">295</span></a>        
</span><span id="HebbianTzimtzumESN-296"><a href="#HebbianTzimtzumESN-296"><span class="linenos">296</span></a>        <span class="n">post_count</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="HebbianTzimtzumESN-297"><a href="#HebbianTzimtzumESN-297"><span class="linenos">297</span></a>        <span class="n">memory_saved</span> <span class="o">=</span> <span class="p">(</span><span class="n">pre_count</span> <span class="o">-</span> <span class="n">post_count</span><span class="p">)</span> <span class="o">*</span> <span class="mi">8</span>
</span><span id="HebbianTzimtzumESN-298"><a href="#HebbianTzimtzumESN-298"><span class="linenos">298</span></a>        
</span><span id="HebbianTzimtzumESN-299"><a href="#HebbianTzimtzumESN-299"><span class="linenos">299</span></a>        <span class="c1"># Actualizar estado</span>
</span><span id="HebbianTzimtzumESN-300"><a href="#HebbianTzimtzumESN-300"><span class="linenos">300</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">pruned_connections</span> <span class="o">+=</span> <span class="n">pruned_count</span>
</span><span id="HebbianTzimtzumESN-301"><a href="#HebbianTzimtzumESN-301"><span class="linenos">301</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">pruning_cycles</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="HebbianTzimtzumESN-302"><a href="#HebbianTzimtzumESN-302"><span class="linenos">302</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">memory_saved_bytes</span> <span class="o">+=</span> <span class="n">memory_saved</span>
</span><span id="HebbianTzimtzumESN-303"><a href="#HebbianTzimtzumESN-303"><span class="linenos">303</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="n">ContractionPhase</span><span class="o">.</span><span class="n">CHALLAL</span>
</span><span id="HebbianTzimtzumESN-304"><a href="#HebbianTzimtzumESN-304"><span class="linenos">304</span></a>        
</span><span id="HebbianTzimtzumESN-305"><a href="#HebbianTzimtzumESN-305"><span class="linenos">305</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_update_tzimtzum_metrics</span><span class="p">()</span>
</span><span id="HebbianTzimtzumESN-306"><a href="#HebbianTzimtzumESN-306"><span class="linenos">306</span></a>        
</span><span id="HebbianTzimtzumESN-307"><a href="#HebbianTzimtzumESN-307"><span class="linenos">307</span></a>        <span class="n">stats</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="HebbianTzimtzumESN-308"><a href="#HebbianTzimtzumESN-308"><span class="linenos">308</span></a>            <span class="s1">&#39;cycle&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">pruning_cycles</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN-309"><a href="#HebbianTzimtzumESN-309"><span class="linenos">309</span></a>            <span class="s1">&#39;pruned_count&#39;</span><span class="p">:</span> <span class="n">pruned_count</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN-310"><a href="#HebbianTzimtzumESN-310"><span class="linenos">310</span></a>            <span class="s1">&#39;pre_connections&#39;</span><span class="p">:</span> <span class="n">pre_count</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN-311"><a href="#HebbianTzimtzumESN-311"><span class="linenos">311</span></a>            <span class="s1">&#39;post_connections&#39;</span><span class="p">:</span> <span class="n">post_count</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN-312"><a href="#HebbianTzimtzumESN-312"><span class="linenos">312</span></a>            <span class="s1">&#39;memory_saved_bytes&#39;</span><span class="p">:</span> <span class="n">memory_saved</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN-313"><a href="#HebbianTzimtzumESN-313"><span class="linenos">313</span></a>            <span class="s1">&#39;compression_ratio&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">compression_ratio</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN-314"><a href="#HebbianTzimtzumESN-314"><span class="linenos">314</span></a>            <span class="s1">&#39;hebbian_contribution_preserved&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span>
</span><span id="HebbianTzimtzumESN-315"><a href="#HebbianTzimtzumESN-315"><span class="linenos">315</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hebbian_contribution</span><span class="p">)</span> <span class="o">/</span> 
</span><span id="HebbianTzimtzumESN-316"><a href="#HebbianTzimtzumESN-316"><span class="linenos">316</span></a>                <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hebbian_contribution</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-10</span><span class="p">)</span>
</span><span id="HebbianTzimtzumESN-317"><a href="#HebbianTzimtzumESN-317"><span class="linenos">317</span></a>            <span class="p">)</span>
</span><span id="HebbianTzimtzumESN-318"><a href="#HebbianTzimtzumESN-318"><span class="linenos">318</span></a>        <span class="p">}</span>
</span><span id="HebbianTzimtzumESN-319"><a href="#HebbianTzimtzumESN-319"><span class="linenos">319</span></a>        
</span><span id="HebbianTzimtzumESN-320"><a href="#HebbianTzimtzumESN-320"><span class="linenos">320</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pruning_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stats</span><span class="p">)</span>
</span><span id="HebbianTzimtzumESN-321"><a href="#HebbianTzimtzumESN-321"><span class="linenos">321</span></a>        <span class="k">return</span> <span class="n">stats</span>
</span><span id="HebbianTzimtzumESN-322"><a href="#HebbianTzimtzumESN-322"><span class="linenos">322</span></a>    
</span><span id="HebbianTzimtzumESN-323"><a href="#HebbianTzimtzumESN-323"><span class="linenos">323</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">renacimiento</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fraction</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="HebbianTzimtzumESN-324"><a href="#HebbianTzimtzumESN-324"><span class="linenos">324</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HebbianTzimtzumESN-325"><a href="#HebbianTzimtzumESN-325"><span class="linenos">325</span></a><span class="sd">        Regrowth de conexiones después del Dark Night.</span>
</span><span id="HebbianTzimtzumESN-326"><a href="#HebbianTzimtzumESN-326"><span class="linenos">326</span></a><span class="sd">        </span>
</span><span id="HebbianTzimtzumESN-327"><a href="#HebbianTzimtzumESN-327"><span class="linenos">327</span></a><span class="sd">        Las nuevas conexiones comienzan con pesos pequeños y</span>
</span><span id="HebbianTzimtzumESN-328"><a href="#HebbianTzimtzumESN-328"><span class="linenos">328</span></a><span class="sd">        deben ganarse su lugar mediante aprendizaje Hebbiano.</span>
</span><span id="HebbianTzimtzumESN-329"><a href="#HebbianTzimtzumESN-329"><span class="linenos">329</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HebbianTzimtzumESN-330"><a href="#HebbianTzimtzumESN-330"><span class="linenos">330</span></a>        <span class="n">fraction</span> <span class="o">=</span> <span class="n">fraction</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_config</span><span class="o">.</span><span class="n">regrowth_fraction</span>
</span><span id="HebbianTzimtzumESN-331"><a href="#HebbianTzimtzumESN-331"><span class="linenos">331</span></a>        
</span><span id="HebbianTzimtzumESN-332"><a href="#HebbianTzimtzumESN-332"><span class="linenos">332</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="n">ContractionPhase</span><span class="o">.</span><span class="n">RENACIMIENTO</span>
</span><span id="HebbianTzimtzumESN-333"><a href="#HebbianTzimtzumESN-333"><span class="linenos">333</span></a>        
</span><span id="HebbianTzimtzumESN-334"><a href="#HebbianTzimtzumESN-334"><span class="linenos">334</span></a>        <span class="c1"># Cuántas conexiones regenerar</span>
</span><span id="HebbianTzimtzumESN-335"><a href="#HebbianTzimtzumESN-335"><span class="linenos">335</span></a>        <span class="n">pruned</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">pruned_connections</span>
</span><span id="HebbianTzimtzumESN-336"><a href="#HebbianTzimtzumESN-336"><span class="linenos">336</span></a>        <span class="n">regrow_count</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">pruned</span> <span class="o">*</span> <span class="n">fraction</span><span class="p">)</span>
</span><span id="HebbianTzimtzumESN-337"><a href="#HebbianTzimtzumESN-337"><span class="linenos">337</span></a>        
</span><span id="HebbianTzimtzumESN-338"><a href="#HebbianTzimtzumESN-338"><span class="linenos">338</span></a>        <span class="k">if</span> <span class="n">regrow_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="HebbianTzimtzumESN-339"><a href="#HebbianTzimtzumESN-339"><span class="linenos">339</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="n">ContractionPhase</span><span class="o">.</span><span class="n">PLENITUD</span>
</span><span id="HebbianTzimtzumESN-340"><a href="#HebbianTzimtzumESN-340"><span class="linenos">340</span></a>            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;regrown_count&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</span><span id="HebbianTzimtzumESN-341"><a href="#HebbianTzimtzumESN-341"><span class="linenos">341</span></a>        
</span><span id="HebbianTzimtzumESN-342"><a href="#HebbianTzimtzumESN-342"><span class="linenos">342</span></a>        <span class="c1"># Posiciones vacías</span>
</span><span id="HebbianTzimtzumESN-343"><a href="#HebbianTzimtzumESN-343"><span class="linenos">343</span></a>        <span class="n">empty_mask</span> <span class="o">=</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">_connection_mask</span>
</span><span id="HebbianTzimtzumESN-344"><a href="#HebbianTzimtzumESN-344"><span class="linenos">344</span></a>        <span class="n">empty_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">empty_mask</span><span class="p">)</span>
</span><span id="HebbianTzimtzumESN-345"><a href="#HebbianTzimtzumESN-345"><span class="linenos">345</span></a>        
</span><span id="HebbianTzimtzumESN-346"><a href="#HebbianTzimtzumESN-346"><span class="linenos">346</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">empty_indices</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="HebbianTzimtzumESN-347"><a href="#HebbianTzimtzumESN-347"><span class="linenos">347</span></a>            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;regrown_count&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</span><span id="HebbianTzimtzumESN-348"><a href="#HebbianTzimtzumESN-348"><span class="linenos">348</span></a>        
</span><span id="HebbianTzimtzumESN-349"><a href="#HebbianTzimtzumESN-349"><span class="linenos">349</span></a>        <span class="n">regrow_count</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">regrow_count</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">empty_indices</span><span class="p">))</span>
</span><span id="HebbianTzimtzumESN-350"><a href="#HebbianTzimtzumESN-350"><span class="linenos">350</span></a>        <span class="n">selected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_regrowth_rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
</span><span id="HebbianTzimtzumESN-351"><a href="#HebbianTzimtzumESN-351"><span class="linenos">351</span></a>            <span class="nb">len</span><span class="p">(</span><span class="n">empty_indices</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="n">regrow_count</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span>
</span><span id="HebbianTzimtzumESN-352"><a href="#HebbianTzimtzumESN-352"><span class="linenos">352</span></a>        <span class="p">)</span>
</span><span id="HebbianTzimtzumESN-353"><a href="#HebbianTzimtzumESN-353"><span class="linenos">353</span></a>        
</span><span id="HebbianTzimtzumESN-354"><a href="#HebbianTzimtzumESN-354"><span class="linenos">354</span></a>        <span class="c1"># Crear nuevas conexiones débiles</span>
</span><span id="HebbianTzimtzumESN-355"><a href="#HebbianTzimtzumESN-355"><span class="linenos">355</span></a>        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">selected</span><span class="p">:</span>
</span><span id="HebbianTzimtzumESN-356"><a href="#HebbianTzimtzumESN-356"><span class="linenos">356</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">empty_indices</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
</span><span id="HebbianTzimtzumESN-357"><a href="#HebbianTzimtzumESN-357"><span class="linenos">357</span></a>            <span class="n">new_weight</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_regrowth_rng</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
</span><span id="HebbianTzimtzumESN-358"><a href="#HebbianTzimtzumESN-358"><span class="linenos">358</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_weight</span>
</span><span id="HebbianTzimtzumESN-359"><a href="#HebbianTzimtzumESN-359"><span class="linenos">359</span></a>        
</span><span id="HebbianTzimtzumESN-360"><a href="#HebbianTzimtzumESN-360"><span class="linenos">360</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_connection_mask</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="HebbianTzimtzumESN-361"><a href="#HebbianTzimtzumESN-361"><span class="linenos">361</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">regrown_connections</span> <span class="o">+=</span> <span class="n">regrow_count</span>
</span><span id="HebbianTzimtzumESN-362"><a href="#HebbianTzimtzumESN-362"><span class="linenos">362</span></a>        
</span><span id="HebbianTzimtzumESN-363"><a href="#HebbianTzimtzumESN-363"><span class="linenos">363</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_spectral_radius</span><span class="p">()</span>
</span><span id="HebbianTzimtzumESN-364"><a href="#HebbianTzimtzumESN-364"><span class="linenos">364</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_update_tzimtzum_metrics</span><span class="p">()</span>
</span><span id="HebbianTzimtzumESN-365"><a href="#HebbianTzimtzumESN-365"><span class="linenos">365</span></a>        
</span><span id="HebbianTzimtzumESN-366"><a href="#HebbianTzimtzumESN-366"><span class="linenos">366</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="n">ContractionPhase</span><span class="o">.</span><span class="n">PLENITUD</span>
</span><span id="HebbianTzimtzumESN-367"><a href="#HebbianTzimtzumESN-367"><span class="linenos">367</span></a>        
</span><span id="HebbianTzimtzumESN-368"><a href="#HebbianTzimtzumESN-368"><span class="linenos">368</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="HebbianTzimtzumESN-369"><a href="#HebbianTzimtzumESN-369"><span class="linenos">369</span></a>            <span class="s1">&#39;regrown_count&#39;</span><span class="p">:</span> <span class="n">regrow_count</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN-370"><a href="#HebbianTzimtzumESN-370"><span class="linenos">370</span></a>            <span class="s1">&#39;compression_ratio&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">compression_ratio</span>
</span><span id="HebbianTzimtzumESN-371"><a href="#HebbianTzimtzumESN-371"><span class="linenos">371</span></a>        <span class="p">}</span>
</span><span id="HebbianTzimtzumESN-372"><a href="#HebbianTzimtzumESN-372"><span class="linenos">372</span></a>    
</span><span id="HebbianTzimtzumESN-373"><a href="#HebbianTzimtzumESN-373"><span class="linenos">373</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">full_tzimtzum_cycle</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="HebbianTzimtzumESN-374"><a href="#HebbianTzimtzumESN-374"><span class="linenos">374</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Ejecuta ciclo completo: Dark Night + Renacimiento.&quot;&quot;&quot;</span>
</span><span id="HebbianTzimtzumESN-375"><a href="#HebbianTzimtzumESN-375"><span class="linenos">375</span></a>        <span class="n">dark</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dark_night</span><span class="p">()</span>
</span><span id="HebbianTzimtzumESN-376"><a href="#HebbianTzimtzumESN-376"><span class="linenos">376</span></a>        <span class="n">rebirth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">renacimiento</span><span class="p">()</span>
</span><span id="HebbianTzimtzumESN-377"><a href="#HebbianTzimtzumESN-377"><span class="linenos">377</span></a>        
</span><span id="HebbianTzimtzumESN-378"><a href="#HebbianTzimtzumESN-378"><span class="linenos">378</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="HebbianTzimtzumESN-379"><a href="#HebbianTzimtzumESN-379"><span class="linenos">379</span></a>            <span class="s1">&#39;dark_night&#39;</span><span class="p">:</span> <span class="n">dark</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN-380"><a href="#HebbianTzimtzumESN-380"><span class="linenos">380</span></a>            <span class="s1">&#39;renacimiento&#39;</span><span class="p">:</span> <span class="n">rebirth</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN-381"><a href="#HebbianTzimtzumESN-381"><span class="linenos">381</span></a>            <span class="s1">&#39;final_connections&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">total_connections</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN-382"><a href="#HebbianTzimtzumESN-382"><span class="linenos">382</span></a>            <span class="s1">&#39;total_cycles&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">pruning_cycles</span>
</span><span id="HebbianTzimtzumESN-383"><a href="#HebbianTzimtzumESN-383"><span class="linenos">383</span></a>        <span class="p">}</span>
</span><span id="HebbianTzimtzumESN-384"><a href="#HebbianTzimtzumESN-384"><span class="linenos">384</span></a>    
</span><span id="HebbianTzimtzumESN-385"><a href="#HebbianTzimtzumESN-385"><span class="linenos">385</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_combined_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="HebbianTzimtzumESN-386"><a href="#HebbianTzimtzumESN-386"><span class="linenos">386</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Estadísticas combinadas de Hebbian y Tzimtzum.&quot;&quot;&quot;</span>
</span><span id="HebbianTzimtzumESN-387"><a href="#HebbianTzimtzumESN-387"><span class="linenos">387</span></a>        <span class="n">hebbian_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_adaptation_stats</span><span class="p">()</span>
</span><span id="HebbianTzimtzumESN-388"><a href="#HebbianTzimtzumESN-388"><span class="linenos">388</span></a>        
</span><span id="HebbianTzimtzumESN-389"><a href="#HebbianTzimtzumESN-389"><span class="linenos">389</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="HebbianTzimtzumESN-390"><a href="#HebbianTzimtzumESN-390"><span class="linenos">390</span></a>            <span class="s1">&#39;hebbian&#39;</span><span class="p">:</span> <span class="n">hebbian_stats</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN-391"><a href="#HebbianTzimtzumESN-391"><span class="linenos">391</span></a>            <span class="s1">&#39;tzimtzum&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
</span><span id="HebbianTzimtzumESN-392"><a href="#HebbianTzimtzumESN-392"><span class="linenos">392</span></a>            <span class="s1">&#39;combined&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="HebbianTzimtzumESN-393"><a href="#HebbianTzimtzumESN-393"><span class="linenos">393</span></a>                <span class="s1">&#39;total_connections&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">total_connections</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN-394"><a href="#HebbianTzimtzumESN-394"><span class="linenos">394</span></a>                <span class="s1">&#39;adaptation_steps&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_adaptation_count</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN-395"><a href="#HebbianTzimtzumESN-395"><span class="linenos">395</span></a>                <span class="s1">&#39;pruning_cycles&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">pruning_cycles</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN-396"><a href="#HebbianTzimtzumESN-396"><span class="linenos">396</span></a>                <span class="s1">&#39;compression_ratio&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">compression_ratio</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN-397"><a href="#HebbianTzimtzumESN-397"><span class="linenos">397</span></a>                <span class="s1">&#39;mean_hebbian_contribution&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hebbian_contribution</span><span class="p">))</span>
</span><span id="HebbianTzimtzumESN-398"><a href="#HebbianTzimtzumESN-398"><span class="linenos">398</span></a>            <span class="p">}</span>
</span><span id="HebbianTzimtzumESN-399"><a href="#HebbianTzimtzumESN-399"><span class="linenos">399</span></a>        <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Echo State Network con Plasticidad Hebbiana y Protocolo Tzimtzum.</p>

<p>Combina dos paradigmas de aprendizaje complementarios:</p>

<ol>
<li><p>PLASTICIDAD HEBBIANA (continua):</p>

<ul>
<li>Fortalece conexiones entre neuronas co-activas</li>
<li>Opera en cada paso de tiempo</li>
<li>"Células que disparan juntas, permanecen juntas"</li>
</ul></li>
<li><p>PROTOCOLO TZIMTZUM (cíclico):</p>

<ul>
<li>Elimina periódicamente conexiones débiles</li>
<li>Crea "vacío" para nuevo aprendizaje</li>
<li>"Para aprender algo nuevo, primero debo olvidar"</li>
</ul></li>
</ol>

<p>FILOSOFÍA:
──────────
La vida neuronal es un balance entre:</p>

<ul>
<li>Crecimiento (Hebbian): Acumular conocimiento</li>
<li>Poda (Tzimtzum): Liberar lo obsoleto</li>
</ul>

<p>Sin poda, la red se satura.
Sin crecimiento, la red muere.</p>

<p>El HebbianTzimtzumESN implementa este ciclo vital.</p>

<p>Ejemplo:</p>

<blockquote>
  <blockquote>
    <blockquote>
      <p>esn = HebbianTzimtzumESN(
          ...     input_size=3,
          ...     reservoir_size=100,
          ...     plasticity_type='hebbian',
          ...     tzimtzum_config=TzimtzumConfig(pruning_fraction=0.5)
          ... )</p>
      
      <h1 id="entrenar-con-adaptacion-online">Entrenar con adaptación online</h1>
      
      <p>esn.adapt_online(X_train)</p>
      
      <h1 id="ejecutar-dark-night">Ejecutar Dark Night</h1>
      
      <p>esn.dark_night()</p>
      
      <h1 id="continuar-adaptacion">Continuar adaptación</h1>
      
      <p>esn.adapt_online(X_new)</p>
    </blockquote>
  </blockquote>
</blockquote>
</div>


                            <div id="HebbianTzimtzumESN.__init__" class="classattr">
                                        <input id="HebbianTzimtzumESN.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">HebbianTzimtzumESN</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">n_inputs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">n_reservoir</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span>,</span><span class="param">	<span class="n">n_outputs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">spectral_radius</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.9</span>,</span><span class="param">	<span class="n">sparsity</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.9</span>,</span><span class="param">	<span class="n">noise</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.001</span>,</span><span class="param">	<span class="n">learning_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.001</span>,</span><span class="param">	<span class="n">plasticity_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;hebbian&#39;</span>,</span><span class="param">	<span class="n">tzimtzum_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n"><a href="#TzimtzumConfig">TzimtzumConfig</a></span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">random_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="HebbianTzimtzumESN.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HebbianTzimtzumESN.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HebbianTzimtzumESN.__init__-80"><a href="#HebbianTzimtzumESN.__init__-80"><span class="linenos"> 80</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="HebbianTzimtzumESN.__init__-81"><a href="#HebbianTzimtzumESN.__init__-81"><span class="linenos"> 81</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN.__init__-82"><a href="#HebbianTzimtzumESN.__init__-82"><span class="linenos"> 82</span></a>        <span class="n">n_inputs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN.__init__-83"><a href="#HebbianTzimtzumESN.__init__-83"><span class="linenos"> 83</span></a>        <span class="n">n_reservoir</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN.__init__-84"><a href="#HebbianTzimtzumESN.__init__-84"><span class="linenos"> 84</span></a>        <span class="n">n_outputs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN.__init__-85"><a href="#HebbianTzimtzumESN.__init__-85"><span class="linenos"> 85</span></a>        <span class="n">spectral_radius</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN.__init__-86"><a href="#HebbianTzimtzumESN.__init__-86"><span class="linenos"> 86</span></a>        <span class="n">sparsity</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN.__init__-87"><a href="#HebbianTzimtzumESN.__init__-87"><span class="linenos"> 87</span></a>        <span class="n">noise</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN.__init__-88"><a href="#HebbianTzimtzumESN.__init__-88"><span class="linenos"> 88</span></a>        <span class="n">learning_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN.__init__-89"><a href="#HebbianTzimtzumESN.__init__-89"><span class="linenos"> 89</span></a>        <span class="n">plasticity_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;hebbian&#39;</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN.__init__-90"><a href="#HebbianTzimtzumESN.__init__-90"><span class="linenos"> 90</span></a>        <span class="n">tzimtzum_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TzimtzumConfig</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN.__init__-91"><a href="#HebbianTzimtzumESN.__init__-91"><span class="linenos"> 91</span></a>        <span class="n">random_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="HebbianTzimtzumESN.__init__-92"><a href="#HebbianTzimtzumESN.__init__-92"><span class="linenos"> 92</span></a>    <span class="p">):</span>
</span><span id="HebbianTzimtzumESN.__init__-93"><a href="#HebbianTzimtzumESN.__init__-93"><span class="linenos"> 93</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HebbianTzimtzumESN.__init__-94"><a href="#HebbianTzimtzumESN.__init__-94"><span class="linenos"> 94</span></a><span class="sd">        Inicializa HebbianTzimtzumESN.</span>
</span><span id="HebbianTzimtzumESN.__init__-95"><a href="#HebbianTzimtzumESN.__init__-95"><span class="linenos"> 95</span></a><span class="sd">        </span>
</span><span id="HebbianTzimtzumESN.__init__-96"><a href="#HebbianTzimtzumESN.__init__-96"><span class="linenos"> 96</span></a><span class="sd">        Args:</span>
</span><span id="HebbianTzimtzumESN.__init__-97"><a href="#HebbianTzimtzumESN.__init__-97"><span class="linenos"> 97</span></a><span class="sd">            n_inputs: Dimensión de entrada</span>
</span><span id="HebbianTzimtzumESN.__init__-98"><a href="#HebbianTzimtzumESN.__init__-98"><span class="linenos"> 98</span></a><span class="sd">            n_reservoir: Número de neuronas</span>
</span><span id="HebbianTzimtzumESN.__init__-99"><a href="#HebbianTzimtzumESN.__init__-99"><span class="linenos"> 99</span></a><span class="sd">            n_outputs: Dimensión de salida</span>
</span><span id="HebbianTzimtzumESN.__init__-100"><a href="#HebbianTzimtzumESN.__init__-100"><span class="linenos">100</span></a><span class="sd">            spectral_radius: Radio espectral</span>
</span><span id="HebbianTzimtzumESN.__init__-101"><a href="#HebbianTzimtzumESN.__init__-101"><span class="linenos">101</span></a><span class="sd">            sparsity: Sparsity inicial</span>
</span><span id="HebbianTzimtzumESN.__init__-102"><a href="#HebbianTzimtzumESN.__init__-102"><span class="linenos">102</span></a><span class="sd">            noise: Ruido de regularización</span>
</span><span id="HebbianTzimtzumESN.__init__-103"><a href="#HebbianTzimtzumESN.__init__-103"><span class="linenos">103</span></a><span class="sd">            learning_rate: Tasa de aprendizaje Hebbiano</span>
</span><span id="HebbianTzimtzumESN.__init__-104"><a href="#HebbianTzimtzumESN.__init__-104"><span class="linenos">104</span></a><span class="sd">            plasticity_type: &#39;hebbian&#39;, &#39;stdp&#39;, o &#39;anti_hebbian&#39;</span>
</span><span id="HebbianTzimtzumESN.__init__-105"><a href="#HebbianTzimtzumESN.__init__-105"><span class="linenos">105</span></a><span class="sd">            tzimtzum_config: Configuración del protocolo Tzimtzum</span>
</span><span id="HebbianTzimtzumESN.__init__-106"><a href="#HebbianTzimtzumESN.__init__-106"><span class="linenos">106</span></a><span class="sd">            random_state: Semilla aleatoria</span>
</span><span id="HebbianTzimtzumESN.__init__-107"><a href="#HebbianTzimtzumESN.__init__-107"><span class="linenos">107</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HebbianTzimtzumESN.__init__-108"><a href="#HebbianTzimtzumESN.__init__-108"><span class="linenos">108</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="HebbianTzimtzumESN.__init__-109"><a href="#HebbianTzimtzumESN.__init__-109"><span class="linenos">109</span></a>            <span class="n">n_inputs</span><span class="o">=</span><span class="n">n_inputs</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN.__init__-110"><a href="#HebbianTzimtzumESN.__init__-110"><span class="linenos">110</span></a>            <span class="n">n_reservoir</span><span class="o">=</span><span class="n">n_reservoir</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN.__init__-111"><a href="#HebbianTzimtzumESN.__init__-111"><span class="linenos">111</span></a>            <span class="n">n_outputs</span><span class="o">=</span><span class="n">n_outputs</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN.__init__-112"><a href="#HebbianTzimtzumESN.__init__-112"><span class="linenos">112</span></a>            <span class="n">spectral_radius</span><span class="o">=</span><span class="n">spectral_radius</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN.__init__-113"><a href="#HebbianTzimtzumESN.__init__-113"><span class="linenos">113</span></a>            <span class="n">sparsity</span><span class="o">=</span><span class="n">sparsity</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN.__init__-114"><a href="#HebbianTzimtzumESN.__init__-114"><span class="linenos">114</span></a>            <span class="n">noise</span><span class="o">=</span><span class="n">noise</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN.__init__-115"><a href="#HebbianTzimtzumESN.__init__-115"><span class="linenos">115</span></a>            <span class="n">learning_rate</span><span class="o">=</span><span class="n">learning_rate</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN.__init__-116"><a href="#HebbianTzimtzumESN.__init__-116"><span class="linenos">116</span></a>            <span class="n">plasticity_type</span><span class="o">=</span><span class="n">plasticity_type</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN.__init__-117"><a href="#HebbianTzimtzumESN.__init__-117"><span class="linenos">117</span></a>            <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span>
</span><span id="HebbianTzimtzumESN.__init__-118"><a href="#HebbianTzimtzumESN.__init__-118"><span class="linenos">118</span></a>        <span class="p">)</span>
</span><span id="HebbianTzimtzumESN.__init__-119"><a href="#HebbianTzimtzumESN.__init__-119"><span class="linenos">119</span></a>        
</span><span id="HebbianTzimtzumESN.__init__-120"><a href="#HebbianTzimtzumESN.__init__-120"><span class="linenos">120</span></a>        <span class="c1"># Configuración Tzimtzum</span>
</span><span id="HebbianTzimtzumESN.__init__-121"><a href="#HebbianTzimtzumESN.__init__-121"><span class="linenos">121</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_config</span> <span class="o">=</span> <span class="n">tzimtzum_config</span> <span class="ow">or</span> <span class="n">TzimtzumConfig</span><span class="p">()</span>
</span><span id="HebbianTzimtzumESN.__init__-122"><a href="#HebbianTzimtzumESN.__init__-122"><span class="linenos">122</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span> <span class="o">=</span> <span class="n">TzimtzumState</span><span class="p">()</span>
</span><span id="HebbianTzimtzumESN.__init__-123"><a href="#HebbianTzimtzumESN.__init__-123"><span class="linenos">123</span></a>        
</span><span id="HebbianTzimtzumESN.__init__-124"><a href="#HebbianTzimtzumESN.__init__-124"><span class="linenos">124</span></a>        <span class="c1"># RNG para regrowth</span>
</span><span id="HebbianTzimtzumESN.__init__-125"><a href="#HebbianTzimtzumESN.__init__-125"><span class="linenos">125</span></a>        <span class="n">regrowth_seed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_config</span><span class="o">.</span><span class="n">regrowth_seed</span> <span class="ow">or</span> <span class="n">random_state</span>
</span><span id="HebbianTzimtzumESN.__init__-126"><a href="#HebbianTzimtzumESN.__init__-126"><span class="linenos">126</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_regrowth_rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">regrowth_seed</span><span class="p">)</span>
</span><span id="HebbianTzimtzumESN.__init__-127"><a href="#HebbianTzimtzumESN.__init__-127"><span class="linenos">127</span></a>        
</span><span id="HebbianTzimtzumESN.__init__-128"><a href="#HebbianTzimtzumESN.__init__-128"><span class="linenos">128</span></a>        <span class="c1"># Tracking de conexiones</span>
</span><span id="HebbianTzimtzumESN.__init__-129"><a href="#HebbianTzimtzumESN.__init__-129"><span class="linenos">129</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_connection_mask</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="HebbianTzimtzumESN.__init__-130"><a href="#HebbianTzimtzumESN.__init__-130"><span class="linenos">130</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_connection_importance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span><span class="p">)</span>
</span><span id="HebbianTzimtzumESN.__init__-131"><a href="#HebbianTzimtzumESN.__init__-131"><span class="linenos">131</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_hebbian_contribution</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span><span class="p">)</span>
</span><span id="HebbianTzimtzumESN.__init__-132"><a href="#HebbianTzimtzumESN.__init__-132"><span class="linenos">132</span></a>        
</span><span id="HebbianTzimtzumESN.__init__-133"><a href="#HebbianTzimtzumESN.__init__-133"><span class="linenos">133</span></a>        <span class="c1"># Historial</span>
</span><span id="HebbianTzimtzumESN.__init__-134"><a href="#HebbianTzimtzumESN.__init__-134"><span class="linenos">134</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pruning_history</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="HebbianTzimtzumESN.__init__-135"><a href="#HebbianTzimtzumESN.__init__-135"><span class="linenos">135</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_step_count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="HebbianTzimtzumESN.__init__-136"><a href="#HebbianTzimtzumESN.__init__-136"><span class="linenos">136</span></a>        
</span><span id="HebbianTzimtzumESN.__init__-137"><a href="#HebbianTzimtzumESN.__init__-137"><span class="linenos">137</span></a>        <span class="c1"># Inicializar métricas</span>
</span><span id="HebbianTzimtzumESN.__init__-138"><a href="#HebbianTzimtzumESN.__init__-138"><span class="linenos">138</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_update_tzimtzum_metrics</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Inicializa HebbianTzimtzumESN.</p>

<p>Args:
    n_inputs: Dimensión de entrada
    n_reservoir: Número de neuronas
    n_outputs: Dimensión de salida
    spectral_radius: Radio espectral
    sparsity: Sparsity inicial
    noise: Ruido de regularización
    learning_rate: Tasa de aprendizaje Hebbiano
    plasticity_type: 'hebbian', 'stdp', o 'anti_hebbian'
    tzimtzum_config: Configuración del protocolo Tzimtzum
    random_state: Semilla aleatoria</p>
</div>


                            </div>
                            <div id="HebbianTzimtzumESN.tzimtzum_config" class="classattr">
                                <div class="attr variable">
            <span class="name">tzimtzum_config</span>

        
    </div>
    <a class="headerlink" href="#HebbianTzimtzumESN.tzimtzum_config"></a>
    
    

                            </div>
                            <div id="HebbianTzimtzumESN.tzimtzum_state" class="classattr">
                                <div class="attr variable">
            <span class="name">tzimtzum_state</span>

        
    </div>
    <a class="headerlink" href="#HebbianTzimtzumESN.tzimtzum_state"></a>
    
    

                            </div>
                            <div id="HebbianTzimtzumESN.dark_night" class="classattr">
                                        <input id="HebbianTzimtzumESN.dark_night-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">dark_night</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">fraction</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">Dict</span>:</span></span>

                <label class="view-source-button" for="HebbianTzimtzumESN.dark_night-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HebbianTzimtzumESN.dark_night"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HebbianTzimtzumESN.dark_night-219"><a href="#HebbianTzimtzumESN.dark_night-219"><span class="linenos">219</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">dark_night</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fraction</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="HebbianTzimtzumESN.dark_night-220"><a href="#HebbianTzimtzumESN.dark_night-220"><span class="linenos">220</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HebbianTzimtzumESN.dark_night-221"><a href="#HebbianTzimtzumESN.dark_night-221"><span class="linenos">221</span></a><span class="sd">        Ejecuta Dark Night con criterio Hebbiano.</span>
</span><span id="HebbianTzimtzumESN.dark_night-222"><a href="#HebbianTzimtzumESN.dark_night-222"><span class="linenos">222</span></a><span class="sd">        </span>
</span><span id="HebbianTzimtzumESN.dark_night-223"><a href="#HebbianTzimtzumESN.dark_night-223"><span class="linenos">223</span></a><span class="sd">        Las conexiones que han sido activamente reforzadas por</span>
</span><span id="HebbianTzimtzumESN.dark_night-224"><a href="#HebbianTzimtzumESN.dark_night-224"><span class="linenos">224</span></a><span class="sd">        plasticidad Hebbiana tienen mayor probabilidad de sobrevivir.</span>
</span><span id="HebbianTzimtzumESN.dark_night-225"><a href="#HebbianTzimtzumESN.dark_night-225"><span class="linenos">225</span></a><span class="sd">        </span>
</span><span id="HebbianTzimtzumESN.dark_night-226"><a href="#HebbianTzimtzumESN.dark_night-226"><span class="linenos">226</span></a><span class="sd">        Args:</span>
</span><span id="HebbianTzimtzumESN.dark_night-227"><a href="#HebbianTzimtzumESN.dark_night-227"><span class="linenos">227</span></a><span class="sd">            fraction: Fracción de conexiones a podar</span>
</span><span id="HebbianTzimtzumESN.dark_night-228"><a href="#HebbianTzimtzumESN.dark_night-228"><span class="linenos">228</span></a><span class="sd">            </span>
</span><span id="HebbianTzimtzumESN.dark_night-229"><a href="#HebbianTzimtzumESN.dark_night-229"><span class="linenos">229</span></a><span class="sd">        Returns:</span>
</span><span id="HebbianTzimtzumESN.dark_night-230"><a href="#HebbianTzimtzumESN.dark_night-230"><span class="linenos">230</span></a><span class="sd">            Estadísticas de poda</span>
</span><span id="HebbianTzimtzumESN.dark_night-231"><a href="#HebbianTzimtzumESN.dark_night-231"><span class="linenos">231</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HebbianTzimtzumESN.dark_night-232"><a href="#HebbianTzimtzumESN.dark_night-232"><span class="linenos">232</span></a>        <span class="n">fraction</span> <span class="o">=</span> <span class="n">fraction</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_config</span><span class="o">.</span><span class="n">pruning_fraction</span>
</span><span id="HebbianTzimtzumESN.dark_night-233"><a href="#HebbianTzimtzumESN.dark_night-233"><span class="linenos">233</span></a>        
</span><span id="HebbianTzimtzumESN.dark_night-234"><a href="#HebbianTzimtzumESN.dark_night-234"><span class="linenos">234</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="n">ContractionPhase</span><span class="o">.</span><span class="n">DARK_NIGHT</span>
</span><span id="HebbianTzimtzumESN.dark_night-235"><a href="#HebbianTzimtzumESN.dark_night-235"><span class="linenos">235</span></a>        
</span><span id="HebbianTzimtzumESN.dark_night-236"><a href="#HebbianTzimtzumESN.dark_night-236"><span class="linenos">236</span></a>        <span class="c1"># Importancia combinada</span>
</span><span id="HebbianTzimtzumESN.dark_night-237"><a href="#HebbianTzimtzumESN.dark_night-237"><span class="linenos">237</span></a>        <span class="n">importance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_importance</span><span class="p">()</span>
</span><span id="HebbianTzimtzumESN.dark_night-238"><a href="#HebbianTzimtzumESN.dark_night-238"><span class="linenos">238</span></a>        
</span><span id="HebbianTzimtzumESN.dark_night-239"><a href="#HebbianTzimtzumESN.dark_night-239"><span class="linenos">239</span></a>        <span class="c1"># Solo conexiones activas</span>
</span><span id="HebbianTzimtzumESN.dark_night-240"><a href="#HebbianTzimtzumESN.dark_night-240"><span class="linenos">240</span></a>        <span class="n">active_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection_mask</span>
</span><span id="HebbianTzimtzumESN.dark_night-241"><a href="#HebbianTzimtzumESN.dark_night-241"><span class="linenos">241</span></a>        <span class="n">active_importance</span> <span class="o">=</span> <span class="n">importance</span><span class="p">[</span><span class="n">active_mask</span><span class="p">]</span>
</span><span id="HebbianTzimtzumESN.dark_night-242"><a href="#HebbianTzimtzumESN.dark_night-242"><span class="linenos">242</span></a>        
</span><span id="HebbianTzimtzumESN.dark_night-243"><a href="#HebbianTzimtzumESN.dark_night-243"><span class="linenos">243</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">active_importance</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="HebbianTzimtzumESN.dark_night-244"><a href="#HebbianTzimtzumESN.dark_night-244"><span class="linenos">244</span></a>            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;pruned_count&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;No hay conexiones activas&#39;</span><span class="p">}</span>
</span><span id="HebbianTzimtzumESN.dark_night-245"><a href="#HebbianTzimtzumESN.dark_night-245"><span class="linenos">245</span></a>        
</span><span id="HebbianTzimtzumESN.dark_night-246"><a href="#HebbianTzimtzumESN.dark_night-246"><span class="linenos">246</span></a>        <span class="c1"># Calcular umbral</span>
</span><span id="HebbianTzimtzumESN.dark_night-247"><a href="#HebbianTzimtzumESN.dark_night-247"><span class="linenos">247</span></a>        <span class="n">threshold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">active_importance</span><span class="p">,</span> <span class="n">fraction</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
</span><span id="HebbianTzimtzumESN.dark_night-248"><a href="#HebbianTzimtzumESN.dark_night-248"><span class="linenos">248</span></a>        
</span><span id="HebbianTzimtzumESN.dark_night-249"><a href="#HebbianTzimtzumESN.dark_night-249"><span class="linenos">249</span></a>        <span class="c1"># Mínimo de conexiones</span>
</span><span id="HebbianTzimtzumESN.dark_night-250"><a href="#HebbianTzimtzumESN.dark_night-250"><span class="linenos">250</span></a>        <span class="n">min_connections</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
</span><span id="HebbianTzimtzumESN.dark_night-251"><a href="#HebbianTzimtzumESN.dark_night-251"><span class="linenos">251</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_reservoir</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_config</span><span class="o">.</span><span class="n">min_connections_fraction</span>
</span><span id="HebbianTzimtzumESN.dark_night-252"><a href="#HebbianTzimtzumESN.dark_night-252"><span class="linenos">252</span></a>        <span class="p">)</span>
</span><span id="HebbianTzimtzumESN.dark_night-253"><a href="#HebbianTzimtzumESN.dark_night-253"><span class="linenos">253</span></a>        <span class="n">current_connections</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">active_mask</span><span class="p">)</span>
</span><span id="HebbianTzimtzumESN.dark_night-254"><a href="#HebbianTzimtzumESN.dark_night-254"><span class="linenos">254</span></a>        <span class="n">max_to_prune</span> <span class="o">=</span> <span class="n">current_connections</span> <span class="o">-</span> <span class="n">min_connections</span>
</span><span id="HebbianTzimtzumESN.dark_night-255"><a href="#HebbianTzimtzumESN.dark_night-255"><span class="linenos">255</span></a>        
</span><span id="HebbianTzimtzumESN.dark_night-256"><a href="#HebbianTzimtzumESN.dark_night-256"><span class="linenos">256</span></a>        <span class="k">if</span> <span class="n">max_to_prune</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="HebbianTzimtzumESN.dark_night-257"><a href="#HebbianTzimtzumESN.dark_night-257"><span class="linenos">257</span></a>            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;pruned_count&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;Ya en mínimo de conexiones&#39;</span><span class="p">}</span>
</span><span id="HebbianTzimtzumESN.dark_night-258"><a href="#HebbianTzimtzumESN.dark_night-258"><span class="linenos">258</span></a>        
</span><span id="HebbianTzimtzumESN.dark_night-259"><a href="#HebbianTzimtzumESN.dark_night-259"><span class="linenos">259</span></a>        <span class="c1"># Máscara de supervivencia</span>
</span><span id="HebbianTzimtzumESN.dark_night-260"><a href="#HebbianTzimtzumESN.dark_night-260"><span class="linenos">260</span></a>        <span class="n">survival_mask</span> <span class="o">=</span> <span class="n">importance</span> <span class="o">&gt;=</span> <span class="n">threshold</span>
</span><span id="HebbianTzimtzumESN.dark_night-261"><a href="#HebbianTzimtzumESN.dark_night-261"><span class="linenos">261</span></a>        
</span><span id="HebbianTzimtzumESN.dark_night-262"><a href="#HebbianTzimtzumESN.dark_night-262"><span class="linenos">262</span></a>        <span class="c1"># Preservar topología</span>
</span><span id="HebbianTzimtzumESN.dark_night-263"><a href="#HebbianTzimtzumESN.dark_night-263"><span class="linenos">263</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_config</span><span class="o">.</span><span class="n">preserve_topology</span><span class="p">:</span>
</span><span id="HebbianTzimtzumESN.dark_night-264"><a href="#HebbianTzimtzumESN.dark_night-264"><span class="linenos">264</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_reservoir</span><span class="p">):</span>
</span><span id="HebbianTzimtzumESN.dark_night-265"><a href="#HebbianTzimtzumESN.dark_night-265"><span class="linenos">265</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">survival_mask</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]):</span>
</span><span id="HebbianTzimtzumESN.dark_night-266"><a href="#HebbianTzimtzumESN.dark_night-266"><span class="linenos">266</span></a>                    <span class="n">best_in</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]))</span>
</span><span id="HebbianTzimtzumESN.dark_night-267"><a href="#HebbianTzimtzumESN.dark_night-267"><span class="linenos">267</span></a>                    <span class="n">survival_mask</span><span class="p">[</span><span class="n">best_in</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="HebbianTzimtzumESN.dark_night-268"><a href="#HebbianTzimtzumESN.dark_night-268"><span class="linenos">268</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">survival_mask</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]):</span>
</span><span id="HebbianTzimtzumESN.dark_night-269"><a href="#HebbianTzimtzumESN.dark_night-269"><span class="linenos">269</span></a>                    <span class="n">best_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]))</span>
</span><span id="HebbianTzimtzumESN.dark_night-270"><a href="#HebbianTzimtzumESN.dark_night-270"><span class="linenos">270</span></a>                    <span class="n">survival_mask</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">best_out</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="HebbianTzimtzumESN.dark_night-271"><a href="#HebbianTzimtzumESN.dark_night-271"><span class="linenos">271</span></a>        
</span><span id="HebbianTzimtzumESN.dark_night-272"><a href="#HebbianTzimtzumESN.dark_night-272"><span class="linenos">272</span></a>        <span class="c1"># Ejecutar poda</span>
</span><span id="HebbianTzimtzumESN.dark_night-273"><a href="#HebbianTzimtzumESN.dark_night-273"><span class="linenos">273</span></a>        <span class="n">pre_count</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="HebbianTzimtzumESN.dark_night-274"><a href="#HebbianTzimtzumESN.dark_night-274"><span class="linenos">274</span></a>        
</span><span id="HebbianTzimtzumESN.dark_night-275"><a href="#HebbianTzimtzumESN.dark_night-275"><span class="linenos">275</span></a>        <span class="n">prune_mask</span> <span class="o">=</span> <span class="o">~</span><span class="n">survival_mask</span> <span class="o">&amp;</span> <span class="n">active_mask</span>
</span><span id="HebbianTzimtzumESN.dark_night-276"><a href="#HebbianTzimtzumESN.dark_night-276"><span class="linenos">276</span></a>        <span class="n">pruned_count</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">prune_mask</span><span class="p">)),</span> <span class="n">max_to_prune</span><span class="p">)</span>
</span><span id="HebbianTzimtzumESN.dark_night-277"><a href="#HebbianTzimtzumESN.dark_night-277"><span class="linenos">277</span></a>        
</span><span id="HebbianTzimtzumESN.dark_night-278"><a href="#HebbianTzimtzumESN.dark_night-278"><span class="linenos">278</span></a>        <span class="c1"># Si hay más que max_to_prune, podar solo las menos importantes</span>
</span><span id="HebbianTzimtzumESN.dark_night-279"><a href="#HebbianTzimtzumESN.dark_night-279"><span class="linenos">279</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">prune_mask</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_to_prune</span><span class="p">:</span>
</span><span id="HebbianTzimtzumESN.dark_night-280"><a href="#HebbianTzimtzumESN.dark_night-280"><span class="linenos">280</span></a>            <span class="n">prune_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">prune_mask</span><span class="p">)</span>
</span><span id="HebbianTzimtzumESN.dark_night-281"><a href="#HebbianTzimtzumESN.dark_night-281"><span class="linenos">281</span></a>            <span class="n">prune_importance</span> <span class="o">=</span> <span class="n">importance</span><span class="p">[</span><span class="n">prune_mask</span><span class="p">]</span>
</span><span id="HebbianTzimtzumESN.dark_night-282"><a href="#HebbianTzimtzumESN.dark_night-282"><span class="linenos">282</span></a>            <span class="n">sorted_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">prune_importance</span><span class="p">)[:</span><span class="n">max_to_prune</span><span class="p">]</span>
</span><span id="HebbianTzimtzumESN.dark_night-283"><a href="#HebbianTzimtzumESN.dark_night-283"><span class="linenos">283</span></a>            
</span><span id="HebbianTzimtzumESN.dark_night-284"><a href="#HebbianTzimtzumESN.dark_night-284"><span class="linenos">284</span></a>            <span class="n">prune_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">prune_mask</span><span class="p">)</span>
</span><span id="HebbianTzimtzumESN.dark_night-285"><a href="#HebbianTzimtzumESN.dark_night-285"><span class="linenos">285</span></a>            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">sorted_idx</span><span class="p">:</span>
</span><span id="HebbianTzimtzumESN.dark_night-286"><a href="#HebbianTzimtzumESN.dark_night-286"><span class="linenos">286</span></a>                <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">prune_indices</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
</span><span id="HebbianTzimtzumESN.dark_night-287"><a href="#HebbianTzimtzumESN.dark_night-287"><span class="linenos">287</span></a>                <span class="n">prune_mask</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="HebbianTzimtzumESN.dark_night-288"><a href="#HebbianTzimtzumESN.dark_night-288"><span class="linenos">288</span></a>        
</span><span id="HebbianTzimtzumESN.dark_night-289"><a href="#HebbianTzimtzumESN.dark_night-289"><span class="linenos">289</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span><span class="p">[</span><span class="n">prune_mask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="HebbianTzimtzumESN.dark_night-290"><a href="#HebbianTzimtzumESN.dark_night-290"><span class="linenos">290</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_connection_mask</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="HebbianTzimtzumESN.dark_night-291"><a href="#HebbianTzimtzumESN.dark_night-291"><span class="linenos">291</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_hebbian_contribution</span><span class="p">[</span><span class="n">prune_mask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="HebbianTzimtzumESN.dark_night-292"><a href="#HebbianTzimtzumESN.dark_night-292"><span class="linenos">292</span></a>        
</span><span id="HebbianTzimtzumESN.dark_night-293"><a href="#HebbianTzimtzumESN.dark_night-293"><span class="linenos">293</span></a>        <span class="c1"># Renormalizar</span>
</span><span id="HebbianTzimtzumESN.dark_night-294"><a href="#HebbianTzimtzumESN.dark_night-294"><span class="linenos">294</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_spectral_radius</span><span class="p">()</span>
</span><span id="HebbianTzimtzumESN.dark_night-295"><a href="#HebbianTzimtzumESN.dark_night-295"><span class="linenos">295</span></a>        
</span><span id="HebbianTzimtzumESN.dark_night-296"><a href="#HebbianTzimtzumESN.dark_night-296"><span class="linenos">296</span></a>        <span class="n">post_count</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="HebbianTzimtzumESN.dark_night-297"><a href="#HebbianTzimtzumESN.dark_night-297"><span class="linenos">297</span></a>        <span class="n">memory_saved</span> <span class="o">=</span> <span class="p">(</span><span class="n">pre_count</span> <span class="o">-</span> <span class="n">post_count</span><span class="p">)</span> <span class="o">*</span> <span class="mi">8</span>
</span><span id="HebbianTzimtzumESN.dark_night-298"><a href="#HebbianTzimtzumESN.dark_night-298"><span class="linenos">298</span></a>        
</span><span id="HebbianTzimtzumESN.dark_night-299"><a href="#HebbianTzimtzumESN.dark_night-299"><span class="linenos">299</span></a>        <span class="c1"># Actualizar estado</span>
</span><span id="HebbianTzimtzumESN.dark_night-300"><a href="#HebbianTzimtzumESN.dark_night-300"><span class="linenos">300</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">pruned_connections</span> <span class="o">+=</span> <span class="n">pruned_count</span>
</span><span id="HebbianTzimtzumESN.dark_night-301"><a href="#HebbianTzimtzumESN.dark_night-301"><span class="linenos">301</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">pruning_cycles</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="HebbianTzimtzumESN.dark_night-302"><a href="#HebbianTzimtzumESN.dark_night-302"><span class="linenos">302</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">memory_saved_bytes</span> <span class="o">+=</span> <span class="n">memory_saved</span>
</span><span id="HebbianTzimtzumESN.dark_night-303"><a href="#HebbianTzimtzumESN.dark_night-303"><span class="linenos">303</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="n">ContractionPhase</span><span class="o">.</span><span class="n">CHALLAL</span>
</span><span id="HebbianTzimtzumESN.dark_night-304"><a href="#HebbianTzimtzumESN.dark_night-304"><span class="linenos">304</span></a>        
</span><span id="HebbianTzimtzumESN.dark_night-305"><a href="#HebbianTzimtzumESN.dark_night-305"><span class="linenos">305</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_update_tzimtzum_metrics</span><span class="p">()</span>
</span><span id="HebbianTzimtzumESN.dark_night-306"><a href="#HebbianTzimtzumESN.dark_night-306"><span class="linenos">306</span></a>        
</span><span id="HebbianTzimtzumESN.dark_night-307"><a href="#HebbianTzimtzumESN.dark_night-307"><span class="linenos">307</span></a>        <span class="n">stats</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="HebbianTzimtzumESN.dark_night-308"><a href="#HebbianTzimtzumESN.dark_night-308"><span class="linenos">308</span></a>            <span class="s1">&#39;cycle&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">pruning_cycles</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN.dark_night-309"><a href="#HebbianTzimtzumESN.dark_night-309"><span class="linenos">309</span></a>            <span class="s1">&#39;pruned_count&#39;</span><span class="p">:</span> <span class="n">pruned_count</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN.dark_night-310"><a href="#HebbianTzimtzumESN.dark_night-310"><span class="linenos">310</span></a>            <span class="s1">&#39;pre_connections&#39;</span><span class="p">:</span> <span class="n">pre_count</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN.dark_night-311"><a href="#HebbianTzimtzumESN.dark_night-311"><span class="linenos">311</span></a>            <span class="s1">&#39;post_connections&#39;</span><span class="p">:</span> <span class="n">post_count</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN.dark_night-312"><a href="#HebbianTzimtzumESN.dark_night-312"><span class="linenos">312</span></a>            <span class="s1">&#39;memory_saved_bytes&#39;</span><span class="p">:</span> <span class="n">memory_saved</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN.dark_night-313"><a href="#HebbianTzimtzumESN.dark_night-313"><span class="linenos">313</span></a>            <span class="s1">&#39;compression_ratio&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">compression_ratio</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN.dark_night-314"><a href="#HebbianTzimtzumESN.dark_night-314"><span class="linenos">314</span></a>            <span class="s1">&#39;hebbian_contribution_preserved&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span>
</span><span id="HebbianTzimtzumESN.dark_night-315"><a href="#HebbianTzimtzumESN.dark_night-315"><span class="linenos">315</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hebbian_contribution</span><span class="p">)</span> <span class="o">/</span> 
</span><span id="HebbianTzimtzumESN.dark_night-316"><a href="#HebbianTzimtzumESN.dark_night-316"><span class="linenos">316</span></a>                <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hebbian_contribution</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-10</span><span class="p">)</span>
</span><span id="HebbianTzimtzumESN.dark_night-317"><a href="#HebbianTzimtzumESN.dark_night-317"><span class="linenos">317</span></a>            <span class="p">)</span>
</span><span id="HebbianTzimtzumESN.dark_night-318"><a href="#HebbianTzimtzumESN.dark_night-318"><span class="linenos">318</span></a>        <span class="p">}</span>
</span><span id="HebbianTzimtzumESN.dark_night-319"><a href="#HebbianTzimtzumESN.dark_night-319"><span class="linenos">319</span></a>        
</span><span id="HebbianTzimtzumESN.dark_night-320"><a href="#HebbianTzimtzumESN.dark_night-320"><span class="linenos">320</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pruning_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stats</span><span class="p">)</span>
</span><span id="HebbianTzimtzumESN.dark_night-321"><a href="#HebbianTzimtzumESN.dark_night-321"><span class="linenos">321</span></a>        <span class="k">return</span> <span class="n">stats</span>
</span></pre></div>


            <div class="docstring"><p>Ejecuta Dark Night con criterio Hebbiano.</p>

<p>Las conexiones que han sido activamente reforzadas por
plasticidad Hebbiana tienen mayor probabilidad de sobrevivir.</p>

<p>Args:
    fraction: Fracción de conexiones a podar</p>

<p>Returns:
    Estadísticas de poda</p>
</div>


                            </div>
                            <div id="HebbianTzimtzumESN.renacimiento" class="classattr">
                                        <input id="HebbianTzimtzumESN.renacimiento-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">renacimiento</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">fraction</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">Dict</span>:</span></span>

                <label class="view-source-button" for="HebbianTzimtzumESN.renacimiento-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HebbianTzimtzumESN.renacimiento"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HebbianTzimtzumESN.renacimiento-323"><a href="#HebbianTzimtzumESN.renacimiento-323"><span class="linenos">323</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">renacimiento</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fraction</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="HebbianTzimtzumESN.renacimiento-324"><a href="#HebbianTzimtzumESN.renacimiento-324"><span class="linenos">324</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HebbianTzimtzumESN.renacimiento-325"><a href="#HebbianTzimtzumESN.renacimiento-325"><span class="linenos">325</span></a><span class="sd">        Regrowth de conexiones después del Dark Night.</span>
</span><span id="HebbianTzimtzumESN.renacimiento-326"><a href="#HebbianTzimtzumESN.renacimiento-326"><span class="linenos">326</span></a><span class="sd">        </span>
</span><span id="HebbianTzimtzumESN.renacimiento-327"><a href="#HebbianTzimtzumESN.renacimiento-327"><span class="linenos">327</span></a><span class="sd">        Las nuevas conexiones comienzan con pesos pequeños y</span>
</span><span id="HebbianTzimtzumESN.renacimiento-328"><a href="#HebbianTzimtzumESN.renacimiento-328"><span class="linenos">328</span></a><span class="sd">        deben ganarse su lugar mediante aprendizaje Hebbiano.</span>
</span><span id="HebbianTzimtzumESN.renacimiento-329"><a href="#HebbianTzimtzumESN.renacimiento-329"><span class="linenos">329</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HebbianTzimtzumESN.renacimiento-330"><a href="#HebbianTzimtzumESN.renacimiento-330"><span class="linenos">330</span></a>        <span class="n">fraction</span> <span class="o">=</span> <span class="n">fraction</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_config</span><span class="o">.</span><span class="n">regrowth_fraction</span>
</span><span id="HebbianTzimtzumESN.renacimiento-331"><a href="#HebbianTzimtzumESN.renacimiento-331"><span class="linenos">331</span></a>        
</span><span id="HebbianTzimtzumESN.renacimiento-332"><a href="#HebbianTzimtzumESN.renacimiento-332"><span class="linenos">332</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="n">ContractionPhase</span><span class="o">.</span><span class="n">RENACIMIENTO</span>
</span><span id="HebbianTzimtzumESN.renacimiento-333"><a href="#HebbianTzimtzumESN.renacimiento-333"><span class="linenos">333</span></a>        
</span><span id="HebbianTzimtzumESN.renacimiento-334"><a href="#HebbianTzimtzumESN.renacimiento-334"><span class="linenos">334</span></a>        <span class="c1"># Cuántas conexiones regenerar</span>
</span><span id="HebbianTzimtzumESN.renacimiento-335"><a href="#HebbianTzimtzumESN.renacimiento-335"><span class="linenos">335</span></a>        <span class="n">pruned</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">pruned_connections</span>
</span><span id="HebbianTzimtzumESN.renacimiento-336"><a href="#HebbianTzimtzumESN.renacimiento-336"><span class="linenos">336</span></a>        <span class="n">regrow_count</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">pruned</span> <span class="o">*</span> <span class="n">fraction</span><span class="p">)</span>
</span><span id="HebbianTzimtzumESN.renacimiento-337"><a href="#HebbianTzimtzumESN.renacimiento-337"><span class="linenos">337</span></a>        
</span><span id="HebbianTzimtzumESN.renacimiento-338"><a href="#HebbianTzimtzumESN.renacimiento-338"><span class="linenos">338</span></a>        <span class="k">if</span> <span class="n">regrow_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="HebbianTzimtzumESN.renacimiento-339"><a href="#HebbianTzimtzumESN.renacimiento-339"><span class="linenos">339</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="n">ContractionPhase</span><span class="o">.</span><span class="n">PLENITUD</span>
</span><span id="HebbianTzimtzumESN.renacimiento-340"><a href="#HebbianTzimtzumESN.renacimiento-340"><span class="linenos">340</span></a>            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;regrown_count&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</span><span id="HebbianTzimtzumESN.renacimiento-341"><a href="#HebbianTzimtzumESN.renacimiento-341"><span class="linenos">341</span></a>        
</span><span id="HebbianTzimtzumESN.renacimiento-342"><a href="#HebbianTzimtzumESN.renacimiento-342"><span class="linenos">342</span></a>        <span class="c1"># Posiciones vacías</span>
</span><span id="HebbianTzimtzumESN.renacimiento-343"><a href="#HebbianTzimtzumESN.renacimiento-343"><span class="linenos">343</span></a>        <span class="n">empty_mask</span> <span class="o">=</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">_connection_mask</span>
</span><span id="HebbianTzimtzumESN.renacimiento-344"><a href="#HebbianTzimtzumESN.renacimiento-344"><span class="linenos">344</span></a>        <span class="n">empty_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">empty_mask</span><span class="p">)</span>
</span><span id="HebbianTzimtzumESN.renacimiento-345"><a href="#HebbianTzimtzumESN.renacimiento-345"><span class="linenos">345</span></a>        
</span><span id="HebbianTzimtzumESN.renacimiento-346"><a href="#HebbianTzimtzumESN.renacimiento-346"><span class="linenos">346</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">empty_indices</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="HebbianTzimtzumESN.renacimiento-347"><a href="#HebbianTzimtzumESN.renacimiento-347"><span class="linenos">347</span></a>            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;regrown_count&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</span><span id="HebbianTzimtzumESN.renacimiento-348"><a href="#HebbianTzimtzumESN.renacimiento-348"><span class="linenos">348</span></a>        
</span><span id="HebbianTzimtzumESN.renacimiento-349"><a href="#HebbianTzimtzumESN.renacimiento-349"><span class="linenos">349</span></a>        <span class="n">regrow_count</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">regrow_count</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">empty_indices</span><span class="p">))</span>
</span><span id="HebbianTzimtzumESN.renacimiento-350"><a href="#HebbianTzimtzumESN.renacimiento-350"><span class="linenos">350</span></a>        <span class="n">selected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_regrowth_rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
</span><span id="HebbianTzimtzumESN.renacimiento-351"><a href="#HebbianTzimtzumESN.renacimiento-351"><span class="linenos">351</span></a>            <span class="nb">len</span><span class="p">(</span><span class="n">empty_indices</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="n">regrow_count</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span>
</span><span id="HebbianTzimtzumESN.renacimiento-352"><a href="#HebbianTzimtzumESN.renacimiento-352"><span class="linenos">352</span></a>        <span class="p">)</span>
</span><span id="HebbianTzimtzumESN.renacimiento-353"><a href="#HebbianTzimtzumESN.renacimiento-353"><span class="linenos">353</span></a>        
</span><span id="HebbianTzimtzumESN.renacimiento-354"><a href="#HebbianTzimtzumESN.renacimiento-354"><span class="linenos">354</span></a>        <span class="c1"># Crear nuevas conexiones débiles</span>
</span><span id="HebbianTzimtzumESN.renacimiento-355"><a href="#HebbianTzimtzumESN.renacimiento-355"><span class="linenos">355</span></a>        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">selected</span><span class="p">:</span>
</span><span id="HebbianTzimtzumESN.renacimiento-356"><a href="#HebbianTzimtzumESN.renacimiento-356"><span class="linenos">356</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">empty_indices</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
</span><span id="HebbianTzimtzumESN.renacimiento-357"><a href="#HebbianTzimtzumESN.renacimiento-357"><span class="linenos">357</span></a>            <span class="n">new_weight</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_regrowth_rng</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
</span><span id="HebbianTzimtzumESN.renacimiento-358"><a href="#HebbianTzimtzumESN.renacimiento-358"><span class="linenos">358</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_weight</span>
</span><span id="HebbianTzimtzumESN.renacimiento-359"><a href="#HebbianTzimtzumESN.renacimiento-359"><span class="linenos">359</span></a>        
</span><span id="HebbianTzimtzumESN.renacimiento-360"><a href="#HebbianTzimtzumESN.renacimiento-360"><span class="linenos">360</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_connection_mask</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_reservoir</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="HebbianTzimtzumESN.renacimiento-361"><a href="#HebbianTzimtzumESN.renacimiento-361"><span class="linenos">361</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">regrown_connections</span> <span class="o">+=</span> <span class="n">regrow_count</span>
</span><span id="HebbianTzimtzumESN.renacimiento-362"><a href="#HebbianTzimtzumESN.renacimiento-362"><span class="linenos">362</span></a>        
</span><span id="HebbianTzimtzumESN.renacimiento-363"><a href="#HebbianTzimtzumESN.renacimiento-363"><span class="linenos">363</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_spectral_radius</span><span class="p">()</span>
</span><span id="HebbianTzimtzumESN.renacimiento-364"><a href="#HebbianTzimtzumESN.renacimiento-364"><span class="linenos">364</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_update_tzimtzum_metrics</span><span class="p">()</span>
</span><span id="HebbianTzimtzumESN.renacimiento-365"><a href="#HebbianTzimtzumESN.renacimiento-365"><span class="linenos">365</span></a>        
</span><span id="HebbianTzimtzumESN.renacimiento-366"><a href="#HebbianTzimtzumESN.renacimiento-366"><span class="linenos">366</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="n">ContractionPhase</span><span class="o">.</span><span class="n">PLENITUD</span>
</span><span id="HebbianTzimtzumESN.renacimiento-367"><a href="#HebbianTzimtzumESN.renacimiento-367"><span class="linenos">367</span></a>        
</span><span id="HebbianTzimtzumESN.renacimiento-368"><a href="#HebbianTzimtzumESN.renacimiento-368"><span class="linenos">368</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="HebbianTzimtzumESN.renacimiento-369"><a href="#HebbianTzimtzumESN.renacimiento-369"><span class="linenos">369</span></a>            <span class="s1">&#39;regrown_count&#39;</span><span class="p">:</span> <span class="n">regrow_count</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN.renacimiento-370"><a href="#HebbianTzimtzumESN.renacimiento-370"><span class="linenos">370</span></a>            <span class="s1">&#39;compression_ratio&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">compression_ratio</span>
</span><span id="HebbianTzimtzumESN.renacimiento-371"><a href="#HebbianTzimtzumESN.renacimiento-371"><span class="linenos">371</span></a>        <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Regrowth de conexiones después del Dark Night.</p>

<p>Las nuevas conexiones comienzan con pesos pequeños y
deben ganarse su lugar mediante aprendizaje Hebbiano.</p>
</div>


                            </div>
                            <div id="HebbianTzimtzumESN.full_tzimtzum_cycle" class="classattr">
                                        <input id="HebbianTzimtzumESN.full_tzimtzum_cycle-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">full_tzimtzum_cycle</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">Dict</span>:</span></span>

                <label class="view-source-button" for="HebbianTzimtzumESN.full_tzimtzum_cycle-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HebbianTzimtzumESN.full_tzimtzum_cycle"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HebbianTzimtzumESN.full_tzimtzum_cycle-373"><a href="#HebbianTzimtzumESN.full_tzimtzum_cycle-373"><span class="linenos">373</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">full_tzimtzum_cycle</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="HebbianTzimtzumESN.full_tzimtzum_cycle-374"><a href="#HebbianTzimtzumESN.full_tzimtzum_cycle-374"><span class="linenos">374</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Ejecuta ciclo completo: Dark Night + Renacimiento.&quot;&quot;&quot;</span>
</span><span id="HebbianTzimtzumESN.full_tzimtzum_cycle-375"><a href="#HebbianTzimtzumESN.full_tzimtzum_cycle-375"><span class="linenos">375</span></a>        <span class="n">dark</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dark_night</span><span class="p">()</span>
</span><span id="HebbianTzimtzumESN.full_tzimtzum_cycle-376"><a href="#HebbianTzimtzumESN.full_tzimtzum_cycle-376"><span class="linenos">376</span></a>        <span class="n">rebirth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">renacimiento</span><span class="p">()</span>
</span><span id="HebbianTzimtzumESN.full_tzimtzum_cycle-377"><a href="#HebbianTzimtzumESN.full_tzimtzum_cycle-377"><span class="linenos">377</span></a>        
</span><span id="HebbianTzimtzumESN.full_tzimtzum_cycle-378"><a href="#HebbianTzimtzumESN.full_tzimtzum_cycle-378"><span class="linenos">378</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="HebbianTzimtzumESN.full_tzimtzum_cycle-379"><a href="#HebbianTzimtzumESN.full_tzimtzum_cycle-379"><span class="linenos">379</span></a>            <span class="s1">&#39;dark_night&#39;</span><span class="p">:</span> <span class="n">dark</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN.full_tzimtzum_cycle-380"><a href="#HebbianTzimtzumESN.full_tzimtzum_cycle-380"><span class="linenos">380</span></a>            <span class="s1">&#39;renacimiento&#39;</span><span class="p">:</span> <span class="n">rebirth</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN.full_tzimtzum_cycle-381"><a href="#HebbianTzimtzumESN.full_tzimtzum_cycle-381"><span class="linenos">381</span></a>            <span class="s1">&#39;final_connections&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">total_connections</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN.full_tzimtzum_cycle-382"><a href="#HebbianTzimtzumESN.full_tzimtzum_cycle-382"><span class="linenos">382</span></a>            <span class="s1">&#39;total_cycles&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">pruning_cycles</span>
</span><span id="HebbianTzimtzumESN.full_tzimtzum_cycle-383"><a href="#HebbianTzimtzumESN.full_tzimtzum_cycle-383"><span class="linenos">383</span></a>        <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Ejecuta ciclo completo: Dark Night + Renacimiento.</p>
</div>


                            </div>
                            <div id="HebbianTzimtzumESN.get_combined_stats" class="classattr">
                                        <input id="HebbianTzimtzumESN.get_combined_stats-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_combined_stats</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">Dict</span>:</span></span>

                <label class="view-source-button" for="HebbianTzimtzumESN.get_combined_stats-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HebbianTzimtzumESN.get_combined_stats"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HebbianTzimtzumESN.get_combined_stats-385"><a href="#HebbianTzimtzumESN.get_combined_stats-385"><span class="linenos">385</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_combined_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="HebbianTzimtzumESN.get_combined_stats-386"><a href="#HebbianTzimtzumESN.get_combined_stats-386"><span class="linenos">386</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Estadísticas combinadas de Hebbian y Tzimtzum.&quot;&quot;&quot;</span>
</span><span id="HebbianTzimtzumESN.get_combined_stats-387"><a href="#HebbianTzimtzumESN.get_combined_stats-387"><span class="linenos">387</span></a>        <span class="n">hebbian_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_adaptation_stats</span><span class="p">()</span>
</span><span id="HebbianTzimtzumESN.get_combined_stats-388"><a href="#HebbianTzimtzumESN.get_combined_stats-388"><span class="linenos">388</span></a>        
</span><span id="HebbianTzimtzumESN.get_combined_stats-389"><a href="#HebbianTzimtzumESN.get_combined_stats-389"><span class="linenos">389</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="HebbianTzimtzumESN.get_combined_stats-390"><a href="#HebbianTzimtzumESN.get_combined_stats-390"><span class="linenos">390</span></a>            <span class="s1">&#39;hebbian&#39;</span><span class="p">:</span> <span class="n">hebbian_stats</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN.get_combined_stats-391"><a href="#HebbianTzimtzumESN.get_combined_stats-391"><span class="linenos">391</span></a>            <span class="s1">&#39;tzimtzum&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
</span><span id="HebbianTzimtzumESN.get_combined_stats-392"><a href="#HebbianTzimtzumESN.get_combined_stats-392"><span class="linenos">392</span></a>            <span class="s1">&#39;combined&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="HebbianTzimtzumESN.get_combined_stats-393"><a href="#HebbianTzimtzumESN.get_combined_stats-393"><span class="linenos">393</span></a>                <span class="s1">&#39;total_connections&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">total_connections</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN.get_combined_stats-394"><a href="#HebbianTzimtzumESN.get_combined_stats-394"><span class="linenos">394</span></a>                <span class="s1">&#39;adaptation_steps&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_adaptation_count</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN.get_combined_stats-395"><a href="#HebbianTzimtzumESN.get_combined_stats-395"><span class="linenos">395</span></a>                <span class="s1">&#39;pruning_cycles&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">pruning_cycles</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN.get_combined_stats-396"><a href="#HebbianTzimtzumESN.get_combined_stats-396"><span class="linenos">396</span></a>                <span class="s1">&#39;compression_ratio&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tzimtzum_state</span><span class="o">.</span><span class="n">compression_ratio</span><span class="p">,</span>
</span><span id="HebbianTzimtzumESN.get_combined_stats-397"><a href="#HebbianTzimtzumESN.get_combined_stats-397"><span class="linenos">397</span></a>                <span class="s1">&#39;mean_hebbian_contribution&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hebbian_contribution</span><span class="p">))</span>
</span><span id="HebbianTzimtzumESN.get_combined_stats-398"><a href="#HebbianTzimtzumESN.get_combined_stats-398"><span class="linenos">398</span></a>            <span class="p">}</span>
</span><span id="HebbianTzimtzumESN.get_combined_stats-399"><a href="#HebbianTzimtzumESN.get_combined_stats-399"><span class="linenos">399</span></a>        <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Estadísticas combinadas de Hebbian y Tzimtzum.</p>
</div>


                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>